module.exports = local;
local.usage = ["",
				"fhc local app=<appId> domain=<domain> port=<port> package=<package>",
				"where domain is the domain where your the app is hosted (For example: 'http://apps.feedhenry.com' - domain=apps)",
				"'port' is not required, the default port is 8888",
				"'package' is not required, but is used to select the package directory to look in for files",
				""].join("\n");


var http = require("http"),
	https = require("https"),
	url = require("url"),
	path = require("path"),
	fs = require("fs"),
	common = require("./common"),
	mimeTypes = {
		js: "text/javascript",
		css: "text/css",
		html: "text/html",
		xml: "text/xml",
		txt: "text/plain"
	},
	defaultArgs = {
		baseDomain: {
			required: true,
			val: ".feedhenry.com"
		},
		port: {
			required: true,
			val: 8888
		},
		domain: {
			required: true
		},
		app: {
			required: true
		},
		weinre: {
			required: false
		},
		package: {
			required: false
		}
	},
	lookupDirs = [
		'shared'
	],
	injection = {
		viewport: '<meta name="viewport" content="initial-scale = 1.0,maximum-scale = 1.0" />',
		device: '<script>\nif(!this.JSON){JSON=function(){function f(n){return n\x3C10?\'0\'+n:n;}\nDate.prototype.toJSON=function(){return this.getUTCFullYear()+\'-\'+\nf(this.getUTCMonth()+1)+\'-\'+\nf(this.getUTCDate())+\'T\'+\nf(this.getUTCHours())+\':\'+\nf(this.getUTCMinutes())+\':\'+\nf(this.getUTCSeconds())+\'Z\';};var escapeable=\x2F[\"\\\\\\x00-\\x1f\\x7f-\\x9f]\x2Fg,gap,indent,meta={\'\\b\':\'\\\\b\',\'\\t\':\'\\\\t\',\'\\n\':\'\\\\n\',\'\\f\':\'\\\\f\',\'\\r\':\'\\\\r\',\'\"\':\'\\\\\"\',\'\\\\\':\'\\\\\\\\\'},rep;function quote(string){return escapeable.test(string)?\'\"\'+string.replace(escapeable,function(a){var c=meta[a];if(typeof c===\'string\'){return c;}\nc=a.charCodeAt();return\'\\\\u00\'+Math.floor(c\x2F16).toString(16)+\n(c%16).toString(16);})+\'\"\':\'\"\'+string+\'\"\';}\nfunction str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value\&\&typeof value===\'object\'\&\&typeof value.toJSON===\'function\'){value=value.toJSON(key);}\nif(typeof rep===\'function\'){value=rep.call(holder,key,value);}\nswitch(typeof value){case\'string\':return quote(value);case\'number\':return isFinite(value)?String(value):\'null\';case\'boolean\':case\'null\':return String(value);case\'object\':if(!value){return\'null\';}\ngap+=indent;partial=[];if(typeof value.length===\'number\'\&\&!(value.propertyIsEnumerable(\'length\'))){length=value.length;for(i=0;i\x3Clength;i+=1){partial[i]=str(i,value)||\'null\';}\nv=partial.length===0?\'[]\':gap?\'[\\n\'+gap+partial.join(\',\\n\'+gap)+\'\\n\'+mind+\']\':\'[\'+partial.join(\',\')+\']\';gap=mind;return v;}\nif(typeof rep===\'object\'){length=rep.length;for(i=0;i\x3Clength;i+=1){k=rep[i];if(typeof k===\'string\'){v=str(k,value,rep);if(v){partial.push(quote(k)+(gap?\': \':\':\')+v);}}}}else{for(k in value){v=str(k,value,rep);if(v){partial.push(quote(k)+(gap?\': \':\':\')+v);}}}\nv=partial.length===0?\'{}\':gap?\'{\\n\'+gap+partial.join(\',\\n\'+gap)+\'\\n\'+mind+\'}\':\'{\'+partial.join(\',\')+\'}\';gap=mind;return v;}}\nreturn{stringify:function(value,replacer,space){var i;gap=\'\';indent=\'\';if(space){if(typeof space===\'number\'){for(i=0;i\x3Cspace;i+=1){indent+=\' \';}}else if(typeof space===\'string\'){indent=space;}}\nif(!replacer){rep=function(key,value){if(!Object.hasOwnProperty.call(this,key)){return undefined;}\nreturn value;};}else if(typeof replacer===\'function\'||(typeof replacer===\'object\'\&\&typeof replacer.length===\'number\')){rep=replacer;}else{throw new Error(\'JSON.stringify\');}\nreturn str(\'\',{\'\':value});},parse:function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value\&\&typeof value===\'object\'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}\nreturn reviver.call(holder,key,value);}\nif(\x2F^[\\],:{}\\s]*$\x2F.test(text.replace(\x2F\\\\[\"\\\\\\\x2Fbfnrtu]\x2Fg,\'@\').replace(\x2F\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?\x2Fg,\']\').replace(\x2F(?:^|:|,)(?:\\s*\\[)+\x2Fg,\'\'))){j=eval(\'(\'+text+\')\');return typeof reviver===\'function\'?walk({\'\':j},\'\'):j;}\nthrow new SyntaxError(\'JSON.parse\');},quote:quote};}();}\n(function(){if(window.google\&\&google.gears)\nreturn;var F=null;if(typeof GearsFactory!=\'undefined\'){F=new GearsFactory();}else{try{F=new ActiveXObject(\'Gears.Factory\');if(F.getBuildInfo().indexOf(\'ie_mobile\')!=-1)\nF.privateSetGlobalObject(this);}catch(e){if((typeof navigator.mimeTypes!=\'undefined\')\&\&navigator.mimeTypes[\"application\x2Fx-googlegears\"]){F=document.createElement(\"object\");F.style.display=\"none\";F.width=0;F.height=0;F.type=\"application\x2Fx-googlegears\";document.documentElement.appendChild(F);}}}\nif(!F)\nreturn;if(!window.google)\ngoogle={};if(!google.gears)\ngoogle.gears={factory:F};})();Persist=(function(){var VERSION=\'0.2.0\',P,B,esc,init,empty,ec;ec=(function(){var EPOCH=\'Thu, 01-Jan-1970 00:00:01 GMT\',RATIO=1000*60*60*24,KEYS=[\'expires\',\'path\',\'domain\'],esc=escape,un=unescape,doc=document,me;var get_now=function(){var r=new Date();r.setTime(r.getTime());return r;}\nvar cookify=function(c_key,c_val){var i,key,val,r=[],opt=(arguments.length\x3E2)?arguments[2]:{};r.push(esc(c_key)+\'=\'+esc(c_val));for(i=0;i\x3CKEYS.length;i++){key=KEYS[i];if(val=opt[key])\nr.push(key+\'=\'+val);}\nif(opt.secure)\nr.push(\'secure\');return r.join(\'; \');}\nvar alive=function(){var k=\'__EC_TEST__\',v=new Date();v=v.toGMTString();this.set(k,v);this.enabled=(this.remove(k)==v);return this.enabled;}\nme={set:function(key,val){var opt=(arguments.length\x3E2)?arguments[2]:{},now=get_now(),expire_at,cfg={};if(opt.expires){opt.expires*=RATIO;cfg.expires=new Date(now.getTime()+opt.expires);cfg.expires=cfg.expires.toGMTString();}\nvar keys=[\'path\',\'domain\',\'secure\'];for(i=0;i\x3Ckeys.length;i++)\nif(opt[keys[i]])\ncfg[keys[i]]=opt[keys[i]];var r=cookify(key,val,cfg);doc.cookie=r;return val;},has:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+\'=\'),len=ofs+key.length+1,sub=c.substring(0,key.length);return((!ofs\&\&key!=sub)||ofs\x3C0)?false:true;},get:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+\'=\'),len=ofs+key.length+1,sub=c.substring(0,key.length),end;if((!ofs\&\&key!=sub)||ofs\x3C0)\nreturn null;end=c.indexOf(\';\',len);if(end\x3C0)\nend=c.length;return un(c.substring(len,end));},remove:function(k){var r=me.get(k),opt={expires:EPOCH};doc.cookie=cookify(k,\'\',opt);return r;},keys:function(){var c=doc.cookie,ps=c.split(\'; \'),i,p,r=[];for(i=0;i\x3Cps.length;i++){p=ps[i].split(\'=\');r.push(un(p[0]));}\nreturn r;},all:function(){var c=doc.cookie,ps=c.split(\'; \'),i,p,r=[];for(i=0;i\x3Cps.length;i++){p=ps[i].split(\'=\');r.push([un(p[0]),un(p[1])]);}\nreturn r;},version:\'0.2.1\',enabled:false};me.enabled=alive.call(me);return me;}());var index_of=(function(){if(Array.prototype.indexOf)\nreturn function(ary,val){return Array.prototype.indexOf.call(ary,val);};else\nreturn function(ary,val){var i,l;for(i=0,l=ary.length;i\x3Cl;i++)\nif(ary[i]==val)\nreturn i;return-1;};})();empty=function(){};esc=function(str){return\'PS\'+str.replace(\x2F_\x2Fg,\'__\').replace(\x2F \x2Fg,\'_s\');};C={search_order:[\'localstorage\',\'whatwg_db\',\'globalstorage\',\'gears\',\'ie\',\'flash\',\'cookie\'],name_re:\x2F^[a-z][a-z0-9_ -]+$\x2Fi,methods:[\'init\',\'get\',\'set\',\'remove\',\'load\',\'save\'],sql:{version:\'1\',create:\"CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)\",get:\"SELECT v FROM persist_data WHERE k = ?\",set:\"INSERT INTO persist_data(k, v) VALUES (?, ?)\",remove:\"DELETE FROM persist_data WHERE k = ?\"},flash:{div_id:\'_persist_flash_wrap\',id:\'_persist_flash\',path:\'persist.swf\',size:{w:1,h:1},args:{autostart:true}}};B={gears:{size:-1,test:function(){return(window.google\&\&window.google.gears)?true:false;},methods:{transaction:function(fn){var db=this.db;db.execute(\'BEGIN\').close();fn.call(this,db);db.execute(\'COMMIT\').close();},init:function(){var db;db=this.db=google.gears.factory.create(\'beta.database\');db.open(esc(this.name));db.execute(C.sql.create).close();},get:function(key,fn,scope){var r,sql=C.sql.get;if(!fn)\nreturn;this.transaction(function(t){var is_valid,val;r=t.execute(sql,[key]);is_valid=r.isValidRow();val=is_valid?r.field(0):null;r.close();fn.call(scope||this,is_valid,val);});},set:function(key,val,fn,scope){var rm_sql=C.sql.remove,sql=C.sql.set,r;this.transaction(function(t){t.execute(rm_sql,[key]).close();t.execute(sql,[key,val]).close();if(fn)\nfn.call(scope||this,true,val);});},remove:function(key,fn,scope){var get_sql=C.sql.get;sql=C.sql.remove,r,val=null,is_valid=false;this.transaction(function(t){if(fn){r=t.execute(get_sql,[key]);is_valid=r.isValidRow();val=is_valid?r.field(0):null;r.close();}\nif(!fn||is_valid){t.execute(sql,[key]).close();}\nif(fn)\nfn.call(scope||this,is_valid,val);});}}},whatwg_db:{size:200*1024,test:function(){var name=\'PersistJS Test\',desc=\'Persistent database test.\';if(!window.openDatabase)\nreturn false;if(!window.openDatabase(name,C.sql.version,desc,B.whatwg_db.size))\nreturn false;return true;},methods:{transaction:function(fn){if(!this.db_created){this.db.transaction(function(t){t.executeSql(C.sql.create,[],function(){this.db_created=true;});},empty);}\nthis.db.transaction(fn);},init:function(){this.db=openDatabase(this.name,C.sql.version,this.o.about||(\"Persistent storage for \"+this.name),this.o.size||B.whatwg_db.size);},get:function(key,fn,scope){var sql=C.sql.get;if(!fn)\nreturn;scope=scope||this;this.transaction(function(t){t.executeSql(sql,[key],function(t,r){if(r.rows.length\x3E0)\nfn.call(scope,true,r.rows.item(0)[\'v\']);else\nfn.call(scope,false,null);});});},set:function(key,val,fn,scope){var rm_sql=C.sql.remove,sql=C.sql.set;this.transaction(function(t){t.executeSql(rm_sql,[key],function(){t.executeSql(sql,[key,val],function(t,r){if(fn)\nfn.call(scope||this,true,val);});});});return val;},remove:function(key,fn,scope){var get_sql=C.sql.get;sql=C.sql.remove;this.transaction(function(t){if(fn){t.executeSql(get_sql,[key],function(t,r){if(r.rows.length\x3E0){var val=r.rows.item(0)[\'v\'];t.executeSql(sql,[key],function(t,r){fn.call(scope||this,true,val);});}else{fn.call(scope||this,false,null);}});}else{t.executeSql(sql,[key]);}});}}},globalstorage:{size:5*1024*1024,test:function(){return window.globalStorage?true:false;},methods:{key:function(key){return esc(this.name)+esc(key);},init:function(){alert(\'domain = \'+this.o.domain);this.store=globalStorage[this.o.domain];},get:function(key,fn,scope){key=this.key(key);if(fn)\nfn.call(scope||this,true,this.store.getItem(key));},set:function(key,val,fn,scope){key=this.key(key);this.store.setItem(key,val);if(fn)\nfn.call(scope||this,true,val);},remove:function(key,fn,scope){var val;key=this.key(key);val=this.store[key];this.store.removeItem(key);if(fn)\nfn.call(scope||this,(val!==null),val);}}},localstorage:{size:-1,test:function(){return window.localStorage?true:false;},methods:{key:function(key){return esc(this.name)+esc(key);},init:function(){this.store=localStorage;},get:function(key,fn,scope){key=this.key(key);if(fn)\nfn.call(scope||this,true,this.store.getItem(key));},set:function(key,val,fn,scope){key=this.key(key);this.store.setItem(key,val);if(fn)\nfn.call(scope||this,true,val);},remove:function(key,fn,scope){var val;key=this.key(key);val=this.store.getItem(key);this.store.removeItem(key);if(fn)\nfn.call(scope||this,(val!==null),val);}}},ie:{prefix:\'_persist_data-\',size:64*1024,test:function(){return window.ActiveXObject?true:false;},make_userdata:function(id){var el=document.createElement(\'div\');el.id=id;el.style.display=\'none\';el.addBehavior(\'#default#userdata\');document.body.appendChild(el);return el;},methods:{init:function(){var id=B.ie.prefix+esc(this.name);this.el=B.ie.make_userdata(id);if(this.o.defer)\nthis.load();},get:function(key,fn,scope){var val;key=esc(key);if(!this.o.defer)\nthis.load();val=this.el.getAttribute(key);if(fn)\nfn.call(scope||this,val?true:false,val);},set:function(key,val,fn,scope){key=esc(key);this.el.setAttribute(key,val);if(!this.o.defer)\nthis.save();if(fn)\nfn.call(scope||this,true,val);},remove:function(key,fn,scope){var val;key=esc(key);if(!this.o.defer)\nthis.load();val=this.el.getAttribute(key);this.el.removeAttribute(key);if(!this.o.defer)\nthis.save();if(fn)\nfn.call(scope||this,val?true:false,val);},load:function(){this.el.load(esc(this.name));},save:function(){this.el.save(esc(this.name));}}},cookie:{delim:\':\',size:4000,test:function(){return P.Cookie.enabled?true:false;},methods:{key:function(key){return this.name+B.cookie.delim+key;},get:function(key,fn,scope){var val;key=this.key(key);val=ec.get(key);if(fn)\nfn.call(scope||this,val!=null,val);},set:function(key,val,fn,scope){key=this.key(key);ec.set(key,val,this.o);if(fn)\nfn.call(scope||this,true,val);},remove:function(key,val,fn,scope){var val;key=this.key(key);val=ec.remove(key)\nif(fn)\nfn.call(scope||this,val!=null,val);}}},flash:{test:function(){if(!deconcept||!deconcept.SWFObjectUtil)\nreturn false;var major=deconcept.SWFObjectUtil.getPlayerVersion().major;return(major\x3E=8)?true:false;},methods:{init:function(){if(!B.flash.el){var o,key,el,cfg=C.flash;el=document.createElement(\'div\');el.id=cfg.div_id;document.body.appendChild(el);o=new deconcept.SWFObject(this.o.swf_path||cfg.path,cfg.id,cfg.size.w,cfg.size.h,\'8\');for(key in cfg.args)\no.addVariable(key,cfg.args[key]);o.write(el);B.flash.el=document.getElementById(cfg.id);}\nthis.el=B.flash.el;},get:function(key,fn,scope){var val;key=esc(key);val=this.el.get(this.name,key);if(fn)\nfn.call(scope||this,val!==null,val);},set:function(key,val,fn,scope){var old_val;key=esc(key);old_val=this.el.set(this.name,key,val);if(fn)\nfn.call(scope||this,true,val);},remove:function(key,fn,scope){var val;key=esc(key);val=this.el.remove(this.name,key);if(fn)\nfn.call(scope||this,true,val);}}}};var init=function(){var i,l,b,key,fns=C.methods,keys=C.search_order;for(i=0,l=fns.length;i\x3Cl;i++)\nP.Store.prototype[fns[i]]=empty;P.type=null;P.size=-1;for(i=0,l=keys.length;!P.type\&\&i\x3Cl;i++){b=B[keys[i]];if(b.test()){P.type=keys[i];P.size=b.size;for(key in b.methods)\nP.Store.prototype[key]=b.methods[key];}}\nP._init=true;};P={VERSION:VERSION,type:null,size:0,add:function(o){B[o.id]=o;C.search_order=[o.id].concat(C.search_order);init();},remove:function(id){var ofs=index_of(C.search_order,id);if(ofs\x3C0)\nreturn;C.search_order.splice(ofs,1);delete B[id];init();},Cookie:ec,Store:function(name,o){if(!C.name_re.exec(name))\nthrow new Error(\"Invalid name\");if(!P.type)\nthrow new Error(\"No suitable storage found\");o=o||{};this.name=name;o.domain=o.domain||location.host||\'localhost\';o.domain=o.domain.replace(\x2F:\\d+$\x2F,\'\')\nthis.o=o;o.expires=o.expires||365*2;o.path=o.path||\'\x2F\';this.init();}};init();return P;})();if(typeof deconcept==\"undefined\")var deconcept=new Object();if(typeof deconcept.util==\"undefined\")deconcept.util=new Object();if(typeof deconcept.SWFObjectUtil==\"undefined\")deconcept.SWFObjectUtil=new Object();deconcept.SWFObject=function(swf,id,w,h,ver,c,quality,xiRedirectUrl,redirectUrl,detectKey){if(!document.getElementById){return;}\nthis.DETECT_KEY=detectKey?detectKey:\'detectflash\';this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(swf){this.setAttribute(\'swf\',swf);}\nif(id){this.setAttribute(\'id\',id);}\nif(w){this.setAttribute(\'width\',w);}\nif(h){this.setAttribute(\'height\',h);}\nif(ver){this.setAttribute(\'version\',new deconcept.PlayerVersion(ver.toString().split(\".\")));}\nthis.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera\&\&document.all\&\&this.installedVer.major\x3E7){deconcept.SWFObject.doPrepUnload=true;}\nif(c){this.addParam(\'bgcolor\',c);}\nvar q=quality?quality:\'high\';this.addParam(\'quality\',q);this.setAttribute(\'useExpressInstall\',false);this.setAttribute(\'doExpressInstall\',false);var xir=(xiRedirectUrl)?xiRedirectUrl:window.location;this.setAttribute(\'xiRedirectUrl\',xir);this.setAttribute(\'redirectUrl\',\'\');if(redirectUrl){this.setAttribute(\'redirectUrl\',redirectUrl);}}\ndeconcept.SWFObject.prototype={useExpressInstall:function(path){this.xiSWFPath=!path?\"expressinstall.swf\":path;this.setAttribute(\'useExpressInstall\',true);},setAttribute:function(name,value){this.attributes[name]=value;},getAttribute:function(name){return this.attributes[name];},addParam:function(name,value){this.params[name]=value;},getParams:function(){return this.params;},addVariable:function(name,value){this.variables[name]=value;},getVariable:function(name){return this.variables[name];},getVariables:function(){return this.variables;},getVariablePairs:function(){var variablePairs=new Array();var key;var variables=this.getVariables();for(key in variables){variablePairs.push(key+\"=\"+variables[key]);}\nreturn variablePairs;},getSWFHTML:function(){var swfNode=\"\";if(navigator.plugins\&\&navigator.mimeTypes\&\&navigator.mimeTypes.length){if(this.getAttribute(\"doExpressInstall\")){this.addVariable(\"MMplayerType\",\"PlugIn\");this.setAttribute(\'swf\',this.xiSWFPath);}\nswfNode=\'\x3Cembed type=\"application\x2Fx-shockwave-flash\" src=\"\'+this.getAttribute(\'swf\')+\'\" width=\"\'+this.getAttribute(\'width\')+\'\" height=\"\'+this.getAttribute(\'height\')+\'\"\';swfNode+=\' id=\"\'+this.getAttribute(\'id\')+\'\" name=\"\'+this.getAttribute(\'id\')+\'\" \';var params=this.getParams();for(var key in params){swfNode+=[key]+\'=\"\'+params[key]+\'\" \';}\nvar pairs=this.getVariablePairs().join(\"\&\");if(pairs.length\x3E0){swfNode+=\'flashvars=\"\'+pairs+\'\"\';}\nswfNode+=\'\x2F\x3E\';}else{if(this.getAttribute(\"doExpressInstall\")){this.addVariable(\"MMplayerType\",\"ActiveX\");this.setAttribute(\'swf\',this.xiSWFPath);}\nswfNode=\'\x3Cobject id=\"\'+this.getAttribute(\'id\')+\'\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\"\'+this.getAttribute(\'width\')+\'\" height=\"\'+this.getAttribute(\'height\')+\'\"\x3E\';swfNode+=\'\x3Cparam name=\"movie\" value=\"\'+this.getAttribute(\'swf\')+\'\" \x2F\x3E\';var params=this.getParams();for(var key in params){swfNode+=\'\x3Cparam name=\"\'+key+\'\" value=\"\'+params[key]+\'\" \x2F\x3E\';}\nvar pairs=this.getVariablePairs().join(\"\&\");if(pairs.length\x3E0){swfNode+=\'\x3Cparam name=\"flashvars\" value=\"\'+pairs+\'\" \x2F\x3E\';}\nswfNode+=\"\x3C\x2Fobject\x3E\";}\nreturn swfNode;},write:function(elementId){if(this.getAttribute(\'useExpressInstall\')){var expressInstallReqVer=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(expressInstallReqVer)\&\&!this.installedVer.versionIsValid(this.getAttribute(\'version\'))){this.setAttribute(\'doExpressInstall\',true);this.addVariable(\"MMredirectURL\",escape(this.getAttribute(\'xiRedirectUrl\')));document.title=document.title.slice(0,47)+\" - Flash Player Installation\";this.addVariable(\"MMdoctitle\",document.title);}}\nif(this.skipDetect||this.getAttribute(\'doExpressInstall\')||this.installedVer.versionIsValid(this.getAttribute(\'version\'))){var n=(typeof elementId==\'string\')?document.getElementById(elementId):elementId;n.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute(\'redirectUrl\')!=\"\"){document.location.replace(this.getAttribute(\'redirectUrl\'));}}\nreturn false;}}\ndeconcept.SWFObjectUtil.getPlayerVersion=function(){var PlayerVersion=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins\&\&navigator.mimeTypes.length){var x=navigator.plugins[\"Shockwave Flash\"];if(x\&\&x.description){PlayerVersion=new deconcept.PlayerVersion(x.description.replace(\x2F([a-zA-Z]|\\s)+\x2F,\"\").replace(\x2F(\\s+r|\\s+b[0-9]+)\x2F,\".\").split(\".\"));}}else{try{var axo=new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash.7\");}catch(e){try{var axo=new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash.6\");PlayerVersion=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess=\"always\";}catch(e){if(PlayerVersion.major==6){return PlayerVersion;}}\ntry{axo=new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash\");}catch(e){}}\nif(axo!=null){PlayerVersion=new deconcept.PlayerVersion(axo.GetVariable(\"$version\").split(\" \")[1].split(\",\"));}}\nreturn PlayerVersion;}\ndeconcept.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0;}\ndeconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major\x3Cfv.major)return false;if(this.major\x3Efv.major)return true;if(this.minor\x3Cfv.minor)return false;if(this.minor\x3Efv.minor)return true;if(this.rev\x3Cfv.rev)return false;return true;}\ndeconcept.util={getRequestParameter:function(param){var q=document.location.search||document.location.hash;if(q){var pairs=q.substring(1).split(\"\&\");for(var i=0;i\x3Cpairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf(\"=\"))==param){return pairs[i].substring((pairs[i].indexOf(\"=\")+1));}}}\nreturn\"\";}}\ndeconcept.SWFObjectUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName(\"OBJECT\");for(var i=0;i\x3Cobjects.length;i++){objects[i].style.display=\'none\';for(var x in objects[i]){if(typeof objects[i][x]==\'function\'){objects[i][x]=function(){};}}}}\nif(deconcept.SWFObject.doPrepUnload){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent(\"onunload\",deconcept.SWFObjectUtil.cleanupSWFs);}\nwindow.attachEvent(\"onbeforeunload\",deconcept.SWFObjectUtil.prepUnload);}\nif(Array.prototype.push==null){Array.prototype.push=function(item){this[this.length]=item;return this.length;}}\nvar getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;var biRadixBase=2;var biRadixBits=16;var bitsPerDigit=biRadixBits;var biRadix=1\x3C\x3C16;var biHalfRadix=biRadix\x3E\x3E\x3E1;var biRadixSquared=biRadix*biRadix;var maxDigitVal=biRadix-1;var maxInteger=9999999999999998;var maxDigits;var ZERO_ARRAY;var bigZero,bigOne;function setMaxDigits(value){maxDigits=value;ZERO_ARRAY=new Array(maxDigits);for(var iza=0;iza\x3CZERO_ARRAY.length;iza++)ZERO_ARRAY[iza]=0;bigZero=new BigInt();bigOne=new BigInt();bigOne.digits[0]=1;}\nsetMaxDigits(20);var dpl10=15;var lr10=biFromNumber(1000000000000000);function BigInt(flag){if(typeof flag==\"boolean\"\&\&flag==true){this.digits=null;}else{this.digits=ZERO_ARRAY.slice(0);}\nthis.isNeg=false;}\nfunction biFromDecimal(s){var isNeg=s.charAt(0)==\'-\';var i=isNeg?1:0;var result;while(i\x3Cs.length\&\&s.charAt(i)==\'0\')++i;if(i==s.length){result=new BigInt();}else{var digitCount=s.length-i;var fgl=digitCount%dpl10;if(fgl==0)fgl=dpl10;result=biFromNumber(Number(s.substr(i,fgl)));i+=fgl;while(i\x3Cs.length){result=biAdd(biMultiply(result,lr10),biFromNumber(Number(s.substr(i,dpl10))));i+=dpl10;}\nresult.isNeg=isNeg;}\nreturn result;}\nfunction biCopy(bi){var result=new BigInt(true);result.digits=bi.digits.slice(0);result.isNeg=bi.isNeg;return result;}\nfunction biFromNumber(i){var result=new BigInt();result.isNeg=i\x3C0;i=Math.abs(i);var j=0;while(i\x3E0){result.digits[j++]=i\&maxDigitVal;i\x3E\x3E=biRadixBits;}\nreturn result;}\nfunction reverseStr(s){var result=\"\";for(var i=s.length-1;i\x3E-1;--i){result+=s.charAt(i);}\nreturn result;}\nvar hexatrigesimalToChar=new Array(\'0\',\'1\',\'2\',\'3\',\'4\',\'5\',\'6\',\'7\',\'8\',\'9\',\'a\',\'b\',\'c\',\'d\',\'e\',\'f\',\'g\',\'h\',\'i\',\'j\',\'k\',\'l\',\'m\',\'n\',\'o\',\'p\',\'q\',\'r\',\'s\',\'t\',\'u\',\'v\',\'w\',\'x\',\'y\',\'z\');function biToString(x,radix)\n{var b=new BigInt();b.digits[0]=radix;var qr=biDivideModulo(x,b);var result=hexatrigesimalToChar[qr[1].digits[0]];while(biCompare(qr[0],bigZero)==1){qr=biDivideModulo(qr[0],b);digit=qr[1].digits[0];result+=hexatrigesimalToChar[qr[1].digits[0]];}\nreturn(x.isNeg?\"-\":\"\")+reverseStr(result);}\nfunction biToDecimal(x){var b=new BigInt();b.digits[0]=10;var qr=biDivideModulo(x,b);var result=String(qr[1].digits[0]);while(biCompare(qr[0],bigZero)==1){qr=biDivideModulo(qr[0],b);result+=String(qr[1].digits[0]);}\nreturn(x.isNeg?\"-\":\"\")+reverseStr(result);}\nvar hexToChar=new Array(\'0\',\'1\',\'2\',\'3\',\'4\',\'5\',\'6\',\'7\',\'8\',\'9\',\'a\',\'b\',\'c\',\'d\',\'e\',\'f\');function digitToHex(n){var mask=0xf;var result=\"\";for(i=0;i\x3C4;++i){result+=hexToChar[n\&mask];n\x3E\x3E\x3E=4;}\nreturn reverseStr(result);}\nfunction biToHex(x){var result=\"\";var n=biHighIndex(x);for(var i=biHighIndex(x);i\x3E-1;--i){result+=digitToHex(x.digits[i]);}\nreturn result;}\nfunction charToHex(c){var ZERO=48;var NINE=ZERO+9;var littleA=97;var littleZ=littleA+25;var bigA=65;var bigZ=65+25;var result;if(c\x3E=ZERO\&\&c\x3C=NINE){result=c-ZERO;}else if(c\x3E=bigA\&\&c\x3C=bigZ){result=10+c-bigA;}else if(c\x3E=littleA\&\&c\x3C=littleZ){result=10+c-littleA;}else{result=0;}\nreturn result;}\nfunction hexToDigit(s){var result=0;var sl=Math.min(s.length,4);for(var i=0;i\x3Csl;++i){result\x3C\x3C=4;result|=charToHex(s.charCodeAt(i))}\nreturn result;}\nfunction biFromHex(s){var result=new BigInt();var sl=s.length;for(var i=sl,j=0;i\x3E0;i-=4,++j){result.digits[j]=hexToDigit(s.substr(Math.max(i-4,0),Math.min(i,4)));}\nreturn result;}\nfunction biFromString(s,radix){var isNeg=s.charAt(0)==\'-\';var istop=isNeg?1:0;var result=new BigInt();var place=new BigInt();place.digits[0]=1;for(var i=s.length-1;i\x3E=istop;i--){var c=s.charCodeAt(i);var digit=charToHex(c);var biDigit=biMultiplyDigit(place,digit);result=biAdd(result,biDigit);place=biMultiplyDigit(place,radix);}\nresult.isNeg=isNeg;return result;}\nfunction biDump(b){return(b.isNeg?\"-\":\"\")+b.digits.join(\" \");}\nfunction biAdd(x,y){var result;if(x.isNeg!=y.isNeg){y.isNeg=!y.isNeg;result=biSubtract(x,y);y.isNeg=!y.isNeg;}else{result=new BigInt();var c=0;var n;for(var i=0;i\x3Cx.digits.length;++i){n=x.digits[i]+y.digits[i]+c;result.digits[i]=n\&0xffff;c=Number(n\x3E=biRadix);}\nresult.isNeg=x.isNeg;}\nreturn result;}\nfunction biSubtract(x,y){var result;if(x.isNeg!=y.isNeg){y.isNeg=!y.isNeg;result=biAdd(x,y);y.isNeg=!y.isNeg;}else{result=new BigInt();var n,c;c=0;for(var i=0;i\x3Cx.digits.length;++i){n=x.digits[i]-y.digits[i]+c;result.digits[i]=n\&0xffff;if(result.digits[i]\x3C0)result.digits[i]+=biRadix;c=0-Number(n\x3C0);}\nif(c==-1){c=0;for(var i=0;i\x3Cx.digits.length;++i){n=0-result.digits[i]+c;result.digits[i]=n\&0xffff;if(result.digits[i]\x3C0)result.digits[i]+=biRadix;c=0-Number(n\x3C0);}\nresult.isNeg=!x.isNeg;}else{result.isNeg=x.isNeg;}}\nreturn result;}\nfunction biHighIndex(x){var result=x.digits.length-1;while(result\x3E0\&\&x.digits[result]==0)--result;return result;}\nfunction biNumBits(x){var n=biHighIndex(x);var d=x.digits[n];var m=(n+1)*bitsPerDigit;var result;for(result=m;result\x3Em-bitsPerDigit;--result){if((d\&0x8000)!=0)break;d\x3C\x3C=1;}\nreturn result;}\nfunction biMultiply(x,y){var result=new BigInt();var c;var n=biHighIndex(x);var t=biHighIndex(y);var u,uv,k;for(var i=0;i\x3C=t;++i){c=0;k=i;for(j=0;j\x3C=n;++j,++k){uv=result.digits[k]+x.digits[j]*y.digits[i]+c;result.digits[k]=uv\&maxDigitVal;c=uv\x3E\x3E\x3EbiRadixBits;}\nresult.digits[i+n+1]=c;}\nresult.isNeg=x.isNeg!=y.isNeg;return result;}\nfunction biMultiplyDigit(x,y){var n,c,uv;result=new BigInt();n=biHighIndex(x);c=0;for(var j=0;j\x3C=n;++j){uv=result.digits[j]+x.digits[j]*y+c;result.digits[j]=uv\&maxDigitVal;c=uv\x3E\x3E\x3EbiRadixBits;}\nresult.digits[1+n]=c;return result;}\nfunction arrayCopy(src,srcStart,dest,destStart,n){var m=Math.min(srcStart+n,src.length);for(var i=srcStart,j=destStart;i\x3Cm;++i,++j){dest[j]=src[i];}}\nvar highBitMasks=new Array(0x0000,0x8000,0xC000,0xE000,0xF000,0xF800,0xFC00,0xFE00,0xFF00,0xFF80,0xFFC0,0xFFE0,0xFFF0,0xFFF8,0xFFFC,0xFFFE,0xFFFF);function biShiftLeft(x,n){var digitCount=Math.floor(n\x2FbitsPerDigit);var result=new BigInt();arrayCopy(x.digits,0,result.digits,digitCount,result.digits.length-digitCount);var bits=n%bitsPerDigit;var rightBits=bitsPerDigit-bits;for(var i=result.digits.length-1,i1=i-1;i\x3E0;--i,--i1){result.digits[i]=((result.digits[i]\x3C\x3Cbits)\&maxDigitVal)|((result.digits[i1]\&highBitMasks[bits])\x3E\x3E\x3E(rightBits));}\nresult.digits[0]=((result.digits[i]\x3C\x3Cbits)\&maxDigitVal);result.isNeg=x.isNeg;return result;}\nvar lowBitMasks=new Array(0x0000,0x0001,0x0003,0x0007,0x000F,0x001F,0x003F,0x007F,0x00FF,0x01FF,0x03FF,0x07FF,0x0FFF,0x1FFF,0x3FFF,0x7FFF,0xFFFF);function biShiftRight(x,n){var digitCount=Math.floor(n\x2FbitsPerDigit);var result=new BigInt();arrayCopy(x.digits,digitCount,result.digits,0,x.digits.length-digitCount);var bits=n%bitsPerDigit;var leftBits=bitsPerDigit-bits;for(var i=0,i1=i+1;i\x3Cresult.digits.length-1;++i,++i1){result.digits[i]=(result.digits[i]\x3E\x3E\x3Ebits)|((result.digits[i1]\&lowBitMasks[bits])\x3C\x3CleftBits);}\nresult.digits[result.digits.length-1]\x3E\x3E\x3E=bits;result.isNeg=x.isNeg;return result;}\nfunction biMultiplyByRadixPower(x,n){var result=new BigInt();arrayCopy(x.digits,0,result.digits,n,result.digits.length-n);return result;}\nfunction biDivideByRadixPower(x,n){var result=new BigInt();arrayCopy(x.digits,n,result.digits,0,result.digits.length-n);return result;}\nfunction biModuloByRadixPower(x,n){var result=new BigInt();arrayCopy(x.digits,0,result.digits,0,n);return result;}\nfunction biCompare(x,y){if(x.isNeg!=y.isNeg){return 1-2*Number(x.isNeg);}\nfor(var i=x.digits.length-1;i\x3E=0;--i){if(x.digits[i]!=y.digits[i]){if(x.isNeg){return 1-2*Number(x.digits[i]\x3Ey.digits[i]);}else{return 1-2*Number(x.digits[i]\x3Cy.digits[i]);}}}\nreturn 0;}\nfunction biDivideModulo(x,y){var nb=biNumBits(x);var tb=biNumBits(y);var origYIsNeg=y.isNeg;var q,r;if(nb\x3Ctb){if(x.isNeg){q=biCopy(bigOne);q.isNeg=!y.isNeg;x.isNeg=false;y.isNeg=false;r=biSubtract(y,x);x.isNeg=true;y.isNeg=origYIsNeg;}else{q=new BigInt();r=biCopy(x);}\nreturn new Array(q,r);}\nq=new BigInt();r=x;var t=Math.ceil(tb\x2FbitsPerDigit)-1;var lambda=0;while(y.digits[t]\x3CbiHalfRadix){y=biShiftLeft(y,1);++lambda;++tb;t=Math.ceil(tb\x2FbitsPerDigit)-1;}\nr=biShiftLeft(r,lambda);nb+=lambda;var n=Math.ceil(nb\x2FbitsPerDigit)-1;var b=biMultiplyByRadixPower(y,n-t);while(biCompare(r,b)!=-1){++q.digits[n-t];r=biSubtract(r,b);}\nfor(var i=n;i\x3Et;--i){var ri=(i\x3E=r.digits.length)?0:r.digits[i];var ri1=(i-1\x3E=r.digits.length)?0:r.digits[i-1];var ri2=(i-2\x3E=r.digits.length)?0:r.digits[i-2];var yt=(t\x3E=y.digits.length)?0:y.digits[t];var yt1=(t-1\x3E=y.digits.length)?0:y.digits[t-1];if(ri==yt){q.digits[i-t-1]=maxDigitVal;}else{q.digits[i-t-1]=Math.floor((ri*biRadix+ri1)\x2Fyt);}\nvar c1=q.digits[i-t-1]*((yt*biRadix)+yt1);var c2=(ri*biRadixSquared)+((ri1*biRadix)+ri2);while(c1\x3Ec2){--q.digits[i-t-1];c1=q.digits[i-t-1]*((yt*biRadix)|yt1);c2=(ri*biRadix*biRadix)+((ri1*biRadix)+ri2);}\nb=biMultiplyByRadixPower(y,i-t-1);r=biSubtract(r,biMultiplyDigit(b,q.digits[i-t-1]));if(r.isNeg){r=biAdd(r,b);--q.digits[i-t-1];}}\nr=biShiftRight(r,lambda);q.isNeg=x.isNeg!=origYIsNeg;if(x.isNeg){if(origYIsNeg){q=biAdd(q,bigOne);}else{q=biSubtract(q,bigOne);}\ny=biShiftRight(y,lambda);r=biSubtract(y,r);}\nif(r.digits[0]==0\&\&biHighIndex(r)==0)r.isNeg=false;return new Array(q,r);}\nfunction biDivide(x,y){return biDivideModulo(x,y)[0];}\nfunction biModulo(x,y){return biDivideModulo(x,y)[1];}\nfunction biMultiplyMod(x,y,m){return biModulo(biMultiply(x,y),m);}\nfunction biPow(x,y){var result=bigOne;var a=x;while(true){if((y\&1)!=0)result=biMultiply(result,a);y\x3E\x3E=1;if(y==0)break;a=biMultiply(a,a);}\nreturn result;}\nfunction biPowMod(x,y,m){var result=bigOne;var a=x;var k=y;while(true){if((k.digits[0]\&1)!=0)result=biMultiplyMod(result,a,m);k=biShiftRight(k,1);if(k.digits[0]==0\&\&biHighIndex(k)==0)break;a=biMultiplyMod(a,a,m);}\nreturn result;}\nfunction BarrettMu(m){this.modulus=biCopy(m);this.k=biHighIndex(this.modulus)+1;var b2k=new BigInt();b2k.digits[2*this.k]=1;this.mu=biDivide(b2k,this.modulus);this.bkplus1=new BigInt();this.bkplus1.digits[this.k+1]=1;this.modulo=BarrettMu_modulo;this.multiplyMod=BarrettMu_multiplyMod;this.powMod=BarrettMu_powMod;}\nfunction BarrettMu_modulo(x){var q1=biDivideByRadixPower(x,this.k-1);var q2=biMultiply(q1,this.mu);var q3=biDivideByRadixPower(q2,this.k+1);var r1=biModuloByRadixPower(x,this.k+1);var r2term=biMultiply(q3,this.modulus);var r2=biModuloByRadixPower(r2term,this.k+1);var r=biSubtract(r1,r2);if(r.isNeg){r=biAdd(r,this.bkplus1);}\nvar rgtem=biCompare(r,this.modulus)\x3E=0;while(rgtem){r=biSubtract(r,this.modulus);rgtem=biCompare(r,this.modulus)\x3E=0;}\nreturn r;}\nfunction BarrettMu_multiplyMod(x,y){var xy=biMultiply(x,y);return this.modulo(xy);}\nfunction BarrettMu_powMod(x,y){var result=new BigInt();result.digits[0]=1;var a=x;var k=y;while(true){if((k.digits[0]\&1)!=0)result=this.multiplyMod(result,a);k=biShiftRight(k,1);if(k.digits[0]==0\&\&biHighIndex(k)==0)break;a=this.multiplyMod(a,a);}\nreturn result;}\nfunction RSAKeyPair(encryptionExponent,decryptionExponent,modulus){this.e=biFromHex(encryptionExponent);this.d=biFromHex(decryptionExponent);this.m=biFromHex(modulus);this.chunkSize=2*biHighIndex(this.m);this.radix=16;this.barrett=new BarrettMu(this.m);}\nfunction twoDigit(n){return(n\x3C10?\"0\":\"\")+String(n);}\nfunction encryptedString(key,s)\n{var a=new Array();var sl=s.length;var i=0;while(i\x3Csl){a[i]=s.charCodeAt(i);i++;}\nwhile(a.length%key.chunkSize!=0){a[i++]=0;}\nvar al=a.length;var result=\"\";var j,k,block;for(i=0;i\x3Cal;i+=key.chunkSize){block=new BigInt();j=0;for(k=i;k\x3Ci+key.chunkSize;++j){block.digits[j]=a[k++];block.digits[j]+=a[k++]\x3C\x3C8;}\nvar crypt=key.barrett.powMod(block,key.e);var text=key.radix==16?biToHex(crypt):biToString(crypt,key.radix);result+=text+\" \";}\nreturn result.substring(0,result.length-1);}\nfunction decryptedString(key,s){var blocks=s.split(\" \");var result=\"\";var i,j,block;for(i=0;i\x3Cblocks.length;++i){var bi;if(key.radix==16){bi=biFromHex(blocks[i]);}else{bi=biFromString(blocks[i],key.radix);}\nblock=key.barrett.powMod(bi,key.d);for(j=0;j\x3C=biHighIndex(block);++j){result+=String.fromCharCode(block.digits[j]\&255,block.digits[j]\x3E\x3E8);}}\nif(result.charCodeAt(result.length-1)==0){result=result.substring(0,result.length-1);}\nreturn result;}\nvar __Crypto=__Crypto||{};function initPackages(__scope){var __package=function(packageRoot,pathString){var paths=pathString.split(\".\");var currentPackage=packageRoot;for(var i=0;i\x3Cpaths.length;i++){var id=paths[i];if(currentPackage[id]==null){currentPackage[id]={};}\ncurrentPackage=currentPackage[id];}\nreturn currentPackage;};var __export=function(packageRoot,pathString,object){var paths=pathString.split(\".\");var currentPackage=packageRoot;for(var i=0;i\x3Cpaths.length;i++){var id=paths[i];if(i\x3Cpaths.length-1){if(currentPackage[id]==null){currentPackage[id]={};}}else{if(currentPackage[id]==null){currentPackage[id]=object;}else{throw\"The specified package path is already defined. \"+pathString;}}\ncurrentPackage=currentPackage[id];}\nreturn currentPackage;};var __import=function(packageRoot,pathString,object){var paths=pathString.split(\".\");var currentPackage=packageRoot;var currentPath=\"[package root]\";for(var i=0;i\x3Cpaths.length;i++){var id=paths[i];currentPath+=\".\"+id;if(currentPackage[id]==null){throw pathString+\" is not found. \"+currentPath+\" is null in \"+__CURRENT_UNIT.unit_name+\".\";}\ncurrentPackage=currentPackage[id];}\nreturn currentPackage;};var __DEFINED_UNITS={};var __CURRENT_UNIT=\"\";var __unit=function(unit_name){__DEFINED_UNITS[unit_name]=true;__CURRENT_UNIT={unit_name:unit_name,requring_units:{}};}\nvar __uses=function(unit_name){if(__DEFINED_UNITS[unit_name]){__CURRENT_UNIT.requring_units[unit_name]=true;return true;}else{throw\"Unit Not Found Error : \"+__CURRENT_UNIT.unit_name+\" requires \"+unit_name;}};__scope.__package=__package;__scope.__import=__import;__scope.__export=__export;__scope.__unit=__unit;__scope.__uses=__uses;__scope.__DEFINED_UNITS=__DEFINED_UNITS;__scope.__PACKAGE_ENABLED=true;__unit(\"packages.js\");}\ninitPackages(__Crypto);function initBinary(packageRoot){if(packageRoot.__PACKAGE_ENABLED){__Crypto.__unit(\"binary.js\");}\nvar i2a=[\'A\',\'B\',\'C\',\'D\',\'E\',\'F\',\'G\',\'H\',\'I\',\'J\',\'K\',\'L\',\'M\',\'N\',\'O\',\'P\',\'Q\',\'R\',\'S\',\'T\',\'U\',\'V\',\'W\',\'X\',\'Y\',\'Z\',\'a\',\'b\',\'c\',\'d\',\'e\',\'f\',\'g\',\'h\',\'i\',\'j\',\'k\',\'l\',\'m\',\'n\',\'o\',\'p\',\'q\',\'r\',\'s\',\'t\',\'u\',\'v\',\'w\',\'x\',\'y\',\'z\',\'0\',\'1\',\'2\',\'3\',\'4\',\'5\',\'6\',\'7\',\'8\',\'9\',\'+\',\'\x2F\'];function base64_encode(s){var length=s.length;var groupCount=Math.floor(length\x2F3);var remaining=length-3*groupCount;var result=\"\";var idx=0;for(var i=0;i\x3CgroupCount;i++){var b0=s[idx++]\&0xff;var b1=s[idx++]\&0xff;var b2=s[idx++]\&0xff;result+=(i2a[b0\x3E\x3E2]);result+=(i2a[(b0\x3C\x3C4)\&0x3f|(b1\x3E\x3E4)]);result+=(i2a[(b1\x3C\x3C2)\&0x3f|(b2\x3E\x3E6)]);result+=(i2a[b2\&0x3f]);}\nif(remaining==0){}else if(remaining==1){var b0=s[idx++]\&0xff;result+=(i2a[b0\x3E\x3E2]);result+=(i2a[(b0\x3C\x3C4)\&0x3f]);result+=(\"==\");}else if(remaining==2){var b0=s[idx++]\&0xff;var b1=s[idx++]\&0xff;result+=(i2a[b0\x3E\x3E2]);result+=(i2a[(b0\x3C\x3C4)\&0x3f|(b1\x3E\x3E4)]);result+=(i2a[(b1\x3C\x3C2)\&0x3f]);result+=(\'=\');}else{throw\"never happen\";}\nreturn result;}\nvar a2i=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function get_a2i(c){var result=(0\x3C=c)\&\&(c\x3Ca2i.length)?a2i[c]:-1;if(result\x3C0)throw\"Illegal character \"+c;return result;}\nfunction base64_decode(s){var length=s.length;var groupCount=Math.floor(length\x2F4);if(4*groupCount!=length)throw\"String length must be a multiple of four.\";var missing=0;if(length!=0){if(s.charAt(length-1)==\'=\'){missing++;groupCount--;}\nif(s.charAt(length-2)==\'=\')missing++;}\nvar len=(3*groupCount-missing);if(len\x3C0){len=0;}\nvar result=new Array(len);var idx_in=0;var idx_out=0;for(var i=0;i\x3CgroupCount;i++){var c0=get_a2i(s.charCodeAt(idx_in++));var c1=get_a2i(s.charCodeAt(idx_in++));var c2=get_a2i(s.charCodeAt(idx_in++));var c3=get_a2i(s.charCodeAt(idx_in++));result[idx_out++]=0xFF\&((c0\x3C\x3C2)|(c1\x3E\x3E4));result[idx_out++]=0xFF\&((c1\x3C\x3C4)|(c2\x3E\x3E2));result[idx_out++]=0xFF\&((c2\x3C\x3C6)|c3);}\nif(missing==0){}else if(missing==1){var c0=get_a2i(s.charCodeAt(idx_in++));var c1=get_a2i(s.charCodeAt(idx_in++));var c2=get_a2i(s.charCodeAt(idx_in++));result[idx_out++]=0xFF\&((c0\x3C\x3C2)|(c1\x3E\x3E4));result[idx_out++]=0xFF\&((c1\x3C\x3C4)|(c2\x3E\x3E2));}else if(missing==2){var c0=get_a2i(s.charCodeAt(idx_in++));var c1=get_a2i(s.charCodeAt(idx_in++));result[idx_out++]=0xFF\&((c0\x3C\x3C2)|(c1\x3E\x3E4));}else{throw\"never happen\";}\nreturn result;}\nfunction base64x_encode(s){return base64x_pre_encode(base64_encode(s));}\nfunction base64x_decode(s){return base64_decode(base64x_pre_decode(s));}\nvar base64x_pre_encode_map={};base64x_pre_encode_map[\"x\"]=\"xx\";base64x_pre_encode_map[\"+\"]=\"xa\";base64x_pre_encode_map[\"\x2F\"]=\"xb\";base64x_pre_encode_map[\"=\"]=\"\";function base64x_pre_encode(s){var ss=\"\";for(var i=0;i\x3Cs.length;i++){var c=s.charAt(i);var cc=base64x_pre_encode_map[c];if(cc!=null){ss=ss+cc;}else{ss=ss+c;}}\nreturn ss;}\nvar base64x_pre_decode_map={};base64x_pre_decode_map[\'x\']=\'x\';base64x_pre_decode_map[\'a\']=\'+\';base64x_pre_decode_map[\'b\']=\'\x2F\';function base64x_pre_decode(s){var ss=\"\";for(var i=0;i\x3Cs.length;i++){var c=s.charAt(i);if(c==\'x\'){c=s.charAt(++i);var cc=base64x_pre_decode_map[c];if(cc!=null){ss=ss+cc;}else{}}else{ss=ss+c;}}\nwhile(ss.length%4!=0){ss+=\"=\";}\nreturn ss;}\nfunction equals(a,b){if(a.length!=b.length)return false;var size=a.length;for(var i=0;i\x3Csize;i++){if(a[i]!=b[i])return false;}\nreturn true;}\nfunction hex(i){if(i==null)return\"??\";i\&=0xff;var result=i.toString(16);return(result.length\x3C2)?\"0\"+result:result;}\nfunction base16(data,columns,delim){return base16_encode(data,columns,delim);}\nfunction base16_encode(data,columns,delim){if(delim==null){delim=\"\";}\nif(columns==null){columns=256;}\nvar result=\"\";for(var i=0;i\x3Cdata.length;i++){result+=hex(data[i])+delim;}\nreturn result.toUpperCase();}\nvar amap={};amap[\'0\']=0;amap[\'1\']=1;amap[\'2\']=2;amap[\'3\']=3;amap[\'4\']=4;amap[\'5\']=5;amap[\'6\']=6;amap[\'7\']=7;amap[\'8\']=8;amap[\'9\']=9;amap[\'A\']=10;amap[\'B\']=11;amap[\'C\']=12;amap[\'D\']=13;amap[\'E\']=14;amap[\'F\']=15;amap[\'a\']=10;amap[\'b\']=11;amap[\'c\']=12;amap[\'d\']=13;amap[\'e\']=14;amap[\'f\']=15;function get_amap(c){var cc=amap[c];if(cc==null)throw\"found an invalid character.\";return cc;}\nfunction base16_decode(data){var ca=[];for(var i=0,j=0;i\x3Cdata.length;i++){var c=data.charAt(i);if(c==\"\\s\"){continue;}else{ca[j++]=c;}}\nif(ca.length%2!=0){throw\"data must be a multiple of two.\";}\nvar result=new Array(ca.length\x3E\x3E1);for(var i=0;i\x3Cca.length;i+=2){var v=0xff\&((get_amap(ca[i])\x3C\x3C4)|(get_amap(ca[i+1])));result[i\x3E\x3E1]=v;}\nreturn result;}\nvar B10000000=0x80;var B11000000=0xC0;var B11100000=0xE0;var B11110000=0xF0;var B11111000=0xF8;var B11111100=0xFC;var B11111110=0xFE;var B01111111=0x7F;var B00111111=0x3F;var B00011111=0x1F;var B00001111=0x0F;var B00000111=0x07;var B00000011=0x03;var B00000001=0x01;function str2utf8(str){var result=[];var length=str.length;var idx=0;for(var i=0;i\x3Clength;i++){var c=str.charCodeAt(i);if(c\x3C=0x7f){result[idx++]=c;}else if(c\x3C=0x7ff){result[idx++]=B11000000|(B00011111\&(c\x3E\x3E\x3E6));result[idx++]=B10000000|(B00111111\&(c\x3E\x3E\x3E0));}else if(c\x3C=0xffff){result[idx++]=B11100000|(B00001111\&(c\x3E\x3E\x3E12));result[idx++]=B10000000|(B00111111\&(c\x3E\x3E\x3E6));result[idx++]=B10000000|(B00111111\&(c\x3E\x3E\x3E0));}else if(c\x3C=0x10ffff){result[idx++]=B11110000|(B00000111\&(c\x3E\x3E\x3E18));result[idx++]=B10000000|(B00111111\&(c\x3E\x3E\x3E12));result[idx++]=B10000000|(B00111111\&(c\x3E\x3E\x3E6));result[idx++]=B10000000|(B00111111\&(c\x3E\x3E\x3E0));}else{throw\"error\";}}\nreturn result;}\nfunction utf82str(data){var result=\"\";var length=data.length;for(var i=0;i\x3Clength;){var c=data[i++];if(c\x3C0x80){result+=String.fromCharCode(c);}else if((c\x3CB11100000)){result+=String.fromCharCode(((B00011111\&c)\x3C\x3C6)|((B00111111\&data[i++])\x3C\x3C0));}else if((c\x3CB11110000)){result+=String.fromCharCode(((B00001111\&c)\x3C\x3C12)|((B00111111\&data[i++])\x3C\x3C6)|((B00111111\&data[i++])\x3C\x3C0));}else if((c\x3CB11111000)){result+=String.fromCharCode(((B00000111\&c)\x3C\x3C18)|((B00111111\&data[i++])\x3C\x3C12)|((B00111111\&data[i++])\x3C\x3C6)|((B00111111\&data[i++])\x3C\x3C0));}else if((c\x3CB11111100)){result+=String.fromCharCode(((B00000011\&c)\x3C\x3C24)|((B00111111\&data[i++])\x3C\x3C18)|((B00111111\&data[i++])\x3C\x3C12)|((B00111111\&data[i++])\x3C\x3C6)|((B00111111\&data[i++])\x3C\x3C0));}else if((c\x3CB11111110)){result+=String.fromCharCode(((B00000001\&c)\x3C\x3C30)|((B00111111\&data[i++])\x3C\x3C24)|((B00111111\&data[i++])\x3C\x3C18)|((B00111111\&data[i++])\x3C\x3C12)|((B00111111\&data[i++])\x3C\x3C6)|((B00111111\&data[i++])\x3C\x3C0));}}\nreturn result;}\nfunction char2str(ca){var result=\"\";for(var i=0;i\x3Cca.length;i++){result+=String.fromCharCode(ca[i]);}\nreturn result;}\nfunction str2char(str){var result=new Array(str.length);for(var i=0;i\x3Cstr.length;i++){result[i]=str.charCodeAt(i);}\nreturn result;}\nfunction i2ba_be(i){return[0xff\&(i\x3E\x3E24),0xff\&(i\x3E\x3E16),0xff\&(i\x3E\x3E8),0xff\&(i\x3E\x3E0)];}\nfunction ba2i_be(bs){return((bs[0]\x3C\x3C24)|(bs[1]\x3C\x3C16)|(bs[2]\x3C\x3C8)|(bs[3]\x3C\x3C0));}\nfunction s2ba_be(i){return[0xff\&(i\x3E\x3E8),0xff\&(i\x3E\x3E0)];}\nfunction ba2s_be(bs){return(0|(bs[0]\x3C\x3C8)|(bs[1]\x3C\x3C0));}\nfunction i2ba_le(i){return[0xff\&(i\x3E\x3E0),0xff\&(i\x3E\x3E8),0xff\&(i\x3E\x3E16),0xff\&(i\x3E\x3E24)];}\nfunction ba2i_le(bs){return(0|(bs[3]\x3C\x3C0)|(bs[2]\x3C\x3C8)|(bs[1]\x3C\x3C16)|(bs[0]\x3C\x3C24));}\nfunction s2ba_le(i){return[0xff\&(i\x3E\x3E0),0xff\&(i\x3E\x3E8)];}\nfunction ba2s_le(bs){return(0|(bs[1]\x3C\x3C0)|(bs[0]\x3C\x3C8));}\nfunction ia2ba_be(ia){var length=ia.length\x3C\x3C2;var ba=new Array(length);for(var ii=0,bi=0;ii\x3Cia.length\&\&bi\x3Cba.length;){ba[bi++]=0xff\&(ia[ii]\x3E\x3E24);ba[bi++]=0xff\&(ia[ii]\x3E\x3E16);ba[bi++]=0xff\&(ia[ii]\x3E\x3E8);ba[bi++]=0xff\&(ia[ii]\x3E\x3E0);ii++;}\nreturn ba;}\nfunction ba2ia_be(ba){var length=(ba.length+3)\x3E\x3E2;var ia=new Array(length);;for(var ii=0,bi=0;ii\x3Cia.length\&\&bi\x3Cba.length;){ia[ii++]=(bi\x3Cba.length?(ba[bi++]\x3C\x3C24):0)|(bi\x3Cba.length?(ba[bi++]\x3C\x3C16):0)|(bi\x3Cba.length?(ba[bi++]\x3C\x3C8):0)|(bi\x3Cba.length?(ba[bi++]):0);}\nreturn ia;}\nfunction ia2ba_le(ia){var length=ia.length\x3C\x3C2;var ba=new Array(length);for(var ii=0,bi=0;ii\x3Cia.length\&\&bi\x3Cba.length;){ba[bi++]=0xff\&(ia[ii]\x3E\x3E0);ba[bi++]=0xff\&(ia[ii]\x3E\x3E8);ba[bi++]=0xff\&(ia[ii]\x3E\x3E16);ba[bi++]=0xff\&(ia[ii]\x3E\x3E24);ii++;}\nreturn ba;}\nfunction ba2ia_le(ba){var length=(ba.length+3)\x3E\x3E2;var ia=new Array(length);;for(var ii=0,bi=0;ii\x3Cia.length\&\&bi\x3Cba.length;){ia[ii++]=(bi\x3Cba.length?(ba[bi++]):0)|(bi\x3Cba.length?(ba[bi++]\x3C\x3C8):0)|(bi\x3Cba.length?(ba[bi++]\x3C\x3C16):0)|(bi\x3Cba.length?(ba[bi++]\x3C\x3C24):0);}\nreturn ia;}\nfunction trim(s){var result=\"\";for(var idx=0;idx\x3Cs.length;idx++){var c=s.charAt(idx);if(c==\"\\s\"||c==\"\\t\"||c==\"\\r\"||c==\"\\n\"){}else{result+=c;}}\nreturn result;}\nfunction mktst(encode,decode){return function(trial,from,to){var flg=true;for(var i=0;i\x3Ctrial;i++){for(var j=from;j\x3Cto;j++){var arr=new Array(j);for(var k=0;k\x3Cj;k++)\narr[k]=Math.floor(Math.random()*256);var s=encode(arr);var b=decode(s);trace(\"in :\"+arr.length+\":\"+base16_encode(arr));trace(\"b64:\"+s.length+\":\"+s);trace(\"out:\"+b.length+\":\"+base16_encode(arr));if(equals(arr,b)){trace(\"OK! ( \"+i+\",\"+j+\")\");}else{trace(\"ERR ( \"+i+\",\"+j+\")\");flg=false;}\ntrace(\"-----------\");}}\nif(flg){trace(\"ALL OK! \");}else{trace(\"FOUND ERROR!\");}};}\npackageRoot.base64_encode=base64_encode;packageRoot.base64_decode=base64_decode;packageRoot.base64_test=mktst(base64_encode,base64_decode);packageRoot.base64x_encode=base64x_encode;packageRoot.base64x_decode=base64x_decode;packageRoot.base64x_test=mktst(base64x_encode,base64x_decode);packageRoot.base64x_pre_encode=base64x_pre_encode;packageRoot.base64x_pre_decode=base64x_pre_decode;packageRoot.base16_encode=base16_encode;packageRoot.base16_decode=base16_decode;packageRoot.base16=base16;packageRoot.hex=base16;packageRoot.utf82str=utf82str;packageRoot.str2utf8=str2utf8;packageRoot.str2char=str2char;packageRoot.char2str=char2str;packageRoot.i2ba=i2ba_be;packageRoot.ba2i=ba2i_be;packageRoot.i2ba_be=i2ba_be;packageRoot.ba2i_be=ba2i_be;packageRoot.i2ba_le=i2ba_le;packageRoot.ba2i_le=ba2i_le;packageRoot.s2ba=s2ba_be;packageRoot.ba2s=ba2s_be;packageRoot.s2ba_be=s2ba_be;packageRoot.ba2s_be=ba2s_be;packageRoot.s2ba_le=s2ba_le;packageRoot.ba2s_le=ba2s_le;packageRoot.ba2ia=ba2ia_be;packageRoot.ia2ba=ia2ba_be;packageRoot.ia2ba_be=ia2ba_be;packageRoot.ba2ia_be=ba2ia_be;packageRoot.ia2ba_le=ia2ba_le;packageRoot.ba2ia_le=ba2ia_le;packageRoot.cmparr=equals;}\ninitBinary(__Crypto);function initBlockCipher(packageRoot){__Crypto.__unit(\"Cipher.js\");__Crypto.__uses(\"packages.js\");var MAXINT=0xFFFFFFFF;function rotb(b,n){return(b\x3C\x3Cn|b\x3E\x3E\x3E(8-n))\&0xFF;}\nfunction rotw(w,n){return(w\x3C\x3Cn|w\x3E\x3E\x3E(32-n))\&MAXINT;}\nfunction getW(a,i){return a[i]|a[i+1]\x3C\x3C8|a[i+2]\x3C\x3C16|a[i+3]\x3C\x3C24;}\nfunction setW(a,i,w){a.splice(i,4,w\&0xFF,(w\x3E\x3E\x3E8)\&0xFF,(w\x3E\x3E\x3E16)\&0xFF,(w\x3E\x3E\x3E24)\&0xFF);}\nfunction setWInv(a,i,w){a.splice(i,4,(w\x3E\x3E\x3E24)\&0xFF,(w\x3E\x3E\x3E16)\&0xFF,(w\x3E\x3E\x3E8)\&0xFF,w\&0xFF);}\nfunction getB(x,n){return(x\x3E\x3E\x3E(n*8))\&0xFF;}\nfunction getNrBits(i){var n=0;while(i\x3E0){n++;i\x3E\x3E\x3E=1;}\nreturn n;}\nfunction getMask(n){return(1\x3C\x3Cn)-1;}\nfunction randByte(){return Math.floor(Math.random()*256);}\nvar ALGORITHMS={};function createRijndael(){var keyBytes=null;var dataBytes=null;var dataOffset=-1;var algorithmName=null;algorithmName=\"rijndael\"\nvar aesNk;var aesNr;var aesPows;var aesLogs;var aesSBox;var aesSBoxInv;var aesRco;var aesFtable;var aesRtable;var aesFi;var aesRi;var aesFkey;var aesRkey;function aesMult(x,y){return(x\&\&y)?aesPows[(aesLogs[x]+aesLogs[y])%255]:0;}\nfunction aesPackBlock(){return[getW(dataBytes,dataOffset),getW(dataBytes,dataOffset+4),getW(dataBytes,dataOffset+8),getW(dataBytes,dataOffset+12)];}\nfunction aesUnpackBlock(packed){for(var j=0;j\x3C4;j++,dataOffset+=4)setW(dataBytes,dataOffset,packed[j]);}\nfunction aesXTime(p){p\x3C\x3C=1;return p\&0x100?p^0x11B:p;}\nfunction aesSubByte(w){return aesSBox[getB(w,0)]|aesSBox[getB(w,1)]\x3C\x3C8|aesSBox[getB(w,2)]\x3C\x3C16|aesSBox[getB(w,3)]\x3C\x3C24;}\nfunction aesProduct(w1,w2){return aesMult(getB(w1,0),getB(w2,0))^aesMult(getB(w1,1),getB(w2,1))^aesMult(getB(w1,2),getB(w2,2))^aesMult(getB(w1,3),getB(w2,3));}\nfunction aesInvMixCol(x){return aesProduct(0x090d0b0e,x)|aesProduct(0x0d0b0e09,x)\x3C\x3C8|aesProduct(0x0b0e090d,x)\x3C\x3C16|aesProduct(0x0e090d0b,x)\x3C\x3C24;}\nfunction aesByteSub(x){var y=aesPows[255-aesLogs[x]];x=y;x=rotb(x,1);y^=x;x=rotb(x,1);y^=x;x=rotb(x,1);y^=x;x=rotb(x,1);return x^y^0x63;}\nfunction aesGenTables(){var i,y;aesPows=[1,3];aesLogs=[0,0,null,1];aesSBox=new Array(256);aesSBoxInv=new Array(256);aesFtable=new Array(256);aesRtable=new Array(256);aesRco=new Array(30);for(i=2;i\x3C256;i++){aesPows[i]=aesPows[i-1]^aesXTime(aesPows[i-1]);aesLogs[aesPows[i]]=i;}\naesSBox[0]=0x63;aesSBoxInv[0x63]=0;for(i=1;i\x3C256;i++){y=aesByteSub(i);aesSBox[i]=y;aesSBoxInv[y]=i;}\nfor(i=0,y=1;i\x3C30;i++){aesRco[i]=y;y=aesXTime(y);}\nfor(i=0;i\x3C256;i++){y=aesSBox[i];aesFtable[i]=aesXTime(y)|y\x3C\x3C8|y\x3C\x3C16|(y^aesXTime(y))\x3C\x3C24;y=aesSBoxInv[i];aesRtable[i]=aesMult(14,y)|aesMult(9,y)\x3C\x3C8|aesMult(13,y)\x3C\x3C16|aesMult(11,y)\x3C\x3C24;}}\nfunction aesInit(key){keyBytes=key;keyBytes=keyBytes.slice(0,32);var i,k,m;var j=0;var l=keyBytes.length;while(l!=16\&\&l!=24\&\&l!=32)keyBytes[l++]=keyBytes[j++];aesGenTables();aesNk=keyBytes.length\x3E\x3E\x3E2;aesNr=6+aesNk;var N=4*(aesNr+1);aesFi=new Array(12);aesRi=new Array(12);aesFkey=new Array(N);aesRkey=new Array(N);for(m=j=0;j\x3C4;j++,m+=3){aesFi[m]=(j+1)%4;aesFi[m+1]=(j+2)%4;aesFi[m+2]=(j+3)%4;aesRi[m]=(4+j-1)%4;aesRi[m+1]=(4+j-2)%4;aesRi[m+2]=(4+j-3)%4;}\nfor(i=j=0;i\x3CaesNk;i++,j+=4)aesFkey[i]=getW(keyBytes,j);for(k=0,j=aesNk;j\x3CN;j+=aesNk,k++){aesFkey[j]=aesFkey[j-aesNk]^aesSubByte(rotw(aesFkey[j-1],24))^aesRco[k];if(aesNk\x3C=6)for(i=1;i\x3CaesNk\&\&(i+j)\x3CN;i++)aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];else{for(i=1;i\x3C4\&\&(i+j)\x3CN;i++)aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];if((j+4)\x3CN)aesFkey[j+4]=aesFkey[j+4-aesNk]^aesSubByte(aesFkey[j+3]);for(i=5;i\x3CaesNk\&\&(i+j)\x3CN;i++)aesFkey[i+j]=aesFkey[i+j-aesNk]^aesFkey[i+j-1];}}\nfor(j=0;j\x3C4;j++)aesRkey[j+N-4]=aesFkey[j];for(i=4;i\x3CN-4;i+=4){k=N-4-i;for(j=0;j\x3C4;j++)aesRkey[k+j]=aesInvMixCol(aesFkey[i+j]);}\nfor(j=N-4;j\x3CN;j++)aesRkey[j-N+4]=aesFkey[j];}\nfunction aesClose(){aesPows=aesLogs=aesSBox=aesSBoxInv=aesRco=null;aesFtable=aesRtable=aesFi=aesRi=aesFkey=aesRkey=null;}\nfunction aesRounds(block,key,table,inc,box){var tmp=new Array(4);var i,j,m,r;for(r=0;r\x3C4;r++)block[r]^=key[r];for(i=1;i\x3CaesNr;i++){for(j=m=0;j\x3C4;j++,m+=3){tmp[j]=key[r++]^table[block[j]\&0xFF]^rotw(table[(block[inc[m]]\x3E\x3E\x3E8)\&0xFF],8)^rotw(table[(block[inc[m+1]]\x3E\x3E\x3E16)\&0xFF],16)^rotw(table[(block[inc[m+2]]\x3E\x3E\x3E24)\&0xFF],24);}\nvar t=block;block=tmp;tmp=t;}\nfor(j=m=0;j\x3C4;j++,m+=3)\ntmp[j]=key[r++]^box[block[j]\&0xFF]^rotw(box[(block[inc[m]]\x3E\x3E\x3E8)\&0xFF],8)^rotw(box[(block[inc[m+1]]\x3E\x3E\x3E16)\&0xFF],16)^rotw(box[(block[inc[m+2]]\x3E\x3E\x3E24)\&0xFF],24);return tmp;}\nfunction aesEncrypt(data,offset){dataBytes=data;dataOffset=offset;aesUnpackBlock(aesRounds(aesPackBlock(),aesFkey,aesFtable,aesFi,aesSBox));}\nfunction aesDecrypt(data,offset){dataBytes=data;dataOffset=offset;aesUnpackBlock(aesRounds(aesPackBlock(),aesRkey,aesRtable,aesRi,aesSBoxInv));}\nreturn{name:\"rijndael\",blocksize:128\x2F8,open:aesInit,close:aesClose,encrypt:aesEncrypt,decrypt:aesDecrypt};}\nALGORITHMS.RIJNDAEL={create:createRijndael};function createSerpent(){var keyBytes=null;var dataBytes=null;var dataOffset=-1;var algorithmName=null;algorithmName=\"serpent\";var srpKey=[];function srpK(r,a,b,c,d,i){r[a]^=srpKey[4*i];r[b]^=srpKey[4*i+1];r[c]^=srpKey[4*i+2];r[d]^=srpKey[4*i+3];}\nfunction srpLK(r,a,b,c,d,e,i){r[a]=rotw(r[a],13);r[c]=rotw(r[c],3);r[b]^=r[a];r[e]=(r[a]\x3C\x3C3)\&MAXINT;r[d]^=r[c];r[b]^=r[c];r[b]=rotw(r[b],1);r[d]^=r[e];r[d]=rotw(r[d],7);r[e]=r[b];r[a]^=r[b];r[e]=(r[e]\x3C\x3C7)\&MAXINT;r[c]^=r[d];r[a]^=r[d];r[c]^=r[e];r[d]^=srpKey[4*i+3];r[b]^=srpKey[4*i+1];r[a]=rotw(r[a],5);r[c]=rotw(r[c],22);r[a]^=srpKey[4*i+0];r[c]^=srpKey[4*i+2];}\nfunction srpKL(r,a,b,c,d,e,i){r[a]^=srpKey[4*i+0];r[b]^=srpKey[4*i+1];r[c]^=srpKey[4*i+2];r[d]^=srpKey[4*i+3];r[a]=rotw(r[a],27);r[c]=rotw(r[c],10);r[e]=r[b];r[c]^=r[d];r[a]^=r[d];r[e]=(r[e]\x3C\x3C7)\&MAXINT;r[a]^=r[b];r[b]=rotw(r[b],31);r[c]^=r[e];r[d]=rotw(r[d],25);r[e]=(r[a]\x3C\x3C3)\&MAXINT;r[b]^=r[a];r[d]^=r[e];r[a]=rotw(r[a],19);r[b]^=r[c];r[d]^=r[c];r[c]=rotw(r[c],29);}\nvar srpS=[function(r,x0,x1,x2,x3,x4){r[x4]=r[x3];r[x3]|=r[x0];r[x0]^=r[x4];r[x4]^=r[x2];r[x4]=~r[x4];r[x3]^=r[x1];r[x1]\&=r[x0];r[x1]^=r[x4];r[x2]^=r[x0];r[x0]^=r[x3];r[x4]|=r[x0];r[x0]^=r[x2];r[x2]\&=r[x1];r[x3]^=r[x2];r[x1]=~r[x1];r[x2]^=r[x4];r[x1]^=r[x2];},function(r,x0,x1,x2,x3,x4){r[x4]=r[x1];r[x1]^=r[x0];r[x0]^=r[x3];r[x3]=~r[x3];r[x4]\&=r[x1];r[x0]|=r[x1];r[x3]^=r[x2];r[x0]^=r[x3];r[x1]^=r[x3];r[x3]^=r[x4];r[x1]|=r[x4];r[x4]^=r[x2];r[x2]\&=r[x0];r[x2]^=r[x1];r[x1]|=r[x0];r[x0]=~r[x0];r[x0]^=r[x2];r[x4]^=r[x1];},function(r,x0,x1,x2,x3,x4){r[x3]=~r[x3];r[x1]^=r[x0];r[x4]=r[x0];r[x0]\&=r[x2];r[x0]^=r[x3];r[x3]|=r[x4];r[x2]^=r[x1];r[x3]^=r[x1];r[x1]\&=r[x0];r[x0]^=r[x2];r[x2]\&=r[x3];r[x3]|=r[x1];r[x0]=~r[x0];r[x3]^=r[x0];r[x4]^=r[x0];r[x0]^=r[x2];r[x1]|=r[x2];},function(r,x0,x1,x2,x3,x4){r[x4]=r[x1];r[x1]^=r[x3];r[x3]|=r[x0];r[x4]\&=r[x0];r[x0]^=r[x2];r[x2]^=r[x1];r[x1]\&=r[x3];r[x2]^=r[x3];r[x0]|=r[x4];r[x4]^=r[x3];r[x1]^=r[x0];r[x0]\&=r[x3];r[x3]\&=r[x4];r[x3]^=r[x2];r[x4]|=r[x1];r[x2]\&=r[x1];r[x4]^=r[x3];r[x0]^=r[x3];r[x3]^=r[x2];},function(r,x0,x1,x2,x3,x4){r[x4]=r[x3];r[x3]\&=r[x0];r[x0]^=r[x4];r[x3]^=r[x2];r[x2]|=r[x4];r[x0]^=r[x1];r[x4]^=r[x3];r[x2]|=r[x0];r[x2]^=r[x1];r[x1]\&=r[x0];r[x1]^=r[x4];r[x4]\&=r[x2];r[x2]^=r[x3];r[x4]^=r[x0];r[x3]|=r[x1];r[x1]=~r[x1];r[x3]^=r[x0];},function(r,x0,x1,x2,x3,x4){r[x4]=r[x1];r[x1]|=r[x0];r[x2]^=r[x1];r[x3]=~r[x3];r[x4]^=r[x0];r[x0]^=r[x2];r[x1]\&=r[x4];r[x4]|=r[x3];r[x4]^=r[x0];r[x0]\&=r[x3];r[x1]^=r[x3];r[x3]^=r[x2];r[x0]^=r[x1];r[x2]\&=r[x4];r[x1]^=r[x2];r[x2]\&=r[x0];r[x3]^=r[x2];},function(r,x0,x1,x2,x3,x4){r[x4]=r[x1];r[x3]^=r[x0];r[x1]^=r[x2];r[x2]^=r[x0];r[x0]\&=r[x3];r[x1]|=r[x3];r[x4]=~r[x4];r[x0]^=r[x1];r[x1]^=r[x2];r[x3]^=r[x4];r[x4]^=r[x0];r[x2]\&=r[x0];r[x4]^=r[x1];r[x2]^=r[x3];r[x3]\&=r[x1];r[x3]^=r[x0];r[x1]^=r[x2];},function(r,x0,x1,x2,x3,x4){r[x1]=~r[x1];r[x4]=r[x1];r[x0]=~r[x0];r[x1]\&=r[x2];r[x1]^=r[x3];r[x3]|=r[x4];r[x4]^=r[x2];r[x2]^=r[x3];r[x3]^=r[x0];r[x0]|=r[x1];r[x2]\&=r[x0];r[x0]^=r[x4];r[x4]^=r[x3];r[x3]\&=r[x0];r[x4]^=r[x1];r[x2]^=r[x4];r[x3]^=r[x1];r[x4]|=r[x0];r[x4]^=r[x1];}];var srpSI=[function(r,x0,x1,x2,x3,x4){r[x4]=r[x3];r[x1]^=r[x0];r[x3]|=r[x1];r[x4]^=r[x1];r[x0]=~r[x0];r[x2]^=r[x3];r[x3]^=r[x0];r[x0]\&=r[x1];r[x0]^=r[x2];r[x2]\&=r[x3];r[x3]^=r[x4];r[x2]^=r[x3];r[x1]^=r[x3];r[x3]\&=r[x0];r[x1]^=r[x0];r[x0]^=r[x2];r[x4]^=r[x3];},function(r,x0,x1,x2,x3,x4){r[x1]^=r[x3];r[x4]=r[x0];r[x0]^=r[x2];r[x2]=~r[x2];r[x4]|=r[x1];r[x4]^=r[x3];r[x3]\&=r[x1];r[x1]^=r[x2];r[x2]\&=r[x4];r[x4]^=r[x1];r[x1]|=r[x3];r[x3]^=r[x0];r[x2]^=r[x0];r[x0]|=r[x4];r[x2]^=r[x4];r[x1]^=r[x0];r[x4]^=r[x1];},function(r,x0,x1,x2,x3,x4){r[x2]^=r[x1];r[x4]=r[x3];r[x3]=~r[x3];r[x3]|=r[x2];r[x2]^=r[x4];r[x4]^=r[x0];r[x3]^=r[x1];r[x1]|=r[x2];r[x2]^=r[x0];r[x1]^=r[x4];r[x4]|=r[x3];r[x2]^=r[x3];r[x4]^=r[x2];r[x2]\&=r[x1];r[x2]^=r[x3];r[x3]^=r[x4];r[x4]^=r[x0];},function(r,x0,x1,x2,x3,x4){r[x2]^=r[x1];r[x4]=r[x1];r[x1]\&=r[x2];r[x1]^=r[x0];r[x0]|=r[x4];r[x4]^=r[x3];r[x0]^=r[x3];r[x3]|=r[x1];r[x1]^=r[x2];r[x1]^=r[x3];r[x0]^=r[x2];r[x2]^=r[x3];r[x3]\&=r[x1];r[x1]^=r[x0];r[x0]\&=r[x2];r[x4]^=r[x3];r[x3]^=r[x0];r[x0]^=r[x1];},function(r,x0,x1,x2,x3,x4){r[x2]^=r[x3];r[x4]=r[x0];r[x0]\&=r[x1];r[x0]^=r[x2];r[x2]|=r[x3];r[x4]=~r[x4];r[x1]^=r[x0];r[x0]^=r[x2];r[x2]\&=r[x4];r[x2]^=r[x0];r[x0]|=r[x4];r[x0]^=r[x3];r[x3]\&=r[x2];r[x4]^=r[x3];r[x3]^=r[x1];r[x1]\&=r[x0];r[x4]^=r[x1];r[x0]^=r[x3];},function(r,x0,x1,x2,x3,x4){r[x4]=r[x1];r[x1]|=r[x2];r[x2]^=r[x4];r[x1]^=r[x3];r[x3]\&=r[x4];r[x2]^=r[x3];r[x3]|=r[x0];r[x0]=~r[x0];r[x3]^=r[x2];r[x2]|=r[x0];r[x4]^=r[x1];r[x2]^=r[x4];r[x4]\&=r[x0];r[x0]^=r[x1];r[x1]^=r[x3];r[x0]\&=r[x2];r[x2]^=r[x3];r[x0]^=r[x2];r[x2]^=r[x4];r[x4]^=r[x3];},function(r,x0,x1,x2,x3,x4){r[x0]^=r[x2];r[x4]=r[x0];r[x0]\&=r[x3];r[x2]^=r[x3];r[x0]^=r[x2];r[x3]^=r[x1];r[x2]|=r[x4];r[x2]^=r[x3];r[x3]\&=r[x0];r[x0]=~r[x0];r[x3]^=r[x1];r[x1]\&=r[x2];r[x4]^=r[x0];r[x3]^=r[x4];r[x4]^=r[x2];r[x0]^=r[x1];r[x2]^=r[x0];},function(r,x0,x1,x2,x3,x4){r[x4]=r[x3];r[x3]\&=r[x0];r[x0]^=r[x2];r[x2]|=r[x4];r[x4]^=r[x1];r[x0]=~r[x0];r[x1]|=r[x3];r[x4]^=r[x0];r[x0]\&=r[x2];r[x0]^=r[x1];r[x1]\&=r[x2];r[x3]^=r[x2];r[x4]^=r[x3];r[x2]\&=r[x3];r[x3]|=r[x0];r[x1]^=r[x4];r[x3]^=r[x4];r[x4]\&=r[x0];r[x4]^=r[x2];}];var srpKc=[7788,63716,84032,7891,78949,25146,28835,67288,84032,40055,7361,1940,77639,27525,24193,75702,7361,35413,83150,82383,58619,48468,18242,66861,83150,69667,7788,31552,40054,23222,52496,57565,7788,63716];var srpEc=[44255,61867,45034,52496,73087,56255,43827,41448,18242,1939,18581,56255,64584,31097,26469,77728,77639,4216,64585,31097,66861,78949,58006,59943,49676,78950,5512,78949,27525,52496,18670,76143];var srpDc=[44255,60896,28835,1837,1057,4216,18242,77301,47399,53992,1939,1940,66420,39172,78950,45917,82383,7450,67288,26469,83149,57565,66419,47400,58006,44254,18581,18228,33048,45034,66508,7449];function srpInit(key){keyBytes=key;var i,j,m,n;function keyIt(a,b,c,d,i){srpKey[i]=r[b]=rotw(srpKey[a]^r[b]^r[c]^r[d]^0x9e3779b9^i,11);}\nfunction keyLoad(a,b,c,d,i){r[a]=srpKey[i];r[b]=srpKey[i+1];r[c]=srpKey[i+2];r[d]=srpKey[i+3];}\nfunction keyStore(a,b,c,d,i){srpKey[i]=r[a];srpKey[i+1]=r[b];srpKey[i+2]=r[c];srpKey[i+3]=r[d];}\nkeyBytes.reverse();keyBytes[keyBytes.length]=1;while(keyBytes.length\x3C32)keyBytes[keyBytes.length]=0;for(i=0;i\x3C8;i++){srpKey[i]=(keyBytes[4*i+0]\&0xff)|(keyBytes[4*i+1]\&0xff)\x3C\x3C8|(keyBytes[4*i+2]\&0xff)\x3C\x3C16|(keyBytes[4*i+3]\&0xff)\x3C\x3C24;}\nvar r=[srpKey[3],srpKey[4],srpKey[5],srpKey[6],srpKey[7]];i=0;j=0;while(keyIt(j++,0,4,2,i++),keyIt(j++,1,0,3,i++),i\x3C132){keyIt(j++,2,1,4,i++);if(i==8){j=0;}\nkeyIt(j++,3,2,0,i++);keyIt(j++,4,3,1,i++);}\ni=128;j=3;n=0;while(m=srpKc[n++],srpS[j++%8](r,m%5,m%7,m%11,m%13,m%17),m=srpKc[n],keyStore(m%5,m%7,m%11,m%13,i),i\x3E0){i-=4;keyLoad(m%5,m%7,m%11,m%13,i);}}\nfunction srpClose(){srpKey=[];}\nfunction srpEncrypt(data,offset){dataBytes=data;dataOffset=offset;var blk=dataBytes.slice(dataOffset,dataOffset+16);blk.reverse();var r=[getW(blk,0),getW(blk,4),getW(blk,8),getW(blk,12)];srpK(r,0,1,2,3,0);var n=0,m=srpEc[n];while(srpS[n%8](r,m%5,m%7,m%11,m%13,m%17),n\x3C31){m=srpEc[++n];srpLK(r,m%5,m%7,m%11,m%13,m%17,n);}\nsrpK(r,0,1,2,3,32);for(var j=3;j\x3E=0;j--,dataOffset+=4)setWInv(dataBytes,dataOffset,r[j]);}\nfunction srpDecrypt(data,offset){dataBytes=data;dataOffset=offset;var blk=dataBytes.slice(dataOffset,dataOffset+16);blk.reverse();var r=[getW(blk,0),getW(blk,4),getW(blk,8),getW(blk,12)];srpK(r,0,1,2,3,32);var n=0,m=srpDc[n];while(srpSI[7-n%8](r,m%5,m%7,m%11,m%13,m%17),n\x3C31){m=srpDc[++n];srpKL(r,m%5,m%7,m%11,m%13,m%17,32-n);}\nsrpK(r,2,3,1,4,0);setWInv(dataBytes,dataOffset,r[4]);setWInv(dataBytes,dataOffset+4,r[1]);setWInv(dataBytes,dataOffset+8,r[3]);setWInv(dataBytes,dataOffset+12,r[2]);dataOffset+=16;}\nreturn{name:\"serpent\",blocksize:128\x2F8,open:srpInit,close:srpClose,encrypt:srpEncrypt,decrypt:srpDecrypt};}\nALGORITHMS.SERPENT={create:createSerpent};function createTwofish(){var keyBytes=null;var dataBytes=null;var dataOffset=-1;var algorithmName=null;algorithmName=\"twofish\";var tfsKey=[];var tfsM=[[],[],[],[]];function tfsInit(key){keyBytes=key;var i,a,b,c,d,meKey=[],moKey=[],inKey=[];var kLen;var sKey=[];var f01,f5b,fef;var q0=[[8,1,7,13,6,15,3,2,0,11,5,9,14,12,10,4],[2,8,11,13,15,7,6,14,3,1,9,4,0,10,12,5]];var q1=[[14,12,11,8,1,2,3,5,15,4,10,6,7,0,9,13],[1,14,2,11,4,12,3,7,6,13,10,5,15,9,0,8]];var q2=[[11,10,5,14,6,13,9,0,12,8,15,3,2,4,7,1],[4,12,7,5,1,6,9,10,0,14,13,8,2,11,3,15]];var q3=[[13,7,15,4,1,2,6,14,9,11,3,0,8,5,12,10],[11,9,5,1,12,3,13,14,6,4,7,15,2,0,8,10]];var ror4=[0,8,1,9,2,10,3,11,4,12,5,13,6,14,7,15];var ashx=[0,9,2,11,4,13,6,15,8,1,10,3,12,5,14,7];var q=[[],[]];var m=[[],[],[],[]];function ffm5b(x){return x^(x\x3E\x3E2)^[0,90,180,238][x\&3];}\nfunction ffmEf(x){return x^(x\x3E\x3E1)^(x\x3E\x3E2)^[0,238,180,90][x\&3];}\nfunction mdsRem(p,q){var i,t,u;for(i=0;i\x3C8;i++){t=q\x3E\x3E\x3E24;q=((q\x3C\x3C8)\&MAXINT)|p\x3E\x3E\x3E24;p=(p\x3C\x3C8)\&MAXINT;u=t\x3C\x3C1;if(t\&128){u^=333;}\nq^=t^(u\x3C\x3C16);u^=t\x3E\x3E\x3E1;if(t\&1){u^=166;}\nq^=u\x3C\x3C24|u\x3C\x3C8;}\nreturn q;}\nfunction qp(n,x){var a,b,c,d;a=x\x3E\x3E4;b=x\&15;c=q0[n][a^b];d=q1[n][ror4[b]^ashx[a]];return q3[n][ror4[d]^ashx[c]]\x3C\x3C4|q2[n][c^d];}\nfunction hFun(x,key){var a=getB(x,0),b=getB(x,1),c=getB(x,2),d=getB(x,3);switch(kLen){case 4:a=q[1][a]^getB(key[3],0);b=q[0][b]^getB(key[3],1);c=q[0][c]^getB(key[3],2);d=q[1][d]^getB(key[3],3);case 3:a=q[1][a]^getB(key[2],0);b=q[1][b]^getB(key[2],1);c=q[0][c]^getB(key[2],2);d=q[0][d]^getB(key[2],3);case 2:a=q[0][q[0][a]^getB(key[1],0)]^getB(key[0],0);b=q[0][q[1][b]^getB(key[1],1)]^getB(key[0],1);c=q[1][q[0][c]^getB(key[1],2)]^getB(key[0],2);d=q[1][q[1][d]^getB(key[1],3)]^getB(key[0],3);}\nreturn m[0][a]^m[1][b]^m[2][c]^m[3][d];}\nkeyBytes=keyBytes.slice(0,32);i=keyBytes.length;while(i!=16\&\&i!=24\&\&i!=32)keyBytes[i++]=0;for(i=0;i\x3CkeyBytes.length;i+=4){inKey[i\x3E\x3E2]=getW(keyBytes,i);}\nfor(i=0;i\x3C256;i++){q[0][i]=qp(0,i);q[1][i]=qp(1,i);}\nfor(i=0;i\x3C256;i++){f01=q[1][i];f5b=ffm5b(f01);fef=ffmEf(f01);m[0][i]=f01+(f5b\x3C\x3C8)+(fef\x3C\x3C16)+(fef\x3C\x3C24);m[2][i]=f5b+(fef\x3C\x3C8)+(f01\x3C\x3C16)+(fef\x3C\x3C24);f01=q[0][i];f5b=ffm5b(f01);fef=ffmEf(f01);m[1][i]=fef+(fef\x3C\x3C8)+(f5b\x3C\x3C16)+(f01\x3C\x3C24);m[3][i]=f5b+(f01\x3C\x3C8)+(fef\x3C\x3C16)+(f5b\x3C\x3C24);}\nkLen=inKey.length\x2F2;for(i=0;i\x3CkLen;i++){a=inKey[i+i];meKey[i]=a;b=inKey[i+i+1];moKey[i]=b;sKey[kLen-i-1]=mdsRem(a,b);}\nfor(i=0;i\x3C40;i+=2){a=0x1010101*i;b=a+0x1010101;a=hFun(a,meKey);b=rotw(hFun(b,moKey),8);tfsKey[i]=(a+b)\&MAXINT;tfsKey[i+1]=rotw(a+2*b,9);}\nfor(i=0;i\x3C256;i++){a=b=c=d=i;switch(kLen){case 4:a=q[1][a]^getB(sKey[3],0);b=q[0][b]^getB(sKey[3],1);c=q[0][c]^getB(sKey[3],2);d=q[1][d]^getB(sKey[3],3);case 3:a=q[1][a]^getB(sKey[2],0);b=q[1][b]^getB(sKey[2],1);c=q[0][c]^getB(sKey[2],2);d=q[0][d]^getB(sKey[2],3);case 2:tfsM[0][i]=m[0][q[0][q[0][a]^getB(sKey[1],0)]^getB(sKey[0],0)];tfsM[1][i]=m[1][q[0][q[1][b]^getB(sKey[1],1)]^getB(sKey[0],1)];tfsM[2][i]=m[2][q[1][q[0][c]^getB(sKey[1],2)]^getB(sKey[0],2)];tfsM[3][i]=m[3][q[1][q[1][d]^getB(sKey[1],3)]^getB(sKey[0],3)];}}}\nfunction tfsG0(x){return tfsM[0][getB(x,0)]^tfsM[1][getB(x,1)]^tfsM[2][getB(x,2)]^tfsM[3][getB(x,3)];}\nfunction tfsG1(x){return tfsM[0][getB(x,3)]^tfsM[1][getB(x,0)]^tfsM[2][getB(x,1)]^tfsM[3][getB(x,2)];}\nfunction tfsFrnd(r,blk){var a=tfsG0(blk[0]);var b=tfsG1(blk[1]);blk[2]=rotw(blk[2]^(a+b+tfsKey[4*r+8])\&MAXINT,31);blk[3]=rotw(blk[3],1)^(a+2*b+tfsKey[4*r+9])\&MAXINT;a=tfsG0(blk[2]);b=tfsG1(blk[3]);blk[0]=rotw(blk[0]^(a+b+tfsKey[4*r+10])\&MAXINT,31);blk[1]=rotw(blk[1],1)^(a+2*b+tfsKey[4*r+11])\&MAXINT;}\nfunction tfsIrnd(i,blk){var a=tfsG0(blk[0]);var b=tfsG1(blk[1]);blk[2]=rotw(blk[2],1)^(a+b+tfsKey[4*i+10])\&MAXINT;blk[3]=rotw(blk[3]^(a+2*b+tfsKey[4*i+11])\&MAXINT,31);a=tfsG0(blk[2]);b=tfsG1(blk[3]);blk[0]=rotw(blk[0],1)^(a+b+tfsKey[4*i+8])\&MAXINT;blk[1]=rotw(blk[1]^(a+2*b+tfsKey[4*i+9])\&MAXINT,31);}\nfunction tfsClose(){tfsKey=[];tfsM=[[],[],[],[]];}\nfunction tfsEncrypt(data,offset){dataBytes=data;dataOffset=offset;var blk=[getW(dataBytes,dataOffset)^tfsKey[0],getW(dataBytes,dataOffset+4)^tfsKey[1],getW(dataBytes,dataOffset+8)^tfsKey[2],getW(dataBytes,dataOffset+12)^tfsKey[3]];for(var j=0;j\x3C8;j++){tfsFrnd(j,blk);}\nsetW(dataBytes,dataOffset,blk[2]^tfsKey[4]);setW(dataBytes,dataOffset+4,blk[3]^tfsKey[5]);setW(dataBytes,dataOffset+8,blk[0]^tfsKey[6]);setW(dataBytes,dataOffset+12,blk[1]^tfsKey[7]);dataOffset+=16;}\nfunction tfsDecrypt(data,offset){dataBytes=data;dataOffset=offset;var blk=[getW(dataBytes,dataOffset)^tfsKey[4],getW(dataBytes,dataOffset+4)^tfsKey[5],getW(dataBytes,dataOffset+8)^tfsKey[6],getW(dataBytes,dataOffset+12)^tfsKey[7]];for(var j=7;j\x3E=0;j--){tfsIrnd(j,blk);}\nsetW(dataBytes,dataOffset,blk[2]^tfsKey[0]);setW(dataBytes,dataOffset+4,blk[3]^tfsKey[1]);setW(dataBytes,dataOffset+8,blk[0]^tfsKey[2]);setW(dataBytes,dataOffset+12,blk[1]^tfsKey[3]);dataOffset+=16;}\nreturn{name:\"twofish\",blocksize:128\x2F8,open:tfsInit,close:tfsClose,encrypt:tfsEncrypt,decrypt:tfsDecrypt};}\nALGORITHMS.TWOFISH={create:createTwofish};var MODES={};function createECB(){function encryptOpenECB(){this.algorithm.open(this.keyBytes);this.dataLength=this.dataBytes.length;this.dataOffset=0;return;}\nfunction encryptCloseECB(){this.algorithm.close();}\nfunction encryptProcECB(){this.algorithm.encrypt(this.dataBytes,this.dataOffset);this.dataOffset+=this.algorithm.blocksize;if(this.dataLength\x3C=this.dataOffset){return 0;}else{return this.dataLength-this.dataOffset;}}\nfunction decryptOpenECB(){this.algorithm.open(this.keyBytes);this.dataLength=this.dataBytes.length;this.dataOffset=0;return;}\nfunction decryptProcECB(){this.algorithm.decrypt(this.dataBytes,this.dataOffset);this.dataOffset+=this.algorithm.blocksize;if(this.dataLength\x3C=this.dataOffset){return 0;}else{return this.dataLength-this.dataOffset;}}\nfunction decryptCloseECB(){this.algorithm.close();while(this.dataBytes[this.dataBytes.length-1]==0)\nthis.dataBytes.pop();}\nreturn{encrypt:{open:encryptOpenECB,exec:encryptProcECB,close:encryptCloseECB},decrypt:{open:decryptOpenECB,exec:decryptProcECB,close:decryptCloseECB}};}\nMODES.ECB=createECB();function createCBC(){function encryptOpenCBC(){this.algorithm.open(this.keyBytes);this.dataBytes.unshift(randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte(),randByte());this.dataLength=this.dataBytes.length;this.dataOffset=16;return;}\nfunction encryptProcCBC(){for(var idx2=this.dataOffset;idx2\x3Cthis.dataOffset+16;idx2++)\nthis.dataBytes[idx2]^=this.dataBytes[idx2-16];this.algorithm.encrypt(this.dataBytes,this.dataOffset);this.dataOffset+=this.algorithm.blocksize;if(this.dataLength\x3C=this.dataOffset){return 0;}else{return this.dataLength-this.dataOffset;}}\nfunction encryptCloseCBC(){this.algorithm.close();}\nfunction decryptOpenCBC(){this.algorithm.open(this.keyBytes);this.dataLength=this.dataBytes.length;this.dataOffset=16;this.iv=this.dataBytes.slice(0,16);return;}\nfunction decryptProcCBC(){var iv2=this.dataBytes.slice(this.dataOffset,this.dataOffset+16);this.algorithm.decrypt(this.dataBytes,this.dataOffset);for(var ii=0;ii\x3C16;ii++)\nthis.dataBytes[this.dataOffset+ii]^=this.iv[ii];this.dataOffset+=this.algorithm.blocksize;this.iv=iv2;if(this.dataLength\x3C=this.dataOffset){return 0;}else{return this.dataLength-this.dataOffset;}}\nfunction decryptCloseCBC(){this.algorithm.close();this.dataBytes.splice(0,16);while(this.dataBytes[this.dataBytes.length-1]==0)\nthis.dataBytes.pop();}\nreturn{encrypt:{open:encryptOpenCBC,exec:encryptProcCBC,close:encryptCloseCBC},decrypt:{open:decryptOpenCBC,exec:decryptProcCBC,close:decryptCloseCBC}};}\nMODES.CBC=createCBC();function createCFB(){function encryptOpenCFB(){throw\"not implemented!\";}\nfunction encryptProcCFB(){throw\"not implemented!\";}\nfunction encryptCloseCFB(){throw\"not implemented!\";}\nfunction decryptOpenCFB(){throw\"not implemented!\";}\nfunction decryptProcCFB(){throw\"not implemented!\";}\nfunction decryptCloseCFB(){throw\"not implemented!\";}\nreturn{encrypt:{open:encryptOpenCFB,exec:encryptProcCFB,close:encryptCloseCFB},decrypt:{open:decryptOpenCFB,exec:decryptProcCFB,close:decryptCloseCFB}};}\nMODES.CFB=createCFB();function createOFB(){function encryptOpenOFB(){throw\"not implemented!\";}\nfunction encryptProcOFB(){throw\"not implemented!\";}\nfunction encryptCloseOFB(){throw\"not implemented!\";}\nfunction decryptOpenOFB(){throw\"not implemented!\";}\nfunction decryptProcOFB(){throw\"not implemented!\";}\nfunction decryptCloseOFB(){throw\"not implemented!\";}\nreturn{encrypt:{open:encryptOpenOFB,exec:encryptProcOFB,close:encryptCloseOFB},decrypt:{open:decryptOpenOFB,exec:decryptProcOFB,close:decryptCloseOFB}};}\nMODES.OFB=createOFB();function createCTR(){function encryptOpenCTR(){throw\"not implemented!\";}\nfunction encryptProcCTR(){throw\"not implemented!\";}\nfunction encryptCloseCTR(){throw\"not implemented!\";}\nfunction decryptOpenCTR(){throw\"not implemented!\";}\nfunction decryptProcCTR(){throw\"not implemented!\";}\nfunction decryptCloseCTR(){throw\"not implemented!\";}\nreturn{encrypt:{open:encryptOpenCTR,exec:encryptProcCTR,close:encryptCloseCTR},decrypt:{open:decryptOpenCTR,exec:decryptProcCTR,close:decryptCloseCTR}};}\nMODES.CTR=createCTR();var PADDINGS={};function createRFC1321(){function appendPaddingRFC1321(data){var len=16-(data.length%16);data.push(0x80);for(var i=1;i\x3Clen;i++){data.push(0x00);}\nreturn data;}\nfunction removePaddingRFC1321(data){for(var i=data.length-1;0\x3C=i;i--){var val=data[i];if(val==0x80){data.splice(i);break;}else if(val!=0x00){break;}}\nreturn data;}\nreturn{append:appendPaddingRFC1321,remove:removePaddingRFC1321};};PADDINGS.RFC1321=createRFC1321();function createANSIX923(){function appendPaddingANSIX923(data){var len=16-(data.length%16);for(var i=0;i\x3Clen-1;i++){data.push(0x00);}\ndata.push(len);return data;}\nfunction removePaddingANSIX923(data){var len=data.pop();if(16\x3Clen)len=16;for(var i=1;i\x3Clen;i++){data.pop();}\nreturn data;}\nreturn{append:appendPaddingANSIX923,remove:removePaddingANSIX923};}\nPADDINGS.ANSIX923=createANSIX923();function createISO10126(){function appendPaddingISO10126(data){var len=16-(data.length%16);for(var i=0;i\x3Clen-1;i++){data.push(randByte());}\ndata.push(len);return data;}\nfunction removePaddingISO10126(data){var len=data.pop();if(16\x3Clen)len=16;for(var i=1;i\x3Clen;i++){data.pop();}\nreturn data;}\nreturn{append:appendPaddingISO10126,remove:removePaddingISO10126};}\nPADDINGS.ISO10126=createISO10126();function createPKCS7(){function appendPaddingPKCS7(data){var len=16-(data.length%16);for(var i=0;i\x3Clen;i++){data.push(len);}\nreturn data;}\nfunction removePaddingPKCS7(data){var len=data.pop();if(16\x3Clen)len=0;for(var i=1;i\x3Clen;i++){data.pop();}\nreturn data;}\nreturn{append:appendPaddingPKCS7,remove:removePaddingPKCS7};}\nPADDINGS.PKCS7=createPKCS7();function createNoPadding(){function appendPaddingNone(data){return data;}\nfunction removePaddingNone(data){return data;}\nreturn{append:appendPaddingNone,remove:removePaddingNone};}\nPADDINGS.NO_PADDING=createNoPadding();var DIRECTIONS={ENCRYPT:\"encrypt\",DECRYPT:\"decrypt\"};function Cipher(algorithm,direction,mode,padding){this.algorithm=algorithm;this.direction=direction;this.mode=mode;this.padding=padding;this.modeOpen=mode[direction].open;this.modeExec=mode[direction].exec;this.modeClose=mode[direction].close;this.keyBytes=null;this.dataBytes=null;this.dataOffset=-1;this.dataLength=-1;}\nCipher.prototype=new Object();Cipher.prototype.inherit=Cipher;function open(keyBytes,dataBytes){if(keyBytes==null)throw\"keyBytes is null\";if(dataBytes==null)throw\"dataBytes is null\";this.keyBytes=keyBytes.concat();this.dataBytes=dataBytes;this.dataOffset=0;this.dataLength=dataBytes.length;if(this.direction==DIRECTIONS.ENCRYPT){this.padding.append(this.dataBytes);}\nthis.modeOpen();}\nfunction operate(){return this.modeExec();}\nfunction close(){this.modeClose();if(this.direction==DIRECTIONS.DECRYPT){this.padding.remove(this.dataBytes);}\nreturn this.dataBytes;}\nfunction execute(keyBytes,dataBytes){this.open(keyBytes,dataBytes);for(;;){var size=this.operate();if(0\x3Csize){continue;}else{break;}}\nreturn this.close();}\nCipher.prototype.open=open;Cipher.prototype.close=close;Cipher.prototype.operate=operate;Cipher.prototype.execute=execute;Cipher.ENCRYPT=\"ENCRYPT\";Cipher.DECRYPT=\"DECRYPT\";Cipher.RIJNDAEL=\"RIJNDAEL\";Cipher.SERPENT=\"SERPENT\";Cipher.TWOFISH=\"TWOFISH\";Cipher.ECB=\"ECB\";Cipher.CBC=\"CBC\";Cipher.CFB=\"CFB\";Cipher.OFB=\"OFB\";Cipher.CTR=\"CTR\";Cipher.RFC1321=\"RFC1321\";Cipher.ANSIX923=\"ANSIX923\";Cipher.ISO10126=\"ISO10126\";Cipher.PKCS7=\"PKCS7\";Cipher.NO_PADDING=\"NO_PADDING\";Cipher.create=function(algorithmName,directionName,modeName,paddingName){if(algorithmName==null)algorithmName=Cipher.RIJNDAEL;if(directionName==null)directionName=Cipher.ENCRYPT;if(modeName==null)modeName=Cipher.CBC;if(paddingName==null)paddingName=Cipher.PKCS7;var algorithm=ALGORITHMS[algorithmName];var direction=DIRECTIONS[directionName];var mode=MODES[modeName];var padding=PADDINGS[paddingName];if(algorithm==null)throw\"Invalid algorithm name \'\"+algorithmName+\"\'.\";if(direction==null)throw\"Invalid direction name \'\"+directionName+\"\'.\";if(mode==null)throw\"Invalid mode name \'\"+modeName+\"\'.\";if(padding==null)throw\"Invalid padding name \'\"+paddingName+\"\'.\";return new Cipher(algorithm.create(),direction,mode,padding);};Cipher.algorithm=function(algorithmName){if(algorithmName==null)throw\"Null Pointer Exception ( algorithmName )\";var algorithm=ALGORITHMS[algorithmName];if(algorithm==null)throw\"Invalid algorithm name \'\"+algorithmName+\"\'.\";return algorithm.create();}\n__Crypto.__export(packageRoot,\"titaniumcore.crypto.Cipher\",Cipher);}\ninitBlockCipher(__Crypto);function initRNG(packages){__Crypto.__unit(\"SecureRandom.js\");__Crypto.__uses(\"packages.js\");var Arcfour=function(){this.i=0;this.j=0;this.S=new Array();};Arcfour.prototype.init=function(key){var i,j,t;for(i=0;i\x3C256;++i)\nthis.S[i]=i;j=0;for(i=0;i\x3C256;++i){j=(j+this.S[i]+key[i%key.length])\&255;t=this.S[i];this.S[i]=this.S[j];this.S[j]=t;}\nthis.i=0;this.j=0;};Arcfour.prototype.next=function(){var t;this.i=(this.i+1)\&255;this.j=(this.j+this.S[this.i])\&255;t=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=t;return this.S[(t+this.S[this.i])\&255];};Arcfour.create=function(){return new Arcfour();};Arcfour.rng_psize=256;var rng_state=null;var rng_pool=[];var rng_pptr=0;rng_seed_int=function(x){rng_pool[rng_pptr]^=x\&255;rng_pptr++;rng_pool[rng_pptr]^=(x\x3E\x3E8)\&255;rng_pptr++;rng_pool[rng_pptr]^=(x\x3E\x3E16)\&255;rng_pptr++;rng_pool[rng_pptr]^=(x\x3E\x3E24)\&255;rng_pptr++;if(rng_pptr\x3E=Arcfour.rng_psize)rng_pptr-=Arcfour.rng_psize;};rng_seed_time=function(){rng_seed_int(new Date().getTime());};pool_init=function(){var t;while(rng_pptr\x3CArcfour.rng_psize){t=Math.floor(65536*Math.random());rng_pool[rng_pptr++]=t\x3E\x3E\x3E8;rng_pool[rng_pptr++]=t\&255;}\nrng_pptr=0;rng_seed_time();};var rng_get_byte=function(){if(rng_state==null){rng_seed_time();rng_state=Arcfour.create();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr\x3Crng_pool.length;++rng_pptr)\nrng_pool[rng_pptr]=0;rng_pptr=0;}\nreturn rng_state.next();};var SecureRandom=function(){};SecureRandom.prototype.nextBytes=function(ba){for(var i=0;i\x3Cba.length;++i)\nba[i]=rng_get_byte();};pool_init();__Crypto.__export(packages,\"titaniumcore.crypto.SecureRandom\",SecureRandom);};initRNG(__Crypto);var hexcase=0;var b64pad=\"\";function hex_md5(s){return rstr2hex(rstr_md5(str2rstr_utf8(s)));}\nfunction b64_md5(s){return rstr2b64(rstr_md5(str2rstr_utf8(s)));}\nfunction any_md5(s,e){return rstr2any(rstr_md5(str2rstr_utf8(s)),e);}\nfunction hex_hmac_md5(k,d)\n{return rstr2hex(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)));}\nfunction b64_hmac_md5(k,d)\n{return rstr2b64(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)));}\nfunction any_hmac_md5(k,d,e)\n{return rstr2any(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)),e);}\nfunction md5_vm_test()\n{return hex_md5(\"abc\").toLowerCase()==\"900150983cd24fb0d6963f7d28e17f72\";}\nfunction rstr_md5(s)\n{return binl2rstr(binl_md5(rstr2binl(s),s.length*8));}\nfunction rstr_hmac_md5(key,data)\n{var bkey=rstr2binl(key);if(bkey.length\x3E16)bkey=binl_md5(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i\x3C16;i++)\n{ipad[i]=bkey[i]^0x36363636;opad[i]=bkey[i]^0x5C5C5C5C;}\nvar hash=binl_md5(ipad.concat(rstr2binl(data)),512+data.length*8);return binl2rstr(binl_md5(opad.concat(hash),512+128));}\nfunction rstr2hex(input)\n{try{hexcase}catch(e){hexcase=0;}\nvar hex_tab=hexcase?\"0123456789ABCDEF\":\"0123456789abcdef\";var output=\"\";var x;for(var i=0;i\x3Cinput.length;i++)\n{x=input.charCodeAt(i);output+=hex_tab.charAt((x\x3E\x3E\x3E4)\&0x0F)\n+hex_tab.charAt(x\&0x0F);}\nreturn output;}\nfunction rstr2b64(input)\n{try{b64pad}catch(e){b64pad=\'\';}\nvar tab=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+\x2F\";var output=\"\";var len=input.length;for(var i=0;i\x3Clen;i+=3)\n{var triplet=(input.charCodeAt(i)\x3C\x3C16)|(i+1\x3Clen?input.charCodeAt(i+1)\x3C\x3C8:0)|(i+2\x3Clen?input.charCodeAt(i+2):0);for(var j=0;j\x3C4;j++)\n{if(i*8+j*6\x3Einput.length*8)output+=b64pad;else output+=tab.charAt((triplet\x3E\x3E\x3E6*(3-j))\&0x3F);}}\nreturn output;}\nfunction rstr2any(input,encoding)\n{var divisor=encoding.length;var i,j,q,x,quotient;var dividend=Array(Math.ceil(input.length\x2F2));for(i=0;i\x3Cdividend.length;i++)\n{dividend[i]=(input.charCodeAt(i*2)\x3C\x3C8)|input.charCodeAt(i*2+1);}\nvar full_length=Math.ceil(input.length*8\x2F(Math.log(encoding.length)\x2FMath.log(2)));var remainders=Array(full_length);for(j=0;j\x3Cfull_length;j++)\n{quotient=Array();x=0;for(i=0;i\x3Cdividend.length;i++)\n{x=(x\x3C\x3C16)+dividend[i];q=Math.floor(x\x2Fdivisor);x-=q*divisor;if(quotient.length\x3E0||q\x3E0)\nquotient[quotient.length]=q;}\nremainders[j]=x;dividend=quotient;}\nvar output=\"\";for(i=remainders.length-1;i\x3E=0;i--)\noutput+=encoding.charAt(remainders[i]);return output;}\nfunction str2rstr_utf8(input)\n{var output=\"\";var i=-1;var x,y;while(++i\x3Cinput.length)\n{x=input.charCodeAt(i);y=i+1\x3Cinput.length?input.charCodeAt(i+1):0;if(0xD800\x3C=x\&\&x\x3C=0xDBFF\&\&0xDC00\x3C=y\&\&y\x3C=0xDFFF)\n{x=0x10000+((x\&0x03FF)\x3C\x3C10)+(y\&0x03FF);i++;}\nif(x\x3C=0x7F)\noutput+=String.fromCharCode(x);else if(x\x3C=0x7FF)\noutput+=String.fromCharCode(0xC0|((x\x3E\x3E\x3E6)\&0x1F),0x80|(x\&0x3F));else if(x\x3C=0xFFFF)\noutput+=String.fromCharCode(0xE0|((x\x3E\x3E\x3E12)\&0x0F),0x80|((x\x3E\x3E\x3E6)\&0x3F),0x80|(x\&0x3F));else if(x\x3C=0x1FFFFF)\noutput+=String.fromCharCode(0xF0|((x\x3E\x3E\x3E18)\&0x07),0x80|((x\x3E\x3E\x3E12)\&0x3F),0x80|((x\x3E\x3E\x3E6)\&0x3F),0x80|(x\&0x3F));}\nreturn output;}\nfunction str2rstr_utf16le(input)\n{var output=\"\";for(var i=0;i\x3Cinput.length;i++)\noutput+=String.fromCharCode(input.charCodeAt(i)\&0xFF,(input.charCodeAt(i)\x3E\x3E\x3E8)\&0xFF);return output;}\nfunction str2rstr_utf16be(input)\n{var output=\"\";for(var i=0;i\x3Cinput.length;i++)\noutput+=String.fromCharCode((input.charCodeAt(i)\x3E\x3E\x3E8)\&0xFF,input.charCodeAt(i)\&0xFF);return output;}\nfunction rstr2binl(input)\n{var output=Array(input.length\x3E\x3E2);for(var i=0;i\x3Coutput.length;i++)\noutput[i]=0;for(var i=0;i\x3Cinput.length*8;i+=8)\noutput[i\x3E\x3E5]|=(input.charCodeAt(i\x2F8)\&0xFF)\x3C\x3C(i%32);return output;}\nfunction binl2rstr(input)\n{var output=\"\";for(var i=0;i\x3Cinput.length*32;i+=8)\noutput+=String.fromCharCode((input[i\x3E\x3E5]\x3E\x3E\x3E(i%32))\&0xFF);return output;}\nfunction binl_md5(x,len)\n{x[len\x3E\x3E5]|=0x80\x3C\x3C((len)%32);x[(((len+64)\x3E\x3E\x3E9)\x3C\x3C4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i\x3Cx.length;i+=16)\n{var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);}\nreturn Array(a,b,c,d);}\nfunction md5_cmn(q,a,b,x,s,t)\n{return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b);}\nfunction md5_ff(a,b,c,d,x,s,t)\n{return md5_cmn((b\&c)|((~b)\&d),a,b,x,s,t);}\nfunction md5_gg(a,b,c,d,x,s,t)\n{return md5_cmn((b\&d)|(c\&(~d)),a,b,x,s,t);}\nfunction md5_hh(a,b,c,d,x,s,t)\n{return md5_cmn(b^c^d,a,b,x,s,t);}\nfunction md5_ii(a,b,c,d,x,s,t)\n{return md5_cmn(c^(b|(~d)),a,b,x,s,t);}\nfunction safe_add(x,y)\n{var lsw=(x\&0xFFFF)+(y\&0xFFFF);var msw=(x\x3E\x3E16)+(y\x3E\x3E16)+(lsw\x3E\x3E16);return(msw\x3C\x3C16)|(lsw\&0xFFFF);}\nfunction bit_rol(num,cnt)\n{return(num\x3C\x3Ccnt)|(num\x3E\x3E\x3E(32-cnt));}\nvar FeedHenryContainer=function(){var self={init:function(){self.paramsArray=new Array();self.fhClientArray=new Array();self.prefsArray=new Array();self.swaggerTimerArray=new Array();self.destinationArray=new Array();},addFhClient:function(fhClient){self.fhClientArray[fhClient.instance]=fhClient;},addInstance:function(widgetParams){self.paramsArray[widgetParams.instance]=widgetParams;if(typeof TimeRecorder!=\"undefined\"){var timer=new TimeRecorder(widgetParams.timerParams);self.addTimer(timer);}},addTimer:function(swaggerTimer){self.swaggerTimerArray[swaggerTimer.instance]=swaggerTimer;$fhjq(\'#widget_\'+swaggerTimer.instance).mouseenter(function(){var widgetInstance=$fhjq(this).attr(\'id\').substr(7);if(self.currentInstance!=widgetInstance){self.mouseIn(widgetInstance);self.currentInstance=widgetInstance;}}).mouseleave(function(){var widgetInstance=$fhjq(this).attr(\'id\').substr(7);if(self.currentInstance!=\'\'){self.mouseOut(widgetInstance);self.currentInstance=\'\';}});},getTimer:function(guid){var swaggerTimer=self.swaggerTimerArray[guid];return swaggerTimer;},mouseIn:function(guid){var swaggerTimer=self.swaggerTimerArray[guid];swaggerTimer.mouseIn();},mouseOut:function(guid){var swaggerTimer=self.swaggerTimerArray[guid];swaggerTimer.mouseOut();},watchTimer:function(guid){var swaggerTimer=self.swaggerTimerArray[guid];swaggerTimer.watchTimer();},getParams:function(guid){var containerParams=self.paramsArray[guid];var clientParams=self.fhClientArray[guid];var params=new Object();params.container=containerParams;params.client=clientParams;return params;},getFhClient:function(guid){var fhclient=self.fhClientArray[guid];return fhclient;},getElementById:function(elementName,guid){var element=$fhjq(\'#\'+elementName+\"_\"+guid);return element;},getPrefsObj:function(guid){var prefsObj=self.prefsArray[guid];if(prefsObj==undefined){var params=self.getParams(guid);var prefsData=params.container.widgetprefs;prefsObj=new fhprefs(self,guid,prefsData);self.prefsArray[guid]=prefsObj;}\nreturn prefsObj;},showHeader:function(guid){$fhjq(\"#header_\"+guid).show();},hideHeader:function(guid){$fhjq(\"#header_\"+guid).hide();},showFooter:function(guid){$fhjq(\"#footer_\"+guid).show();},hideFooter:function(guid){$fhjq(\"#footer_\"+guid).hide();},iframeLoad:function(guid){},toggleExpandState:function(guid,newState){var params=self.getParams(guid);if(newState==\"false\"){$fhjq(\"#body_\"+guid).addClass(\"fh_wc_widgetbody_expanded\");$fhjq(\"#body_\"+guid).removeClass(\'fh_wc_widgetbody_collapsed\');$fhjq(\"#header_\"+guid).find(\".fh_wc_but-expand-shown\").show();$fhjq(\"#header_\"+guid).find(\".fh_wc_but-expand-hidden\").hide();$fhjq(\"#header_left_\"+guid).removeClass(\'fh_wc_header_left_collapsed\');$fhjq(\"#header_right_\"+guid).removeClass(\'fh_wc_header_right_collapsed\');$fhjq(\"#footer_\"+guid).show();}\nelse\nif(newState==\"true\"){$fhjq(\"#body_\"+guid).removeClass(\'fh_wc_widgetbody_expanded\');$fhjq(\"#body_\"+guid).addClass(\'fh_wc_widgetbody_collapsed\');$fhjq(\"#header_\"+guid).find(\".fh_wc_but-expand-shown\").hide();$fhjq(\"#header_\"+guid).find(\".fh_wc_but-expand-hidden\").show();$fhjq(\"#header_left_\"+guid).addClass(\'fh_wc_header_left_collapsed\');$fhjq(\"#header_right_\"+guid).addClass(\'fh_wc_header_right_collapsed\');$fhjq(\"#footer_\"+guid).hide();}\nelse{newState=\"false\";}\nif(\"feedhenry\"==params.container.destination){$fhjq.post(StartPage.apiPrefix+StartPage.domain+\'\x2Finstances\x2FchangeExpandState\',JSON.stringify({subscription_id:guid,expandState:newState}),function(data){StartPage.fh_page.adjustFooter();},\'json\');}},reload:function(guid){self.openIfClosed(guid);var params=self.getParams(guid);self.getPrefsObj(guid).dropColorChange();if(params.client.widget.inline){var reloadPath=$fh.legacy.widgetpath+\'\x2Ffile\x2F\'+params.container.startFile;$fhjq.get(reloadPath,\'\',function(data){$fhjq(\'#widgetbody_\'+guid).html(data);self.resizeWidgetBody(guid,\'widgetbody_\');});}\nelse{var iframe=$fhjq(\"#widgetbody_\"+guid+\" #iframe_\"+guid);var srcVal=iframe.attr(\'src\');iframe.attr(\'src\',srcVal);}\nself.hideAll(guid);$fhjq(\"#widgetbody_\"+guid).show();self.fh_call_log_event(guid,\'ClickReload\',\'0\',\'TitleBar\',\'\',\'0\',\'\',\'\',\'\',params.container.viewGuid);},resizeWidgetBody:function(guid,fromDiv){var params=self.getParams(guid);if(\"feedhenry\"==params.container.destination){StartPage.fh_page.adjustFooter();}},calculateWidgetHeight:function(guid){var height=$fhjq(\"#widgetbody_\"+guid).height();var minheight=$fhjq(\"#widgetbody_\"+guid).css(\"min-height\");minheight=minheight.substring(0,(minheight.length-2));height=(minheight\x3Eheight)?minheight:height-20;return height;},showEdit:function(guid){self.openIfClosed(guid);var params=self.getParams(guid);var editUrl=$fh.legacy.widgetpath+\'\x2Fedit\';$fhjq.get(editUrl,function(data){$fhjq(\'#editDiv_\'+guid).html(data);$fhjq(\'#editDiv_\'+guid).height(self.calculateWidgetHeight(guid));self.hideAll(guid);$fhjq(\'#editDiv_\'+guid).show();});self.fh_call_log_event(guid,\'ClickEditPreferences\',\'0\',\'TitleBar\',\'\',\'1\',\'\',\'\',\'\',params.container.viewGuid);},hideEdit:function(guid){var params=self.getParams(guid);self.getPrefsObj(guid).dropColorChange();self.hideAll(guid);$fhjq(\"#widgetbody_\"+guid).show();self.fh_call_log_event(guid,\'ClickExitButton\',\'1\',\'Preferences\',\'\',\'0\',\'\',\'cancel\',\'\',params.container.viewGuid);},doEdit:function(guid){var params=self.getParams(guid);var fhClient=self.getFhClient(guid);var domain=params.container.domain;var prefsObj=self.getPrefsObj(guid);prefsObj.setPrefs(fhClient,guid,domain);},setPrefNames:function(guid,names){var params=self.getParams(guid);params.container.editPrefsNames=names;},getPrefs:function(guid){var prefsObj=self.getPrefsObj(guid);return prefsObj.getPrefs();},colorChange:function(guid,color){var prefsObj=self.getPrefsObj(guid);prefsObj.logColorChange(color);$fhjq(\'#colorpicker_\'+guid+\' span\').removeClass(\'activeColor\');$fhjq(\'#\'+color+\'_\'+guid).addClass(\'activeColor\');},showShare:function(guid){self.openIfClosed(guid);self.getPrefsObj(guid).dropColorChange();var params=self.getParams(guid);var shareUrl=$fh.legacy.widgetpath+\'\x2Fshare\';$fhjq.get(shareUrl,function(data){$fhjq(\'#shareDiv_\'+guid).html(data);var existingHeight=$fhjq(\'#shareDiv_\'+guid).height();var widgetCurrentHeight=self.calculateWidgetHeight(guid);if(existingHeight\x3CwidgetCurrentHeight){$fhjq(\'#shareDiv_\'+guid).height(widgetCurrentHeight);}\nself.hideAll(guid);$fhjq(\'#shareDiv_\'+guid).show();});self.fh_call_log_event(guid,\'ClickShare\',\'0\',\'TitleBar\',\'\',\'1\',\'\',\'\',\'\',params.container.viewGuid);},hideShare:function(guid){var params=self.getParams(guid);self.hideAll(guid);$fhjq(\"#widgetbody_\"+guid).show();self.fh_call_log_event(guid,\'ClickCancelButton\',\'1\',\'Sharing\',\'\',\'0\',\'\',\'\',\'\',params.container.viewGuid);},doShare:function(guid){},openIfClosed:function(guid){if(\"none\"==$fhjq(\"#header_\"+guid).find(\".fh_wc_but-expand-shown\").css(\"display\")){self.toggleExpandState(guid,\'false\');}},showRemove:function(guid){var params=self.getParams(guid);self.openIfClosed(guid);$fhjq(\'#deleteDiv_\'+guid).height(self.calculateWidgetHeight(guid));self.hideAll(guid);$fhjq(\"#deleteDiv_\"+guid).show();self.fh_call_log_event(guid,\'ClickDelete\',\'0\',\'TitleBar\',\'\',\'0\',\'\',\'\',\'\',params.container.viewGuid);},hideRemove:function(guid){self.hideAll(guid);$fhjq(\"#widgetbody_\"+guid).show();},doRemove:function(guid){var params=self.getParams(guid);if(\"feedhenry\"==params.container.destination){StartPage.Widgets.destroy(guid);}\nelse{var removePath=$fh.legacy.widgetpath+\'\x2Fremove\';$fhjq.post(removePath,\'\',function(data){$fhjq(\'#widget_\'+guid).html(\'\');});}},hideAll:function(guid){$fhjq(\"#editDiv_\"+guid).hide();$fhjq(\"#shareDiv_\"+guid).hide();$fhjq(\"#deleteDiv_\"+guid).hide();$fhjq(\"#widgetbody_\"+guid).hide();},fh_call_log_event:function(_guid,_action,_fromLevel,_fromLocation,_source,_toLevel,_toLocation,_toLocationCategory,_toLocationSubCategory,_swaggerGuid){var myJSONObject={\"type\":\"In-Widget\",\"data\":{\"action\":_action,\"source\":_guid,\"fromLocation\":_fromLocation,\"toLocation\":_toLocation,\"toLocationCategory\":_toLocationCategory,\"toLocationSubCategory\":_toLocationSubCategory,\"fromLevel\":_fromLevel,\"viewGuid\":_swaggerGuid,\"toLevel\":_toLevel}};var reqjson=JSON.stringify(myJSONObject);},dynamicResize:function(guid){var currentWidgetHeight=$fhjq(\'#subscription_\'+guid).height();currentWidgetHeight=currentWidgetHeight+$fhjq(\'#subscription_\'+guid).height()+$fhjq(\'#shareDiv_\'+guid).height()+$fhjq(\'#preferencesDiv_\'+guid).height();$fhjq(\'#subscription_\'+guid).css(\'height\',currentWidgetHeight);},initialise:function(guid){$fh.env({},function(env_props){$fh.data({key:\'__fhinit__\'},function(res){var params=self.getParams(guid);var reqdata={};if(typeof res.val!=\"undefined\"\&\&res.val!=null\&\&res.val.length\x3E0){try{reqdata=JSON.parse(res.val);}catch(e){reqdata={};}}\nreqdata.appid=env_props.application;reqdata.uuid=env_props.uuid;reqdata.destination=env_props.destination;reqdata.app_version=env_props.version;reqdata.domain=env_props.domain;reqdata.agent=env_props.agent;var url=$fh.legacy.widgetpath+\'\x2Finitialise\';$fhjq.ajax({type:\'POST\',url:url,data:JSON.stringify(reqdata),success:function(data){$fh.data({act:\'save\',key:\'__fhinit__\',val:data});}});});});},share:function(){var share={init:function(){share.mainDiv=\'share_options_area_\';share.destinationsDiv=\'share_destinations_area_\';share.DestinationClass=\'fh_wc_share_destination_\';share.destinationDiv=\'share_destination_\';share.linkShareId=\'fh_linkShare_\';share.linkShareText=\'fh_linkShare_destination_\';share.sharingLink=\'fh_wc_sharing_link\';},setMinHeight:function(guid,height){share[\"min-height-\"+guid]=height;},showDestinationShare:function(guid,destination){var existingHeight=$fhjq(\'#shareDiv_\'+guid).height();var min=share[\"min-height-\"+guid];if(null==min){share.setMinHeight(guid,existingHeight);min=existingHeight;}\n$fhjq(\'.\'+share.DestinationClass+guid).hide();share.doLinkShare(guid,destination);$fhjq(\'#\'+share.destinationsDiv+guid).show();$fhjq(\'#\'+share.destinationDiv+destination+\"_\"+guid).show();$fhjq(\'#shareDiv_\'+guid).height(\"auto\");var newHeight=$fhjq(\'#shareDiv_\'+guid).height();if(newHeight\x3Cmin){$fhjq(\'#shareDiv_\'+guid).height(min);}\n$fhjq(\'.fh_dock_accordion_preview_wrapper\').jScrollPane({showArrows:false,scrollbarWidth:16,arrowSize:14,paneFixed:false});self.resizeWidgetBody(guid,\'shareDiv_\');},doBack:function(guid){$fhjq(\'.\'+share.DestinationClass+guid).hide();$fhjq(\'#\'+share.destinationsDiv+guid).hide();$fhjq(\'#\'+share.mainDiv+guid).show();},doLinkShare:function(guid,destination){var params=self.getParams(guid);var linkShare=$fh.legacy.widgetpath+\'\x2Fshare\x2F\'+destination;var linkShareText=\'Your widget has been shared to \'+destination;if(\'netvibes\'===destination){linkShareText=\'Before you can share to Netvibes, your \x3Ca class=\"\" target=\"_blank\" href=\"http:\x2F\x2Fwww.netvibes.com\"\x3Edashboard\x3C\x2Fa\x3E must be already set up.\';$fhjq(\'.\'+share.linkShareId+guid).parent().html(\'Once set up, please \x3Ca class=\"\'+share.linkShareId+guid+\'\" target=\"_blank\"\x3Eclick here\x3C\x2Fa\x3E to go to your widget\')}\n$fhjq(\'.\'+share.linkShareId+guid).attr(\'href\',linkShare);$fhjq(\'.\'+share.linkShareText+guid).html(linkShareText);},doEmailShare:function(guid){var params=self.getParams(guid);var shareUrl=$fh.legacy.widgetpath+\'\x2Fshare\x2Femail\';var reqData=new Object();var fieldBase=\"fh_share_mail_\";reqData.fromName=$fhjq(\'#\'+fieldBase+\'from_name_\'+guid).val();reqData.fromEmail=$fhjq(\'#\'+fieldBase+\'from_email_\'+guid).val();reqData.toName=$fhjq(\'#\'+fieldBase+\'to_name_\'+guid).val();reqData.toEmail=$fhjq(\'#\'+fieldBase+\'to_email_\'+guid).val();reqData.message=$fhjq(\'#\'+fieldBase+\'message_\'+guid).val();$fhjq.post(shareUrl,JSON.stringify(reqData),function(data){share.finishEmailShare(guid,data,reqData);},\'json\');},doClearField:function(id){$fhjq(\'#\'+id).val(\"\");},finishEmailShare:function(guid,res,reqData){var message=\"Your widget has been shared.\";if(res.result==\"fail\"){message=\"There was an error sharing you widget. \"+res.reason;}\n$fhjq(\'#share_email_results_\'+guid).show();$fhjq(\'#share_email_div_\'+guid).hide();$fhjq(\'#share_email_message_\'+guid).html(message);}};share.init();return{showDestinationShare:share.showDestinationShare,doBack:share.doBack,doEmailShare:share.doEmailShare,setMinHeight:share.setMinHeight,doClearField:share.doClearField};}};self.init();return{addInstance:self.addInstance,addFhClient:self.addFhClient,showHeader:self.showHeader,hideHeader:self.hideHeader,showFooter:self.showFooter,hideFooter:self.hideFooter,iframeLoad:self.iframeLoad,toggleExpandState:self.toggleExpandState,reload:self.reload,getPrefs:self.getPrefs,setPrefs:self.setPrefs,setPrefNames:self.setPrefNames,showEdit:self.showEdit,hideEdit:self.hideEdit,doEdit:self.doEdit,colorChange:self.colorChange,showShare:self.showShare,hideShare:self.hideShare,doShare:self.doShare,showRemove:self.showRemove,hideRemove:self.hideRemove,doRemove:self.doRemove,showDestinationShare:self.share().showDestinationShare,shareBack:self.share().doBack,doEmailShare:self.share().doEmailShare,addTimer:self.addTimer,getTimer:self.getTimer,mouseIn:self.mouseIn,mouseOut:self.mouseOut,watchTimer:self.watchTimer,getElementById:self.getElementById,doClearField:self.share().doClearField,initialise:self.initialise};};var fhprefs=function(container,guid,data){var self={init:function(){self.data=data;self.guid=guid;self.container=container;self.currentColor=\'\';self.originalColor=\'\';},logColorChange:function(color){var newColor=color;var params=self.container.getParams(self.guid);if(self.currentColor==\'\'){self.currentColor=params.container.color;}\nif(self.originalColor==\'\'){self.originalColor=params.container.color;}\nif(\'\'!==newColor\&\&self.currentColor!==newColor){self.applyColourChange(self.guid,self.currentColor,newColor);self.currentColor=newColor;}},dropColorChange:function(){if(\'\'!==self.originalColor\&\&self.currentColor!==self.originalColor){self.applyColourChange(self.guid,self.currentColor,self.originalColor);}\nself.currentColor=self.originalColor;},applyColourChange:function(guid,oldColor,newColor){var params=self.container.getParams(self.guid);if(params.container.showHeader){$fhjq(\'#header_\'+guid).removeClass(oldColor);$fhjq(\'#header_\'+guid).addClass(newColor);}\nif(params.container.showFooter){$fhjq(\'#footer_\'+guid).removeClass(oldColor);$fhjq(\'#footer_\'+guid).addClass(newColor);}},setPrefs:function(fhclient,guid,domain){var isValid=$fhjq(\'#edit_\'+guid).valid();if(!isValid){return;}\nvar params=self.container.getParams(guid);var prefs={};var prefContainer=$fhjq(\'#edit_\'+guid);var prefNames=params.container.editPrefsNames;var len=prefNames.length;for(nI=0;nI\x3Clen;nI++){var pName=prefNames[nI];var prefId=\'#\'+guid+\'_\'+pName;var pref=$fhjq(prefId);var fh_editprefs_type=pref.attr(\"type\");switch(fh_editprefs_type){case\'checkbox\':prefs[pName]=pref.attr(\"checked\")===true?\"true\":\"false\";break;case\'radio\':var number_of_stories=$fhjq(\"#edit_\"+guid+\" input[name=\'\"+prefId.substring(1,prefId.length)+\"\']:radio:checked\").val();if(typeof number_of_stories!=\'undefined\'){prefs[pName]=number_of_stories;}\nbreak;case\'textarea\':var fh_editpref_textarea_value=pref.val().replace(new RegExp(\"\\\\n\",\"g\"),\"\");fh_editpref_textarea_value=fh_editpref_textarea_value.replace(\x2F^\\s*|\\s*$\x2Fg,\'\');prefs[pName]=fh_editpref_textarea_value;break;default:if(pName==\"widgetColor\"){prefs[pName]=self.currentColor;}\nelse{prefs[pName]=pref.val();}\nbreak;}}\nprefs.viewGuid=params.container.viewGuid;fhclient.call(\'act\x2Fwid\x2Fprefs\x2Fsave\',{instance:guid,domain:domain,destination:params.container.destination,prefs:prefs},self.responseSave);},responseSave:function(res){var params=self.container.getParams(guid);var destination=params.container.destination;if(res.errors){if(destination!=\'desktop\'){var errors=res.errors;for(i=0;i\x3Cerrors.length;i++){fh_alert(errors[i]);}}}\nelse{var prefs=res.prefs;self.data=prefs;self.originalColor=self.currentColor;if(destination!=\'mobile\'){self.container.reload(self.guid);}}},fh_alert:function(msg){$fhjq(\'#alertMessages_\'+self.guid).html(msg);$fhjq(\'#alerts_\'+self.guid).show();},getPrefs:function(){return self.data;}};self.init();return{getPrefs:self.getPrefs,setPrefs:self.setPrefs,logColorChange:self.logColorChange,dropColorChange:self.dropColorChange};};$fh={APP_MODE_DEBUG:\'debug\',APP_MODE_RELEASE:\'release\',APP_MODE_DISTRIBUTION:\'distribution\',CLOUD_TYPE_FH:\'fh\',CLOUD_TYPE_NODE:\'node\'};;(function(){$fh.__is_ready=false;$fh.__ready_list=[];var __ready_bound=false;var __security_loaded=false;var __module_paths={\'security\':\'fhext\x2Fjs\x2Fsecurity.js\'};var __ready=function(){if(!$fh.__is_ready){$fh.__is_ready=true;if($fh.__ready_list){try{while($fh.__ready_list[0]){$fh.__ready_list.shift().apply(document,[]);}}finally{}\n$fh.__ready_list=null;}}};$fh.__bind_ready=function(){if(__ready_bound)return;__ready_bound=true;if(document.addEventListener){document.addEventListener(\"DOMContentLoaded\",function(){document.removeEventListener(\"DOMContentLoaded\",arguments.callee,false);__ready();},false);window.addEventListener(\"load\",__ready,false);}else if(document.attachEvent){document.attachEvent(\"onreadystatechange\",function(){if(document.readyState===\"complete\"){document.detachEvent(\"onreadystatechange\",arguments.callee);__ready();}});window.attachEvent(\"onload\",__ready);if(document.documentElement.doScroll\&\&window==window.top)(function(){if($fh.__is_ready)return;try{document.documentElement.doScroll(\"left\");}catch(error){setTimeout(arguments.callee,0);return;}\n__ready();})();}};$fh.__bind_ready();var __XMLHttpRequest__=window.ActiveXObject?ActiveXObject:XMLHttpRequest;var __useActiveXObject=window.ActiveXObject?true:false;var __xhr=function(){if(__useActiveXObject){return new __XMLHttpRequest__(\"Microsoft.XMLHTTP\");}else{return new __XMLHttpRequest__();}}\nvar __cb_counts=0;var __load_script=function(url,callback){var script;var head=document.head||document.getElementsByTagName(\"head\")[0]||document.documentElement;script=document.createElement(\"script\");script.async=\"async\";script.src=url;script.type=\"text\x2Fjavascript\";script.onload=script.onreadystatechange=function(){if(!script.readyState||\x2Floaded|complete\x2F.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head\&\&script.parentNode){head.removeChild(script);}\nscript=undefined;if(callback\&\&typeof callback===\"function\"){callback();}}}\nhead.insertBefore(script,head.firstChild);}\n$fh.__ajax=function(options){var o=options?options:{};var req;var url=o.url;var method=o.type||\'GET\';var data=o.data||null;var timeoutTimer;var rurl=\x2F\\?\x2F;var datatype=o.dataType===\"jsonp\"?\"jsonp\":\"json\";var done=function(status,statusText,responseText){var issuccess=false;var error;var res;if(status\x3E=200\&\&status\x3C=300||status==304){if(status==304){statusText=\"notmodified\";issuccess=true;}else{if(o.dataType\&\&o.dataType.indexOf(\'json\')!=-1){try{if(typeof responseText===\"string\"){res=JSON.parse(responseText);}else{res=responseText;}\nissuccess=true;}catch(e){issuccess=false;statusText=\"parseerror\";error=e;}}else{res=responseText;issuccess=true;}}}else{error=statusText;if(!statusText||status){statusText=\"error\";if(status\x3C0){status=0;}}}\nif(issuccess){req=undefined;if(o.success\&\&typeof o.success===\'function\'){o.success(res);}}else{if(o.error\&\&typeof o.error===\'function\'){o.error(req,statusText,error);}}}\nvar types={\'json\':function(){req=__xhr();req.open(method,url,true);if(o.contentType){req.setRequestHeader(\'Content-Type\',o.contentType);}\nreq.setRequestHeader(\'X-Request-With\',\'XMLHttpRequest\');var handler=function(){if(req.readyState==4){if(timeoutTimer){clearTimeout(timeoutTimer);}\nvar statusText;try{statusText=req.statusText;}catch(e){statusText=\"\";}\ndone(req.status,req.statusText,req.responseText);}}\nreq.onreadystatechange=handler;req.send(data);},\'jsonp\':function(){var callbackId=\'fhcb\'+__cb_counts++;window[callbackId]=function(response){if(timeoutTimer){clearTimeout(timeoutTimer);}\ndone(200,\"\",response);window[callbackId]=undefined;try{delete window[callbackId]}catch(e){}}\nurl+=(rurl.test(url)?\"\&\":\"?\")+\"callback=\"+callbackId;__load_script(url);}}\nif(o.timeout\x3E0){timeoutTimer=setTimeout(function(){if(req){req.abort();}\ndone(0,\'timeout\');},o.timeout);}\ntypes[datatype]();};$fh.__load_module=function(module,callback){if($fh[\'__\'+module+\'_loaded\']){callback();return;}else{if(__module_paths[module]){__load_script(__module_paths[module],callback);}}};$fh.legacy={};function set_host_name(data){if(data\&\&data.domain\&\&data.host){$fh.legacy.domain=data.domain;$fh.__setPathPrefix(data);$fh.legacy.widgetpath=$fh.legacy.pathprefix+\"wid\x2F\"+data.domain+\"\x2F\"+$fh.legacy.destinationName+\"\x2F\"+$fh.legacy.instance;$fh.legacy.path=$fh.legacy.pathprefix+\"wid\x2F\"+data.domain+\"\x2F\"+$fh.legacy.destinationName+\"\x2F\"+$fh.legacy.instance;$fh.legacy.filepath=$fh.legacy.path+\"\x2Ffile\x2F\";}};$fh.__setPathPrefix=function(data){$fh.legacy.pathprefix=$fh.legacy.deliveryScheme+data.host+$fh.legacy.boxprefix;};$fh.update_hostname_from_name_server=function(app_guid){var fh_persisted_host_key=\"fh_app_host_and_domain-\"+app_guid;$fh.data({key:fh_persisted_host_key},function(res){if(null!=res.val){set_host_name(JSON.parse(res.val));}},function(){});var path=$fh.legacy.nameserver+\"\x2Ffhns\x2Fapp\x2Fquery\x2F\"+app_guid;$fh.__ajax({url:path,type:\"GET\",dataType:\"jsonp\",data:\"\",success:function(data){if(undefined!==data.host){set_host_name(data);$fh.data({act:\"save\",key:fh_persisted_host_key,val:JSON.stringify(data)},function(res){},function(){});};},error:function(xhr,textErr,eExcept){}});}\n$fh.init=function(params){$fh.legacy.domain=params.domain;$fh.legacy.nameserver=params.nameserver;$fh.legacy.deliveryScheme=params.deliveryScheme;$fh.legacy.checkDeliveryScheme=params.checkDeliveryScheme;$fh.legacy.appMode=params.appMode;$fh.legacy.debugCloudUrl=params.debugCloudUrl;$fh.legacy.debugCloudType=params.debugCloudType;$fh.legacy.releaseCloudUrl=params.releaseCloudUrl;$fh.legacy.releaseCloudType=params.releaseCloudType;$fh.legacy.destinationName=params.destination.name;$fh.legacy.destinationInline=params.destination.inline;$fh.legacy.widget=params.widget;$fh.legacy.instance=params.widget.instance;$fh.legacy.boxprefix=\'\x2Fbox\x2Fsrv\x2F1.1\x2F\';set_host_name(params);$fh.legacy.logPath=\'dat\x2FSwaggerLog\x2Flog\';$fh.legacy.entprefix=\'ent\x2F\';$fh.legacy.actprefix=\'act\x2F\';$fh.legacy.fh_timeout=20000;$fh.legacy.debugpopup=false;$fh.legacy.logcalls=false;$fh.legacy.calllog=[];$fh.legacy.user=params.user;$fh.legacy.startwidget=null;$fh.legacy.oscontainer=null;$fh.legacy.messages={};$fh.legacy.polltimeout=null;$fh.legacy.urltag=params.urltag;$fh.legacy.urltagparam=\'\';$fh.legacy.swagger_view=params.swagger_view;$fh.legacy.useSecureConnection=params.useSecureConnection;$fh.host=params.host;if(params.urltag!=\'\'){$fh.legacy.urltagparam=\'?tag=\'+params.urltag;}\nif($fh.legacy.destinationInline){var domainparts=document.domain.split(\".\");document.domain=domainparts[domainparts.length-2]+\".\"+domainparts[domainparts.length-1];}\nif(typeof $fhcontainer!=\'undefined\'){$fh.legacy.container=$fhcontainer;$fh.legacy.container.addFhClient($fh.legacy);}\nreturn $fh.legacy;};$fh.initialise=function(guid){$fh.env({},function(env_props){$fh.data({key:\'__fhinit__\'},function(res){var reqdata={};if(typeof res.val!=\"undefined\"\&\&res.val!=null\&\&res.val.length\x3E0){try{reqdata=JSON.parse(res.val);}catch(e){reqdata={};}}\nreqdata.appid=env_props.application;reqdata.instid=env_props.instance\nreqdata.uuid=env_props.uuid;reqdata.destination=env_props.destination;reqdata.app_version=env_props.version;reqdata.domain=env_props.domain;reqdata.agent=env_props.agent;var url=$fh.legacy.widgetpath+\'\x2Finitialise\';$fh.__ajax({type:\'POST\',url:url,data:JSON.stringify(reqdata),success:function(data){$fh.data({act:\'save\',key:\'__fhinit__\',val:data});}});});});};$fh._getRequestUrl=function(path,secure){return $fh.legacy.boxprefix+path;};$fh._getCloudParams=function(params){return params;};$fh._getCloudUri=function(params){var uri=\'\';uri=$fh._getInternalCloudPath(params.domain,params.code,params.act,params.guid);return uri;};$fh._getInternalCloudPath=function(domain,code,act,guid){var path;path=$fh.legacy.actprefix+domain+\'\x2F\'+code+\'\x2F\'+act+\'\x2F\'+guid;return path;};$fh._addRequestParams=function(params,callback){$fh.env({},function(props){var fhParams={};fhParams.cuid=props.uuid;fhParams.destination=props.destination;fhParams.domain=props.domain;fhParams.version=props.version;params=params||{};params.__fh=fhParams;params=$fh._getCloudParams(params);callback(params);});};$fh.call=function(path,params,success,xhr,secure,error){try{$fh._addRequestParams(params,function(req){var reqstring=JSON.stringify(req);var url=path;if(path.indexOf(\'http\')\x3C0){url=$fh._getRequestUrl(path,secure);}\n$fh.legacy.urltag==\"\"?\"\":(url=url+(url.indexOf(\'?\')==-1?\"?\":\"\&\")+\"tag=\"+$fh.legacy.urltag);if($fh.legacy.debugpopup){alert(url+\' request:\'+reqstring);}\nif($fh.legacy.logcalls){$fh.legacy.calllog.push(formatDate(new Date(),true)+\': REQUEST: \'+url+\': \'+reqstring);}\nvar ajaxParams={type:\"POST\",url:url,dataType:\'json\',contentType:\'application\x2Fjson\',cache:false,data:reqstring,timeout:$fh.legacy.fh_timeout,success:function(res){if($fh.legacy.debugpopup){alert(url+\' response:\'+JSON.stringify(res));}\nif($fh.legacy.logcalls){$fh.legacy.calllog.push(formatDate(new Date(),true)+\': RESPONSE: \'+url+\': \'+JSON.stringify(res));}\nif(success){success(res);}},error:function(xhr,msg,err){$fh.legacy.error(xhr,msg,err,error);}};$fh.__ajax(ajaxParams);});}catch(e){console.log(e);var url=$fh.legacy.hostname+$fh.legacy.pathprefix+path;try{var ajax=new Ajax();ajax.responseType=Ajax.JSON;ajax.ondone=function(res){if(success){success(res);}};var reqtext=JSON.stringify(req);var data={\'fh_fb_data\':reqtext};ajax.post(url,data);}catch(ex){}}};$fh.legacy.call=$fh.call;$fh.legacy.error=function(xhr,msg,e,error){var errmsg=\'\';try{if(xhr){if(400==xhr.status||500==xhr.status){var res=JSON.parse(xhr.responseText);errmsg=\'error(01): \'+res.msg;if($fh.legacy.debugpopup){alert(errmsg);}\nif($fh.legacy.logcalls){$fh.legacy.calllog.push(formatDate(new Date(),true)+\': ERROR: \'+errmsg);}}else{errmsg=\'error(02): \'+xhr.responseText+\' \'+msg+\' \'+e;if($fh.legacy.debugpopup){alert(errmsg);}\nif($fh.legacy.logcalls){$fh.legacy.calllog.push(formatDate(new Date(),true)+\': ERROR: \'+errmsg);}}}else{errmsg=\'error(03): \'+msg+\' \'+e;if($fh.legacy.debugpopup){alert(errmsg);}\nif($fh.legacy.logcalls){$fh.legacy.calllog.push(formatDate(new Date(),true)+\': ERROR: \'+errmsg);}}}catch(e){errmsg=\'error(04): \'+e;if($fh.legacy.debugpopup){alert(errmsg);}\nif($fh.legacy.logcalls){$fh.legacy.calllog.push(formatDate(new Date(),true)+\': ERROR: \'+errmsg);}}\nif(errmsg!=\'\'){errmsg=\'An error occured with your app: \'+errmsg;$fh.log({\'message\':errmsg});}\nif(error){var code=xhr.status==400?\'ent_badact\':\'ent_actfail\'\nerror(code,{status:xhr.status,message:e,error:errmsg});}};$fh.legacy.formatDate=function(date,showmillis){var y=date.getFullYear();var M=date.getMonth()+1;var d=date.getDate();var H=date.getHours();var m=date.getMinutes();var s=date.getSeconds();var l=date.getMilliseconds();return y+\'-\'+$fh.legacy.pZ(M)+\'-\'+$fh.legacy.pZ(d)+\' \'+$fh.legacy.pZ(H)+\':\'+$fh.legacy.pZ(m)+\':\'+$fh.legacy.pZ(s)+(showmillis?(\':\'+l):\'\');};$fh.legacy.pZ=function(val){return(val\x3C0||val\x3E9?\"\":\"0\")+val;};$fh.legacy.getAssetFiles=function(src){return $fh.legacy.filepath+src;};$fh.legacy.makeStaticUrl=function(path){return\'\x2Fstatic\x2Fw\x2F\'+$fh.legacy.widget.guid+\'\x2F\'+$fh.legacy.widget.version+\'\x2F\'+path;};$fh.legacy.debug=function(val){$fh.legacy.debugpopup=val;};$fh.legacy.logEvent=function(logMessage){$fh.call($fh.legacy.logPath,logMessage);};})();;(function(){var defaultargs={success:function(){},failure:function(){},params:{}};var handleargs=function(inargs,defaultparams,applyto){var outargs=[null,null,null];var origargs=[null,null,null];var numargs=inargs.length;if(2\x3Cnumargs){origargs[0]=inargs[numargs-3];origargs[1]=inargs[numargs-2];origargs[2]=inargs[numargs-1];}else if(2==numargs){origargs[1]=inargs[0];origargs[2]=inargs[1];}else if(1==numargs){origargs[2]=inargs[0];}\nvar i=0,j=0;for(;i\x3C3;i++){var a=origargs[i];var ta=typeof a;if(a\&\&0==j\&\&(\'object\'==ta||\'boolean\'==ta)){outargs[j++]=a;}else if(a\&\&\'function\'==ta){j=0==j?1:j;outargs[j++]=a;}}\nif(null==outargs[0]){outargs[0]=defaultparams?defaultparams:defaultargs.params;}else{var paramsarg=outargs[0];paramsarg._defaults=[];for(var n in defaultparams){if(defaultparams.hasOwnProperty(n)){if(typeof paramsarg[n]===\"undefined\"){paramsarg[n]=defaultparams[n];paramsarg._defaults.push(n);}}}}\noutargs[1]=null==outargs[1]?defaultargs.success:outargs[1];outargs[2]=null==outargs[2]?defaultargs.failure:outargs[2];applyto(outargs[0],outargs[1],outargs[2]);}\nvar eventSupported=function(event){var element=document.createElement(\'i\');return event in element||element.setAttribute\&\&element.setAttribute(event,\"return;\")||false;}\n$fh._mapScriptLoaded=(typeof google!=\"undefined\")\&\&(typeof google.maps!=\"undefined\")\&\&(typeof google.maps.Map!=\"undefined\");$fh._loadMapScript=function(){var script=document.createElement(\"script\");script.type=\"text\x2Fjavascript\";script.src=\"http:\x2F\x2Fmaps.google.com\x2Fmaps\x2Fapi\x2Fjs?sensor=true\&callback=$fh._mapLoaded\";document.body.appendChild(script);};$fh.__readCookieValue=function(cookie_name){var name_str=cookie_name+\"=\";var cookies=document.cookie.split(\";\");for(var i=0;i\x3Ccookies.length;i++){var c=cookies[i];while(c.charAt(0)==\' \'){c=c.substring(1,c.length);}\nif(c.indexOf(name_str)==0){return c.substring(name_str.length,c.length);}}\nreturn null;};$fh.__createCookie=function(cookie_name,cookie_value){var date=new Date();date.setTime(date.getTime()+36500*24*60*60*1000);var expires=\"; expires=\"+date.toGMTString();document.cookie=cookie_name+\"=\"+cookie_value+expires+\"; path = \x2F\";};$fh.__createUUID=function(){var s=[];var hexDigitals=\"0123456789ABCDEF\";for(var i=0;i\x3C32;i++){s[i]=hexDigitals.substr(Math.floor(Math.random()*0x10),1);}\ns[12]=\"4\";s[16]=hexDigitals.substr((s[16]\&0x3)|0x8,1);var uuid=s.join(\"\");return uuid;};$fh._mock_uuid_cookie_name=\"mock_uuid\";$fh.audio_obj=null;$fh.audio_is_playing=false;$fh._current_auth_user=null;$fh.__dest__={send:function(p,s,f){f(\'send_nosupport\');},notify:function(p,s,f){f(\'notify_nosupport\');},contacts:function(p,s,f){f(\'contacts_nosupport\');},acc:function(p,s,f){f(\'acc_nosupport\');},geo:function(p,s,f){f(\'geo_nosupport\');},cam:function(p,s,f){f(\'cam_nosupport\');},device:function(p,s,f){f(\'device_nosupport\');},listen:function(p,s,f){f(\'listen_nosupport\');},handlers:function(p,s,f){f(\'handlers_no_support\');},file:function(p,s,f){f(\'file_nosupport\');},push:function(p,s,f){f(\'push_nosupport\');},env:function(p,s,f){s({height:window.innerHeight,width:window.innerWidth,uuid:function(){var uuid=$fh.__readCookieValue($fh._mock_uuid_cookie_name);if(null==uuid){uuid=$fh.__createUUID();$fh.__createCookie($fh._mock_uuid_cookie_name,uuid);}\nreturn uuid;}()});},data:function(p,s,f){if(!$fh._persist){$fh._persist=new Persist.Store(\'FH\'+$fh.legacy.instance,{swf_path:\'\x2Fstatic\x2Fc\x2Fstart\x2Fswf\x2Fpersist.swf\'});}\nif(!p.key){f(\'data_nokey\');return;}\nvar acts={load:function(){$fh._persist.get(p.key,function(ok,val){ok?s({key:p.key,val:val}):s({key:p.key,val:null});});},save:function(){if(!p.val){f(\'data_noval\');return;}\ntry{$fh._persist.set(p.key,p.val);}catch(e){f(\'data_error\',{},p);return;}\ns();},remove:function(){$fh._persist.remove(p.key,function(ok,val){ok?s({key:p.key,val:val}):s({key:p.key,val:null});});}};acts[p.act]?acts[p.act]():f(\'data_badact\',p);},log:function(p,s,f){typeof console===\"undefined\"?f(\'log_nosupport\'):console.log(p.message);},ori:function(p,s,f){if(typeof p.act==\"undefined\"||p.act==\"listen\"){if(eventSupported(\'onorientationchange\')){window.addEventListener(\'orientationchange\',s,false);}else{f(\'ori_nosupport\',{},p);}}else if(p.act==\"set\"){if(!p.value){f(\'ori_no_value\',{},p);return;}\nif(p.value==\"portrait\"){document.getElementsByTagName(\"body\")[0].style[\'-moz-transform\']=\"\";document.getElementsByTagName(\"body\")[0].style[\'-webkit-transform\']=\"\";s({orientation:\'portrait\'});}else{document.getElementsByTagName(\"body\")[0].style[\'-moz-transform\']=\'rotate(90deg)\';document.getElementsByTagName(\"body\")[0].style[\'-webkit-transform\']=\'rotate(90deg)\';s({orientation:\'landscape\'});}}else{f(\'ori_badact\',{},p);}},map:function(p,s,f){if(!p.target){f(\'map_notarget\',{},p);return;}\nif(!p.lat){f(\'map_nolatitude\',{},p);return;}\nif(!p.lon){f(\'map_nologitude\',{},p);return;}\nvar target=p.target;if(typeof target===\"string\"){var target_dom=null;if(typeof jQuery!=\"undefined\"){try{var jq_obj=jQuery(target);if(jq_obj.length\x3E0){target_dom=jq_obj[0];}}catch(e){target_dom=null;}}\nif(null==target_dom){target_dom=document.getElementById(target);}\ntarget=target_dom;}\nelse if(typeof target===\"object\"){if(target.nodeType===1\&\&typeof target.nodeName===\"string\"){}else{target=target[0];}}\nelse{target=null;}\nif(!target){f(\'map_nocontainer\',{},p);return;}\nif(!$fh._mapScriptLoaded){$fh._mapLoaded=function(){$fh._mapScriptLoaded=true;var mapOptions={};mapOptions.zoom=p.zoom?p.zoom:8;mapOptions.center=new google.maps.LatLng(p.lat,p.lon);mapOptions.mapTypeId=google.maps.MapTypeId.ROADMAP;var map=new google.maps.Map(target,mapOptions);s({map:map});};$fh._loadMapScript();setTimeout(function(){if(!$fh._mapScriptLoaded){f(\'map_timeout\',{},p);}},20000);}else{var mapOptions={};mapOptions.zoom=p.zoom?p.zoom:8;mapOptions.center=new google.maps.LatLng(p.lat,p.lon);mapOptions.mapTypeId=google.maps.MapTypeId.ROADMAP;var map=new google.maps.Map(target,mapOptions);s({map:map});}},audio:function(p,s,f){if(!$fh.audio_obj==null\&\&p.act==\"play\"\&\&(!p.path||p.path==\"\")){f(\'no_audio_path\');return;}\nvar acts={\'play\':function(){if(null==$fh.audio_obj){$fh.audio_obj=document.createElement(\"audio\");if(!(($fh.audio_obj.play)?true:false)){f(\'audio_not_support\');return;}\nif(p.type){var canplay=$fh.audio_obj.canPlayType(p.type);if(canplay==\"no\"||canplay==\"\"){f(\"audio_type_not_supported\");return;}}\n$fh.audio_obj.src=p.path;if(p.controls){$fh.audio_obj.controls=\"controls\";}\nif(p.autoplay){$fh.audio_obj.autoplay=\"autoplay\";}\nif(p.loop){$fh.audio_obj.loop=\"loop\";}\ndocument.body.appendChild($fh.audio_obj);$fh.audio_obj.play();$fh.audio_is_playing=true;s();}else{if(p.path\&\&(p.path!=$fh.audio_obj.src)){if($fh.audio_is_playing){acts[\'stop\'](true);}\nacts[\'play\']();}else{if(!$fh.audio_is_playing){$fh.audio_obj.play();$fh.audio_is_playing=true;s();}}}},\'pause\':function(){if(null!=$fh.audio_obj\&\&$fh.audio_is_playing){if(typeof $fh.audio_obj.pause==\"function\"){$fh.audio_obj.pause();}else if(typeof $fh.audio_obj.stop==\"function\"){$fh.audio_obj.stop();}\n$fh.audio_is_playing=false;s();}else{f(\'no_audio_playing\');}},\'stop\':function(nocallback){if(null!=$fh.audio_obj){if(typeof $fh.audio_obj.stop==\"function\"){$fh.audio_obj.stop();}else if(typeof $fh.audio_obj.pause==\"function\"){$fh.audio_obj.pause();}\ndocument.body.removeChild($fh.audio_obj);$fh.audio_obj=null;$fh.audio_is_playing=false;if(!nocallback){s();}}else{f(\'no_audio\');}}}\nacts[p.act]?acts[p.act]():f(\'data_badact\',p);},webview:function(p,s,f){f(\'webview_nosupport\');},ready:function(p,s,f){$fh.__bind_ready();if($fh.__is_ready){s.apply(document,[]);}else{$fh.__ready_list.push(s);}},setUUID:function(p,s,f){$fh.__createCookie($fh._mock_uuid_cookie_name,p.uuid);},sec:function(p,s,f){f(\'sec_no_support\');},auth:function(p,s,f){var params={};var secure=true;if(\'secure\'in p){secure=p.secure;}\nif(typeof p.type===\"undefined\"){params.type=\"default\";params.params={userId:p.user,password:p.password};}else{params=p;}\n$fh._current_auth_user=params;$fh.env({},function(props){params.params.appId=props.instance;params.params.device=props.uuid;$fh.call(\'arm\x2Fuser\x2Fauth\',params,function(res){if(0==res.authcode){s();}else{f(res.message);}},null,secure,function(msg,e){f(msg);});})}};$fh.send=function(){handleargs(arguments,{type:\'email\'},$fh.__dest__.send);}\n$fh.notify=function(){handleargs(arguments,{type:\'vibrate\'},$fh.__dest__.notify);}\n$fh.contacts=function(){handleargs(arguments,{act:\'list\'},$fh.__dest__.contacts);}\n$fh.acc=function(){handleargs(arguments,{act:\'register\',interval:0},$fh.__dest__.acc);}\n$fh.geo=function(){handleargs(arguments,{act:\'register\',interval:0},$fh.__dest__.geo);}\n$fh.cam=function(){handleargs(arguments,{act:\'picture\'},$fh.__dest__.cam);}\n$fh.data=function(){handleargs(arguments,{act:\'load\'},$fh.__dest__.data);}\n$fh.log=function(){handleargs(arguments,{message:\'none\'},$fh.__dest__.log);}\n$fh.device=function(){handleargs(arguments,{},$fh.__dest__.device);}\n$fh.listen=function(){handleargs(arguments,{act:\'add\'},$fh.__dest__.listen);}\n$fh.ori=function(){handleargs(arguments,{},$fh.__dest__.ori);}\n$fh.map=function(){handleargs(arguments,{},$fh.__dest__.map);}\n$fh.audio=function(){handleargs(arguments,{},$fh.__dest__.audio);}\n$fh.webview=function(){handleargs(arguments,{},$fh.__dest__.webview);}\n$fh.ready=function(){handleargs(arguments,{},$fh.__dest__.ready);};$fh.setUUID=function(){handleargs(arguments,{},$fh.__dest__.setUUID);};$fh.sec=function(){var args=arguments;$fh.__load_module(\'security\',function(){handleargs(args,{},$fh.__dest__.sec);});};$fh.handlers=function(){handleargs(arguments,{type:\'back\'},$fh.__dest__.handlers);};$fh.hash=function(){handleargs(arguments,{algorithm:\'md5\'},function(p,s,f){var params={act:\'hash\',params:p};$fh.sec(params,s,f);})};$fh.auth=function(){handleargs(arguments,{},$fh.__dest__.auth);};$fh.file=function(){handleargs(arguments,{act:\'upload\'},$fh.__dest__.file);};$fh.push=function(){handleargs(arguments,{},$fh.__dest__.push);};$fh.env=function(){handleargs(arguments,{},function(p,s,f){$fh.__dest__.env({},function(destEnv){destEnv.domain=$fh.legacy.domain;destEnv.application=$fh.legacy.widget.guid;destEnv.template=null;destEnv.instance=$fh.legacy.instance;destEnv.install=null;destEnv.version=$fh.legacy.widget.version;destEnv.destination=$fh.legacy.destinationName;destEnv.subscriber=$fh.legacy.user.id;destEnv.agent=navigator.userAgent||\'unknown\';s(destEnv);});});}\n$fh.device=function(){handleargs(arguments,{},function(p,s,f){});}\n$fh.ent=function(path,req,success){var args=[path,req,success];if(path\&\&\'string\'==typeof(path)){args=[{path:path,req:req},success];}\nhandleargs(args,{act:\'list\'},function(p,s,f){var req=p.req;var reqDomain=p.domain||$fh.legacy.domain;var entity=p.ent;var action=p.act;if(p.path){var path=p.path;var pathParts=path.split(\'\x2F\');if(pathParts.length\x3C2){throw\'Invalid path. Path must be either \x3Centity\x3E\x2F\x3Caction\x3E or \x3Cdomain\x3E\x2F\x3Centity\x3E\x2F\x3Caction\x3E\';}\nreqDomain=$fh.legacy.domain;entity=pathParts[0];action=pathParts[1];if(pathParts.length==3){reqDomain=pathParts[0];entity=pathParts[1];action=pathParts[2];}}\nreq.widgetInstance=$fh.legacy.widget.instance;req.type=reqDomain+\'_\'+entity;path=$fh.legacy.entprefix+reqDomain+\'\x2F\'+entity+\'\x2F\'+action;$fh.call(path,req,s);});};$fh.legacy.ent=$fh.ent;$fh.geoip=function(){handleargs(arguments,{act:\'get\'},function(p,s,f){if(\'get\'==p.act){$fh.call(\'act\x2Fwid\x2Fgeoip\x2Fresolve\',{instance:$fh.legacy.widget.instance,domain:$fh.legacy.domain},function(res){for(var n in res.geoip){res[n]=res[\'geoip\'][n];}\ns(res);});}else{f(\'geoip_badact\',p);}});};$fh.legacy.geoip=$fh.geoip;$fh.act=function(action,req,success,code,domain){var args=[action,req,success];if(action\&\&\'string\'==typeof(action)){args=[{act:action,req:req,code:code,domain:domain,secure:$fh.legacy.useSecureConnection},success];}\nhandleargs(args,{domain:$fh.legacy.domain,code:$fh.legacy.widget.guid,secure:$fh.legacy.useSecureConnection},function(p,s,f){var path,pathParams;pathParams={domain:p.domain,code:p.code,act:p.act,guid:$fh.legacy.instance,secure:p.secure};path=$fh._getCloudUri(pathParams);p.req=p.req||{};$fh.call(path,p.req,s,null,p.secure,f);});};$fh.legacy.act=$fh.act;$fh.web=function(p,s,f){handleargs(arguments,{method:\'GET\'},function(p,s,f){if(!p.url){f(\'bad_url\');}\nif(p.is_local){$fh.__ajax({url:p.url,type:\"GET\",dataType:\"html\",success:function(data){var res={};res.status=200;res.body=data;s(res);},error:function(){f();}})}else{$fh.call(\'act\x2Fwid\x2Fweb\',p,function(res){s(res);});}});};$fh.prefs=function(){handleargs(arguments,{act:\'load\'},function(p,s,f){if(\'load\'==p.act){if(p.full){$fh.legacy.getFullPrefs(s);}else{$fh.legacy.loadPrefs(s);}}else if(\'save\'==p.act){$fh.legacy.savePrefs(p.prefs,s);}else{f(\'prefs_badact\',p);}});};})();;(function(){$fh.__dest__.sec=function(p,s,f){if(!p.act){f(\'bad_act\',{},p);return;}\nif(!p.params){f(\'no_params\',{},p);return;}\nif(!p.params.algorithm){f(\'no_params_algorithm\',{},p);return;}\nvar acts={\'keygen\':function(){if(!p.params.keysize){f(\'no_params_keysize\',{},p);return;}\nif(p.params.algorithm.toLowerCase()!=\"aes\"){f(\'keygen_bad_algorithm\',{},p);return;}\nvar keysize=parseInt(p.params.keysize);if(typeof $fh.Cipher==\"undefined\"){$fh.Cipher=__Crypto.__import(__Crypto,\"titaniumcore.crypto.Cipher\");}\nif(typeof $fh.SecureRandom==\"undefined\"){$fh.SecureRandom=__Crypto.__import(__Crypto,\"titaniumcore.crypto.SecureRandom\");}\nvar r=new $fh.SecureRandom();var key=new Array(keysize);r.nextBytes(key);var hex=__Crypto.base16_encode(key);s({\'algorithm\':\'AES\',\'secretkey\':hex});},\'encrypt\':function(){var found_err=false;var fields={\'aes\':[\'key\',\'plaintext\'],\'rsa\':[\'key\',\'keysize\',\'modulu\',\'plaintext\']};var required=fields[p.params.algorithm.toLowerCase()];if(!required){f(\'encrypt_bad_algorithm\',{},p);return;}\nfor(var i=0;i\x3Crequired;i++){var field=required[i];if(!p.params[field]){found_err=true;f(\'no_paramss_\'+field,{},p);break;}}\nif(found_err){return;}\nvar cipher_text;var rsa_encrypt=function(){var key_size=parseInt(p.params.keysize);var max=parseInt(key_size*2\x2F16+2);setMaxDigits(max);var key=new RSAKeyPair(p.params.key,p.params.key,p.params.modulu);var ori_text=p.params.plaintext;var input=\'\';for(var i=ori_text.length-1;i\x3E=0;i--){input+=ori_text.charAt(i);}\ncipher_text=encryptedString(key,input);}\nvar aes_encrypt=function(){if(typeof $fh.Cipher==\"undefined\"){$fh.Cipher=__Crypto.__import(__Crypto,\"titaniumcore.crypto.Cipher\");}\nvar data=__Crypto.str2utf8(p.params.plaintext);var key=__Crypto.base16_decode(p.params.key);var cipher=$fh.Cipher.create($fh.Cipher.RIJNDAEL,$fh.Cipher.ENCRYPT,$fh.Cipher.ECB,$fh.Cipher.ISO10126);cipher_text=__Crypto.base16_encode(cipher.execute(key,data));}\nif(p.params.algorithm.toLowerCase()==\"rsa\"){rsa_encrypt();}else if(p.params.algorithm.toLowerCase()==\"aes\"){aes_encrypt();}else{f(\'encrypt_bad_algorithm\',{},p);return;}\ns({ciphertext:cipher_text});},\'decrypt\':function(){var found_err=false;var fields={\'aes\':[\'key\',\'ciphertext\']};var required=fields[p.params.algorithm.toLowerCase()];if(!required){f(\'decrypt_bad_algorithm\',{},p);return;}\nfor(var i=0;i\x3Crequired;i++){var field=required[i];if(!p.params[field]){found_err=true;f(\'no_params_\'+field,{},p);break;}}\nif(found_err){return;}\nvar plain_text;var aes_decrypt=function(){if(typeof $fh.Cipher==\"undefined\"){$fh.Cipher=__Crypto.__import(__Crypto,\"titaniumcore.crypto.Cipher\");}\nvar data=__Crypto.base16_decode(p.params.ciphertext);var key=__Crypto.base16_decode(p.params.key);var cipher=$fh.Cipher.create($fh.Cipher.RIJNDAEL,$fh.Cipher.DECRYPT,$fh.Cipher.ECB,$fh.Cipher.ISO10126);plain_text=__Crypto.utf82str(cipher.execute(key,data));}\nif(p.params.algorithm.toLowerCase()==\"aes\"){aes_decrypt();}else{f(\'decrypt_bad_algorithm\',{},p);return;}\ns({\'plaintext\':plain_text});},\'hash\':function(){if(!p.params.text){f(\'hash_no_text\',{},p);return;}\nif(p.params.algorithm.toLowerCase()==\"md5\"){var hash=hex_md5(p.params.text);s({\'hashvalue\':hash});}else{f(\'hash_bad_algorithm\',{},p);return;}}}\nacts[p.act]?acts[p.act]():f(\'data_badact\',p);}\n$fh.__security_loaded=true;})();;(function(){$fh.legacy.parseDate=function(date){var re=new RegExp(\'(\\\\d\\\\d\\\\d\\\\d)-(\\\\d\\\\d)-(\\\\d\\\\d) (\\\\d\\\\d):(\\\\d\\\\d):(\\\\d\\\\d)(:(\\\\d\\\\d\\\\d))?\');var m=re.exec(date);if(m===null){throw\'The supplied string \"\'+date+\'\" must be in the format \"yyyy-MM-dd HH:mm:ss\" or \"yyyy-MM-dd HH:mm:ss:SSS\"\';}else{var retDate=new Date();retDate.setFullYear(m[1]);retDate.setMonth((m[2]-1));retDate.setDate(m[3]);retDate.setHours(m[4]);retDate.setMinutes(m[5]);retDate.setSeconds(m[6]);if(m[8]){retDate.setMilliseconds(m[8]);}\nreturn retDate;}};$fh.legacy.showHeader=function(show){if($fh.legacy.container){$fh.legacy.container[show?\'showHeader\':\'hideHeader\']($fh.legacy.instance);}};$fh.legacy.showFooter=function(show){if($fh.legacy.container){$fh.legacy.container[show?\'showFooter\':\'hideFooter\']($fh.legacy.instance);}};$fh.legacy.loadPrefs=function(callback){var prefs=$fh.legacy.container.getPrefs($fh.legacy.widget.instance);callback(prefs);};$fh.legacy.getPrefs=function(){var prefs=$fh.legacy.container.getPrefs($fh.legacy.widget.instance);return prefs;};$fh.legacy.getFullPrefs=function(callback){$fh.call(\'act\x2Fwid\x2Fprefs\x2Fload\',{instance:$fh.legacy.widget.instance,domain:$fh.legacy.domain,destination:\'sandbox\',mode:\'full\'},function(res){callback(res);});};$fh.legacy.savePrefs=function(prefs,callback){$fh.call(\'act\x2Fwid\x2Fprefs\x2Fsave\',{instance:$fh.legacy.widget.instance,domain:$fh.legacy.domain,destination:$fh.legacy.destinationName,prefs:prefs},callback);};})();\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\n\x2F\x2F Version 1.2.0\n\nif (typeof PhoneGap === \"undefined\") {\n\n\x2F**\n * The order of events during page load and PhoneGap startup is as follows:\n *\n * onDOMContentLoaded         Internal event that is received when the web page is loaded and parsed.\n * window.onload              Body onload event.\n * onNativeReady              Internal event that indicates the PhoneGap native side is ready.\n * onPhoneGapInit             Internal event that kicks off creation of all PhoneGap JavaScript objects (runs constructors).\n * onPhoneGapReady            Internal event fired when all PhoneGap JavaScript objects have been created\n * onPhoneGapInfoReady        Internal event fired when device properties are available\n * onDeviceReady              User event fired to indicate that PhoneGap is ready\n * onResume                   User event fired to indicate a start\x2Fresume lifecycle event\n * onPause                    User event fired to indicate a pause lifecycle event\n * onDestroy                  Internal event fired when app is being destroyed (User should use window.onunload event, not this one).\n *\n * The only PhoneGap events that user code should register for are:\n *      deviceready           PhoneGap native code is initialized and PhoneGap APIs can be called from JavaScript\n *      pause                 App has moved to background\n *      resume                App has returned to foreground\n *\n * Listeners can be registered as:\n *      document.addEventListener(\"deviceready\", myDeviceReadyListener, false);\n *      document.addEventListener(\"resume\", myResumeListener, false);\n *      document.addEventListener(\"pause\", myPauseListener, false);\n *\n * The DOM lifecycle events should be used for saving and restoring state\n *      window.onload\n *      window.onunload\n *\x2F\n\nif (typeof(DeviceInfo) !== \'object\') {\n    var DeviceInfo = {};\n}\n\n\x2F**\n * This represents the PhoneGap API itself, and provides a global namespace for accessing\n * information about the state of PhoneGap.\n * @class\n *\x2F\nvar PhoneGap = {\n    queue: {\n        ready: true,\n        commands: [],\n        timer: null\n    },\n    documentEventHandler: {},   \x2F\x2F Collection of custom document event handlers\n    windowEventHandler: {}      \x2F\x2F Collection of custom window event handlers\n};\n\n\x2F**\n * List of resource files loaded by PhoneGap.\n * This is used to ensure JS and other files are loaded only once.\n *\x2F\nPhoneGap.resources = {base: true};\n\n\x2F**\n * Determine if resource has been loaded by PhoneGap\n *\n * @param name\n * @return\n *\x2F\nPhoneGap.hasResource = function(name) {\n    return PhoneGap.resources[name];\n};\n\n\x2F**\n * Add a resource to list of loaded resources by PhoneGap\n *\n * @param name\n *\x2F\nPhoneGap.addResource = function(name) {\n    PhoneGap.resources[name] = true;\n};\n\n\x2F**\n * Custom pub-sub channel that can have functions subscribed to it\n * @constructor\n *\x2F\nPhoneGap.Channel = function (type)\n{\n    this.type = type;\n    this.handlers = {};\n    this.guid = 0;\n    this.fired = false;\n    this.enabled = true;\n};\n\n\x2F**\n * Subscribes the given function to the channel. Any time that\n * Channel.fire is called so too will the function.\n * Optionally specify an execution context for the function\n * and a guid that can be used to stop subscribing to the channel.\n * Returns the guid.\n *\x2F\nPhoneGap.Channel.prototype.subscribe = function(f, c, g) {\n    \x2F\x2F need a function to call\n    if (f === null) { return; }\n\n    var func = f;\n    if (typeof c === \"object\" \&\& typeof f === \"function\") { func = PhoneGap.close(c, f); }\n\n    g = g || func.observer_guid || f.observer_guid || this.guid++;\n    func.observer_guid = g;\n    f.observer_guid = g;\n    this.handlers[g] = func;\n    return g;\n};\n\n\x2F**\n * Like subscribe but the function is only called once and then it\n * auto-unsubscribes itself.\n *\x2F\nPhoneGap.Channel.prototype.subscribeOnce = function(f, c) {\n    var g = null;\n    var _this = this;\n    var m = function() {\n        f.apply(c || null, arguments);\n        _this.unsubscribe(g);\n    };\n    if (this.fired) {\n        if (typeof c === \"object\" \&\& typeof f === \"function\") { f = PhoneGap.close(c, f); }\n        f.apply(this, this.fireArgs);\n    } else {\n        g = this.subscribe(m);\n    }\n    return g;\n};\n\n\x2F**\n * Unsubscribes the function with the given guid from the channel.\n *\x2F\nPhoneGap.Channel.prototype.unsubscribe = function(g) {\n    if (typeof g === \"function\") { g = g.observer_guid; }\n    this.handlers[g] = null;\n    delete this.handlers[g];\n};\n\n\x2F**\n * Calls all functions subscribed to this channel.\n *\x2F\nPhoneGap.Channel.prototype.fire = function(e) {\n    if (this.enabled) {\n        var fail = false;\n        var item, handler, rv;\n        for (item in this.handlers) {\n            if (this.handlers.hasOwnProperty(item)) {\n                handler = this.handlers[item];\n                if (typeof handler === \"function\") {\n                    rv = (handler.apply(this, arguments) === false);\n                    fail = fail || rv;\n                }\n            }\n        }\n        this.fired = true;\n        this.fireArgs = arguments;\n        return !fail;\n    }\n    return true;\n};\n\n\x2F**\n * Calls the provided function only after all of the channels specified\n * have been fired.\n *\x2F\nPhoneGap.Channel.join = function(h, c) {\n    var i = c.length;\n    var f = function() {\n        if (!(--i)) {\n            h();\n        }\n    };\n    var len = i;\n    var j;\n    for (j=0; j\x3Clen; j++) {\n        if (!c[j].fired) {\n            c[j].subscribeOnce(f);\n        }\n        else {\n            i--;\n        }\n    }\n    if (!i) {\n        h();\n    }\n};\n\n\x2F**\n * Boolean flag indicating if the PhoneGap API is available and initialized.\n *\x2F \x2F\x2F TODO: Remove this, it is unused here ... -jm\nPhoneGap.available = DeviceInfo.uuid !== undefined;\n\n\x2F**\n * Add an initialization function to a queue that ensures it will run and initialize\n * application constructors only once PhoneGap has been initialized.\n * @param {Function} func The function callback you want run once PhoneGap is initialized\n *\x2F\nPhoneGap.addConstructor = function(func) {\n    PhoneGap.onPhoneGapInit.subscribeOnce(function() {\n        try {\n            func();\n        } catch(e) {\n            console.log(\"Failed to run constructor: \" + e);\n        }\n    });\n};\n\n\x2F**\n * Plugins object\n *\x2F\nif (!window.plugins) {\n    window.plugins = {};\n}\n\n\x2F**\n * Adds a plugin object to window.plugins.\n * The plugin is accessed using window.plugins.\x3Cname\x3E\n *\n * @param name          The plugin name\n * @param obj           The plugin object\n *\x2F\nPhoneGap.addPlugin = function(name, obj) {\n    if (!window.plugins[name]) {\n        window.plugins[name] = obj;\n    }\n    else {\n        console.log(\"Error: Plugin \"+name+\" already exists.\");\n    }\n};\n\n\x2F**\n * onDOMContentLoaded channel is fired when the DOM content\n * of the page has been parsed.\n *\x2F\nPhoneGap.onDOMContentLoaded = new PhoneGap.Channel(\'onDOMContentLoaded\');\n\n\x2F**\n * onNativeReady channel is fired when the PhoneGap native code\n * has been initialized.\n *\x2F\nPhoneGap.onNativeReady = new PhoneGap.Channel(\'onNativeReady\');\n\n\x2F**\n * onPhoneGapInit channel is fired when the web page is fully loaded and\n * PhoneGap native code has been initialized.\n *\x2F\nPhoneGap.onPhoneGapInit = new PhoneGap.Channel(\'onPhoneGapInit\');\n\n\x2F**\n * onPhoneGapReady channel is fired when the JS PhoneGap objects have been created.\n *\x2F\nPhoneGap.onPhoneGapReady = new PhoneGap.Channel(\'onPhoneGapReady\');\n\n\x2F**\n * onPhoneGapInfoReady channel is fired when the PhoneGap device properties\n * has been set.\n *\x2F\nPhoneGap.onPhoneGapInfoReady = new PhoneGap.Channel(\'onPhoneGapInfoReady\');\n\n\x2F**\n * onPhoneGapConnectionReady channel is fired when the PhoneGap connection properties\n * has been set.\n *\x2F\nPhoneGap.onPhoneGapConnectionReady = new PhoneGap.Channel(\'onPhoneGapConnectionReady\');\n\n\x2F**\n * onResume channel is fired when the PhoneGap native code\n * resumes.\n *\x2F\nPhoneGap.onResume = new PhoneGap.Channel(\'onResume\');\n\n\x2F**\n * onPause channel is fired when the PhoneGap native code\n * pauses.\n *\x2F\nPhoneGap.onPause = new PhoneGap.Channel(\'onPause\');\n\n\x2F**\n * onDestroy channel is fired when the PhoneGap native code\n * is destroyed.  It is used internally.\n * Window.onunload should be used by the user.\n *\x2F\nPhoneGap.onDestroy = new PhoneGap.Channel(\'onDestroy\');\nPhoneGap.onDestroy.subscribeOnce(function() {\n    PhoneGap.shuttingDown = true;\n});\nPhoneGap.shuttingDown = false;\n\n\x2F\x2F _nativeReady is global variable that the native side can set\n\x2F\x2F to signify that the native code is ready. It is a global since\n\x2F\x2F it may be called before any PhoneGap JS is ready.\nif (typeof _nativeReady !== \'undefined\') { PhoneGap.onNativeReady.fire(); }\n\n\x2F**\n * onDeviceReady is fired only after all PhoneGap objects are created and\n * the device properties are set.\n *\x2F\nPhoneGap.onDeviceReady = new PhoneGap.Channel(\'onDeviceReady\');\n\n\n\x2F\x2F Array of channels that must fire before \"deviceready\" is fired\nPhoneGap.deviceReadyChannelsArray = [ PhoneGap.onPhoneGapReady, PhoneGap.onPhoneGapInfoReady, PhoneGap.onPhoneGapConnectionReady];\n\n\x2F\x2F Hashtable of user defined channels that must also fire before \"deviceready\" is fired\nPhoneGap.deviceReadyChannelsMap = {};\n\n\x2F**\n * Indicate that a feature needs to be initialized before it is ready to be used.\n * This holds up PhoneGap\'s \"deviceready\" event until the feature has been initialized\n * and PhoneGap.initComplete(feature) is called.\n *\n * @param feature {String}     The unique feature name\n *\x2F\nPhoneGap.waitForInitialization = function(feature) {\n    if (feature) {\n        var channel = new PhoneGap.Channel(feature);\n        PhoneGap.deviceReadyChannelsMap[feature] = channel;\n        PhoneGap.deviceReadyChannelsArray.push(channel);\n    }\n};\n\n\x2F**\n * Indicate that initialization code has completed and the feature is ready to be used.\n *\n * @param feature {String}     The unique feature name\n *\x2F\nPhoneGap.initializationComplete = function(feature) {\n    var channel = PhoneGap.deviceReadyChannelsMap[feature];\n    if (channel) {\n        channel.fire();\n    }\n};\n\n\x2F**\n * Create all PhoneGap objects once page has fully loaded and native side is ready.\n *\x2F\nPhoneGap.Channel.join(function() {\n\n    \x2F\x2F Start listening for XHR callbacks\n    setTimeout(function() {\n            if (PhoneGap.UsePolling) {\n                PhoneGap.JSCallbackPolling();\n            }\n            else {\n                var polling = prompt(\"usePolling\", \"gap_callbackServer:\");\n                PhoneGap.UsePolling = polling;\n                if (polling == \"true\") {\n                    PhoneGap.UsePolling = true;\n                    PhoneGap.JSCallbackPolling();\n                }\n                else {\n                    PhoneGap.UsePolling = false;\n                    PhoneGap.JSCallback();\n                }\n            }\n        }, 1);\n\n    \x2F\x2F Run PhoneGap constructors\n    PhoneGap.onPhoneGapInit.fire();\n\n    \x2F\x2F Fire event to notify that all objects are created\n    PhoneGap.onPhoneGapReady.fire();\n\n    \x2F\x2F Fire onDeviceReady event once all constructors have run and PhoneGap info has been\n    \x2F\x2F received from native side, and any user defined initialization channels.\n    PhoneGap.Channel.join(function() {\n        \x2F\x2F Let native code know we are inited on JS side\n        prompt(\"\", \"gap_init:\");\n\n        PhoneGap.onDeviceReady.fire();\n    }, PhoneGap.deviceReadyChannelsArray);\n\n}, [ PhoneGap.onDOMContentLoaded, PhoneGap.onNativeReady ]);\n\n\x2F\x2F Listen for DOMContentLoaded and notify our channel subscribers\ndocument.addEventListener(\'DOMContentLoaded\', function() {\n    PhoneGap.onDOMContentLoaded.fire();\n}, false);\n\n\x2F\x2F Intercept calls to document.addEventListener and watch for deviceready\nPhoneGap.m_document_addEventListener = document.addEventListener;\n\n\x2F\x2F Intercept calls to window.addEventListener\nPhoneGap.m_window_addEventListener = window.addEventListener;\n\n\x2F**\n * Add a custom window event handler.\n *\n * @param {String} event            The event name that callback handles\n * @param {Function} callback       The event handler\n *\x2F\nPhoneGap.addWindowEventHandler = function(event, callback) {\n    PhoneGap.windowEventHandler[event] = callback;\n}\n\n\x2F**\n * Add a custom document event handler.\n *\n * @param {String} event            The event name that callback handles\n * @param {Function} callback       The event handler\n *\x2F\nPhoneGap.addDocumentEventHandler = function(event, callback) {\n    PhoneGap.documentEventHandler[event] = callback;\n}\n\n\x2F**\n * Intercept adding document event listeners and handle our own\n *\n * @param {Object} evt\n * @param {Function} handler\n * @param capture\n *\x2F\ndocument.addEventListener = function(evt, handler, capture) {\n    var e = evt.toLowerCase();\n    if (e === \'deviceready\') {\n        PhoneGap.onDeviceReady.subscribeOnce(handler);\n    } else if (e === \'resume\') {\n        PhoneGap.onResume.subscribe(handler);\n        if (PhoneGap.onDeviceReady.fired) {\n            PhoneGap.onResume.fire();\n        }\n    } else if (e === \'pause\') {\n        PhoneGap.onPause.subscribe(handler);\n    }\n    else {\n        \x2F\x2F If subscribing to Android backbutton\n        if (e === \'backbutton\') {\n            PhoneGap.exec(null, null, \"App\", \"overrideBackbutton\", [true]);\n        }\n        \n        \x2F\x2F If subscribing to an event that is handled by a plugin\n        else if (typeof PhoneGap.documentEventHandler[e] !== \"undefined\") {\n            if (PhoneGap.documentEventHandler[e](e, handler, true)) {\n                return; \x2F\x2F Stop default behavior\n            }\n        }\n        \n        PhoneGap.m_document_addEventListener.call(document, evt, handler, capture);\n    }\n};\n\n\x2F**\n * Intercept adding window event listeners and handle our own\n *\n * @param {Object} evt\n * @param {Function} handler\n * @param capture\n *\x2F\nwindow.addEventListener = function(evt, handler, capture) {\n    var e = evt.toLowerCase();\n        \n    \x2F\x2F If subscribing to an event that is handled by a plugin\n    if (typeof PhoneGap.windowEventHandler[e] !== \"undefined\") {\n        if (PhoneGap.windowEventHandler[e](e, handler, true)) {\n            return; \x2F\x2F Stop default behavior\n        }\n    }\n        \n    PhoneGap.m_window_addEventListener.call(window, evt, handler, capture);\n};\n\n\x2F\x2F Intercept calls to document.removeEventListener and watch for events that\n\x2F\x2F are generated by PhoneGap native code\nPhoneGap.m_document_removeEventListener = document.removeEventListener;\n\n\x2F\x2F Intercept calls to window.removeEventListener\nPhoneGap.m_window_removeEventListener = window.removeEventListener;\n\n\x2F**\n * Intercept removing document event listeners and handle our own\n *\n * @param {Object} evt\n * @param {Function} handler\n * @param capture\n *\x2F\ndocument.removeEventListener = function(evt, handler, capture) {\n    var e = evt.toLowerCase();\n\n    \x2F\x2F If unsubscribing to Android backbutton\n    if (e === \'backbutton\') {\n        PhoneGap.exec(null, null, \"App\", \"overrideBackbutton\", [false]);\n    }\n\n    \x2F\x2F If unsubcribing from an event that is handled by a plugin\n    if (typeof PhoneGap.documentEventHandler[e] !== \"undefined\") {\n        if (PhoneGap.documentEventHandler[e](e, handler, false)) {\n            return; \x2F\x2F Stop default behavior\n        }\n    }\n\n    PhoneGap.m_document_removeEventListener.call(document, evt, handler, capture);\n};\n\n\x2F**\n * Intercept removing window event listeners and handle our own\n *\n * @param {Object} evt\n * @param {Function} handler\n * @param capture\n *\x2F\nwindow.removeEventListener = function(evt, handler, capture) {\n    var e = evt.toLowerCase();\n\n    \x2F\x2F If unsubcribing from an event that is handled by a plugin\n    if (typeof PhoneGap.windowEventHandler[e] !== \"undefined\") {\n        if (PhoneGap.windowEventHandler[e](e, handler, false)) {\n            return; \x2F\x2F Stop default behavior\n        }\n    }\n\n    PhoneGap.m_window_removeEventListener.call(window, evt, handler, capture);\n};\n\n\x2F**\n * Method to fire document event\n *\n * @param {String} type             The event type to fire\n * @param {Object} data             Data to send with event\n *\x2F\nPhoneGap.fireDocumentEvent = function(type, data) {\n    var e = document.createEvent(\'Events\');\n    e.initEvent(type);\n    if (data) {\n        for (var i in data) {\n            e[i] = data[i];\n        }\n    }\n    document.dispatchEvent(e);\n};\n\n\x2F**\n * Method to fire window event\n *\n * @param {String} type             The event type to fire\n * @param {Object} data             Data to send with event\n *\x2F\nPhoneGap.fireWindowEvent = function(type, data) {\n    var e = document.createEvent(\'Events\');\n    e.initEvent(type);\n    if (data) {\n        for (var i in data) {\n            e[i] = data[i];\n        }\n    }\n    window.dispatchEvent(e);\n};\n\n\x2F**\n * If JSON not included, use our own stringify. (Android 1.6)\n * The restriction on ours is that it must be an array of simple types.\n *\n * @param args\n * @return {String}\n *\x2F\nPhoneGap.stringify = function(args) {\n    if (typeof JSON === \"undefined\") {\n        var s = \"[\";\n        var i, type, start, name, nameType, a;\n        for (i = 0; i \x3C args.length; i++) {\n            if (args[i] !== null) {\n                if (i \x3E 0) {\n                    s = s + \",\";\n                }\n                type = typeof args[i];\n                if ((type === \"number\") || (type === \"boolean\")) {\n                    s = s + args[i];\n                } else if (args[i] instanceof Array) {\n                    s = s + \"[\" + args[i] + \"]\";\n                } else if (args[i] instanceof Object) {\n                    start = true;\n                    s = s + \'{\';\n                    for (name in args[i]) {\n                        if (args[i][name] !== null) {\n                            if (!start) {\n                                s = s + \',\';\n                            }\n                            s = s + \'\"\' + name + \'\":\';\n                            nameType = typeof args[i][name];\n                            if ((nameType === \"number\") || (nameType === \"boolean\")) {\n                                s = s + args[i][name];\n                            } else if ((typeof args[i][name]) === \'function\') {\n                                \x2F\x2F don\'t copy the functions\n                                s = s + \'\"\"\';\n                            } else if (args[i][name] instanceof Object) {\n                                s = s + PhoneGap.stringify(args[i][name]);\n                            } else {\n                                s = s + \'\"\' + args[i][name] + \'\"\';\n                            }\n                            start = false;\n                        }\n                    }\n                    s = s + \'}\';\n                } else {\n                    a = args[i].replace(\x2F\\\\\x2Fg, \'\\\\\\\\\');\n                    a = a.replace(\x2F\"\x2Fg, \'\\\\\"\');\n                    s = s + \'\"\' + a + \'\"\';\n                }\n            }\n        }\n        s = s + \"]\";\n        return s;\n    } else {\n        return JSON.stringify(args);\n    }\n};\n\n\x2F**\n * Does a deep clone of the object.\n *\n * @param obj\n * @return {Object}\n *\x2F\nPhoneGap.clone = function(obj) {\n    var i, retVal;\n    if(!obj) { \n        return obj;\n    }\n    \n    if(obj instanceof Array){\n        retVal = [];\n        for(i = 0; i \x3C obj.length; ++i){\n            retVal.push(PhoneGap.clone(obj[i]));\n        }\n        return retVal;\n    }\n    \n    if (typeof obj === \"function\") {\n        return obj;\n    }\n    \n    if(!(obj instanceof Object)){\n        return obj;\n    }\n    \n    if (obj instanceof Date) {\n        return obj;\n    }\n    \n    retVal = {};\n    for(i in obj){\n        if(!(i in retVal) || retVal[i] !== obj[i]) {\n            retVal[i] = PhoneGap.clone(obj[i]);\n        }\n    }\n    return retVal;\n};\n\nPhoneGap.callbackId = 0;\nPhoneGap.callbacks = {};\nPhoneGap.callbackStatus = {\n    NO_RESULT: 0,\n    OK: 1,\n    CLASS_NOT_FOUND_EXCEPTION: 2,\n    ILLEGAL_ACCESS_EXCEPTION: 3,\n    INSTANTIATION_EXCEPTION: 4,\n    MALFORMED_URL_EXCEPTION: 5,\n    IO_EXCEPTION: 6,\n    INVALID_ACTION: 7,\n    JSON_EXCEPTION: 8,\n    ERROR: 9\n    };\n\n\n\x2F**\n * Execute a PhoneGap command.  It is up to the native side whether this action is synch or async.\n * The native side can return:\n *      Synchronous: PluginResult object as a JSON string\n *      Asynchrounous: Empty string \"\"\n * If async, the native side will PhoneGap.callbackSuccess or PhoneGap.callbackError,\n * depending upon the result of the action.\n *\n * @param {Function} success    The success callback\n * @param {Function} fail       The fail callback\n * @param {String} service      The name of the service to use\n * @param {String} action       Action to be run in PhoneGap\n * @param {Array.\x3CString\x3E} [args]     Zero or more arguments to pass to the method\n *\x2F\nPhoneGap.exec = function(success, fail, service, action, args) {\n    try {\n        var callbackId = service + PhoneGap.callbackId++;\n        if (success || fail) {\n            PhoneGap.callbacks[callbackId] = {success:success, fail:fail};\n        }\n\n        var r = prompt(PhoneGap.stringify(args), \"gap:\"+PhoneGap.stringify([service, action, callbackId, true]));\n\n        \x2F\x2F If a result was returned\n        if (r.length \x3E 0) {\n            eval(\"var v=\"+r+\";\");\n\n            \x2F\x2F If status is OK, then return value back to caller\n            if (v.status === PhoneGap.callbackStatus.OK) {\n\n                \x2F\x2F If there is a success callback, then call it now with\n                \x2F\x2F returned value\n                if (success) {\n                    try {\n                        success(v.message);\n                    } catch (e) {\n                        console.log(\"Error in success callback: \" + callbackId  + \" = \" + e);\n                    }\n\n                    \x2F\x2F Clear callback if not expecting any more results\n                    if (!v.keepCallback) {\n                        delete PhoneGap.callbacks[callbackId];\n                    }\n                }\n                return v.message;\n            }\n\n            \x2F\x2F If no result\n            else if (v.status === PhoneGap.callbackStatus.NO_RESULT) {\n\n                \x2F\x2F Clear callback if not expecting any more results\n                if (!v.keepCallback) {\n                    delete PhoneGap.callbacks[callbackId];\n                }\n            }\n\n            \x2F\x2F If error, then display error\n            else {\n                console.log(\"Error: Status=\"+v.status+\" Message=\"+v.message);\n\n                \x2F\x2F If there is a fail callback, then call it now with returned value\n                if (fail) {\n                    try {\n                        fail(v.message);\n                    }\n                    catch (e1) {\n                        console.log(\"Error in error callback: \"+callbackId+\" = \"+e1);\n                    }\n\n                    \x2F\x2F Clear callback if not expecting any more results\n                    if (!v.keepCallback) {\n                        delete PhoneGap.callbacks[callbackId];\n                    }\n                }\n                return null;\n            }\n        }\n    } catch (e2) {\n        console.log(\"Error: \"+e2);\n    }\n};\n\n\x2F**\n * Called by native code when returning successful result from an action.\n *\n * @param callbackId\n * @param args\n *\x2F\nPhoneGap.callbackSuccess = function(callbackId, args) {\n    if (PhoneGap.callbacks[callbackId]) {\n\n        \x2F\x2F If result is to be sent to callback\n        if (args.status === PhoneGap.callbackStatus.OK) {\n            try {\n                if (PhoneGap.callbacks[callbackId].success) {\n                    PhoneGap.callbacks[callbackId].success(args.message);\n                }\n            }\n            catch (e) {\n                console.log(\"Error in success callback: \"+callbackId+\" = \"+e);\n            }\n        }\n\n        \x2F\x2F Clear callback if not expecting any more results\n        if (!args.keepCallback) {\n            delete PhoneGap.callbacks[callbackId];\n        }\n    }\n};\n\n\x2F**\n * Called by native code when returning error result from an action.\n *\n * @param callbackId\n * @param args\n *\x2F\nPhoneGap.callbackError = function(callbackId, args) {\n    if (PhoneGap.callbacks[callbackId]) {\n        try {\n            if (PhoneGap.callbacks[callbackId].fail) {\n                PhoneGap.callbacks[callbackId].fail(args.message);\n            }\n        }\n        catch (e) {\n            console.log(\"Error in error callback: \"+callbackId+\" = \"+e);\n        }\n\n        \x2F\x2F Clear callback if not expecting any more results\n        if (!args.keepCallback) {\n            delete PhoneGap.callbacks[callbackId];\n        }\n    }\n};\n\n\n\x2F**\n * Internal function used to dispatch the request to PhoneGap.  It processes the\n * command queue and executes the next command on the list.  If one of the\n * arguments is a JavaScript object, it will be passed on the QueryString of the\n * url, which will be turned into a dictionary on the other end.\n * @private\n *\x2F\n\x2F\x2F TODO: Is this used?\nPhoneGap.run_command = function() {\n    if (!PhoneGap.available || !PhoneGap.queue.ready) {\n        return;\n    }\n    PhoneGap.queue.ready = false;\n\n    var args = PhoneGap.queue.commands.shift();\n    if (PhoneGap.queue.commands.length === 0) {\n        clearInterval(PhoneGap.queue.timer);\n        PhoneGap.queue.timer = null;\n    }\n\n    var uri = [];\n    var dict = null;\n    var i;\n    for (i = 1; i \x3C args.length; i++) {\n        var arg = args[i];\n        if (arg === undefined || arg === null) {\n            arg = \'\';\n        }\n        if (typeof(arg) === \'object\') {\n            dict = arg;\n        } else {\n            uri.push(encodeURIComponent(arg));\n        }\n    }\n    var url = \"gap:\x2F\x2F\" + args[0] + \"\x2F\" + uri.join(\"\x2F\");\n    if (dict !== null) {\n        var name;\n        var query_args = [];\n        for (name in dict) {\n            if (dict.hasOwnProperty(name) \&\& (typeof (name) === \'string\')) {\n                query_args.push(encodeURIComponent(name) + \"=\" + encodeURIComponent(dict[name]));\n            }\n        }\n        if (query_args.length \x3E 0) {\n            url += \"?\" + query_args.join(\"\&\");\n        }\n    }\n    document.location = url;\n\n};\n\nPhoneGap.JSCallbackPort = null;\nPhoneGap.JSCallbackToken = null;\n\n\x2F**\n * This is only for Android.\n *\n * Internal function that uses XHR to call into PhoneGap Java code and retrieve\n * any JavaScript code that needs to be run.  This is used for callbacks from\n * Java to JavaScript.\n *\x2F\nPhoneGap.JSCallback = function() {\n\n    \x2F\x2F Exit if shutting down app\n    if (PhoneGap.shuttingDown) {\n        return;\n    }\n\n    \x2F\x2F If polling flag was changed, start using polling from now on\n    if (PhoneGap.UsePolling) {\n        PhoneGap.JSCallbackPolling();\n        return;\n    }\n\n    var xmlhttp = new XMLHttpRequest();\n\n    \x2F\x2F Callback function when XMLHttpRequest is ready\n    xmlhttp.onreadystatechange=function(){\n        if(xmlhttp.readyState === 4){\n\n            \x2F\x2F Exit if shutting down app\n            if (PhoneGap.shuttingDown) {\n                return;\n            }\n\n            \x2F\x2F If callback has JavaScript statement to execute\n            if (xmlhttp.status === 200) {\n\n                \x2F\x2F Need to url decode the response\n                var msg = decodeURIComponent(xmlhttp.responseText);\n                setTimeout(function() {\n                    try {\n                        var t = eval(msg);\n                    }\n                    catch (e) {\n                        \x2F\x2F If we\'re getting an error here, seeing the message will help in debugging\n                        console.log(\"JSCallback: Message from Server: \" + msg);\n                        console.log(\"JSCallback Error: \"+e);\n                    }\n                }, 1);\n                setTimeout(PhoneGap.JSCallback, 1);\n            }\n\n            \x2F\x2F If callback ping (used to keep XHR request from timing out)\n            else if (xmlhttp.status === 404) {\n                setTimeout(PhoneGap.JSCallback, 10);\n            }\n\n            \x2F\x2F If security error\n            else if (xmlhttp.status === 403) {\n                console.log(\"JSCallback Error: Invalid token.  Stopping callbacks.\");\n            }\n\n            \x2F\x2F If server is stopping\n            else if (xmlhttp.status === 503) {\n                console.log(\"JSCallback Server Closed: Stopping callbacks.\");\n            }\n\n            \x2F\x2F If request wasn\'t GET\n            else if (xmlhttp.status === 400) {\n                console.log(\"JSCallback Error: Bad request.  Stopping callbacks.\");\n            }\n\n            \x2F\x2F If error, revert to polling\n            else {\n                console.log(\"JSCallback Error: Request failed.\");\n                PhoneGap.UsePolling = true;\n                PhoneGap.JSCallbackPolling();\n            }\n        }\n    };\n\n    if (PhoneGap.JSCallbackPort === null) {\n        PhoneGap.JSCallbackPort = prompt(\"getPort\", \"gap_callbackServer:\");\n    }\n    if (PhoneGap.JSCallbackToken === null) {\n        PhoneGap.JSCallbackToken = prompt(\"getToken\", \"gap_callbackServer:\");\n    }\n    xmlhttp.open(\"GET\", \"http:\x2F\x2F127.0.0.1:\"+PhoneGap.JSCallbackPort+\"\x2F\"+PhoneGap.JSCallbackToken , true);\n    xmlhttp.send();\n};\n\n\x2F**\n * The polling period to use with JSCallbackPolling.\n * This can be changed by the application.  The default is 50ms.\n *\x2F\nPhoneGap.JSCallbackPollingPeriod = 50;\n\n\x2F**\n * Flag that can be set by the user to force polling to be used or force XHR to be used.\n *\x2F\nPhoneGap.UsePolling = false;    \x2F\x2F T=use polling, F=use XHR\n\n\x2F**\n * This is only for Android.\n *\n * Internal function that uses polling to call into PhoneGap Java code and retrieve\n * any JavaScript code that needs to be run.  This is used for callbacks from\n * Java to JavaScript.\n *\x2F\nPhoneGap.JSCallbackPolling = function() {\n\n    \x2F\x2F Exit if shutting down app\n    if (PhoneGap.shuttingDown) {\n        return;\n    }\n\n    \x2F\x2F If polling flag was changed, stop using polling from now on\n    if (!PhoneGap.UsePolling) {\n        PhoneGap.JSCallback();\n        return;\n    }\n\n    var msg = prompt(\"\", \"gap_poll:\");\n    if (msg) {\n        setTimeout(function() {\n            try {\n                var t = eval(\"\"+msg);\n            }\n            catch (e) {\n                console.log(\"JSCallbackPolling: Message from Server: \" + msg);\n                console.log(\"JSCallbackPolling Error: \"+e);\n            }\n        }, 1);\n        setTimeout(PhoneGap.JSCallbackPolling, 1);\n    }\n    else {\n        setTimeout(PhoneGap.JSCallbackPolling, PhoneGap.JSCallbackPollingPeriod);\n    }\n};\n\n\x2F**\n * Create a UUID\n *\n * @return {String}\n *\x2F\nPhoneGap.createUUID = function() {\n    return PhoneGap.UUIDcreatePart(4) + \'-\' +\n        PhoneGap.UUIDcreatePart(2) + \'-\' +\n        PhoneGap.UUIDcreatePart(2) + \'-\' +\n        PhoneGap.UUIDcreatePart(2) + \'-\' +\n        PhoneGap.UUIDcreatePart(6);\n};\n\nPhoneGap.UUIDcreatePart = function(length) {\n    var uuidpart = \"\";\n    var i, uuidchar;\n    for (i=0; i\x3Clength; i++) {\n        uuidchar = parseInt((Math.random() * 256),0).toString(16);\n        if (uuidchar.length === 1) {\n            uuidchar = \"0\" + uuidchar;\n        }\n        uuidpart += uuidchar;\n    }\n    return uuidpart;\n};\n\nPhoneGap.close = function(context, func, params) {\n    if (typeof params === \'undefined\') {\n        return function() {\n            return func.apply(context, arguments);\n        };\n    } else {\n        return function() {\n            return func.apply(context, params);\n        };\n    }\n};\n\n\x2F**\n * Load a JavaScript file after page has loaded.\n *\n * @param {String} jsfile               The url of the JavaScript file to load.\n * @param {Function} successCallback    The callback to call when the file has been loaded.\n *\x2F\nPhoneGap.includeJavascript = function(jsfile, successCallback) {\n    var id = document.getElementsByTagName(\"head\")[0];\n    var el = document.createElement(\'script\');\n    el.type = \'text\x2Fjavascript\';\n    if (typeof successCallback === \'function\') {\n        el.onload = successCallback;\n    }\n    el.src = jsfile;\n    id.appendChild(el);\n};\n\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"accelerometer\")) {\nPhoneGap.addResource(\"accelerometer\");\n\n\x2F** @constructor *\x2F\nvar Acceleration = function(x, y, z) {\n  this.x = x;\n  this.y = y;\n  this.z = z;\n  this.timestamp = new Date().getTime();\n};\n\n\x2F**\n * This class provides access to device accelerometer data.\n * @constructor\n *\x2F\nvar Accelerometer = function() {\n\n    \x2F**\n     * The last known acceleration.  type=Acceleration()\n     *\x2F\n    this.lastAcceleration = null;\n\n    \x2F**\n     * List of accelerometer watch timers\n     *\x2F\n    this.timers = {};\n};\n\nAccelerometer.ERROR_MSG = [\"Not running\", \"Starting\", \"\", \"Failed to start\"];\n\n\x2F**\n * Asynchronously aquires the current acceleration.\n *\n * @param {Function} successCallback    The function to call when the acceleration data is available\n * @param {Function} errorCallback      The function to call when there is an error getting the acceleration data. (OPTIONAL)\n * @param {AccelerationOptions} options The options for getting the accelerometer data such as timeout. (OPTIONAL)\n *\x2F\nAccelerometer.prototype.getCurrentAcceleration = function(successCallback, errorCallback, options) {\n\n    \x2F\x2F successCallback required\n    if (typeof successCallback !== \"function\") {\n        console.log(\"Accelerometer Error: successCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F errorCallback optional\n    if (errorCallback \&\& (typeof errorCallback !== \"function\")) {\n        console.log(\"Accelerometer Error: errorCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F Get acceleration\n    PhoneGap.exec(successCallback, errorCallback, \"Accelerometer\", \"getAcceleration\", []);\n};\n\n\x2F**\n * Asynchronously aquires the acceleration repeatedly at a given interval.\n *\n * @param {Function} successCallback    The function to call each time the acceleration data is available\n * @param {Function} errorCallback      The function to call when there is an error getting the acceleration data. (OPTIONAL)\n * @param {AccelerationOptions} options The options for getting the accelerometer data such as timeout. (OPTIONAL)\n * @return String                       The watch id that must be passed to #clearWatch to stop watching.\n *\x2F\nAccelerometer.prototype.watchAcceleration = function(successCallback, errorCallback, options) {\n\n    \x2F\x2F Default interval (10 sec)\n    var frequency = (options !== undefined)? options.frequency : 10000;\n\n    \x2F\x2F successCallback required\n    if (typeof successCallback !== \"function\") {\n        console.log(\"Accelerometer Error: successCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F errorCallback optional\n    if (errorCallback \&\& (typeof errorCallback !== \"function\")) {\n        console.log(\"Accelerometer Error: errorCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F Make sure accelerometer timeout \x3E frequency + 10 sec\n    PhoneGap.exec(\n        function(timeout) {\n            if (timeout \x3C (frequency + 10000)) {\n                PhoneGap.exec(null, null, \"Accelerometer\", \"setTimeout\", [frequency + 10000]);\n            }\n        },\n        function(e) { }, \"Accelerometer\", \"getTimeout\", []);\n\n    \x2F\x2F Start watch timer\n    var id = PhoneGap.createUUID();\n    navigator.accelerometer.timers[id] = setInterval(function() {\n        PhoneGap.exec(successCallback, errorCallback, \"Accelerometer\", \"getAcceleration\", []);\n    }, (frequency ? frequency : 1));\n\n    return id;\n};\n\n\x2F**\n * Clears the specified accelerometer watch.\n *\n * @param {String} id       The id of the watch returned from #watchAcceleration.\n *\x2F\nAccelerometer.prototype.clearWatch = function(id) {\n\n    \x2F\x2F Stop javascript timer \& remove from timer list\n    if (id \&\& navigator.accelerometer.timers[id] !== undefined) {\n        clearInterval(navigator.accelerometer.timers[id]);\n        delete navigator.accelerometer.timers[id];\n    }\n};\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.accelerometer === \"undefined\") {\n        navigator.accelerometer = new Accelerometer();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"app\")) {\nPhoneGap.addResource(\"app\");\n(function() {\n\n\x2F**\n * Constructor\n * @constructor\n *\x2F\nvar App = function() {};\n\n\x2F**\n * Clear the resource cache.\n *\x2F\nApp.prototype.clearCache = function() {\n    PhoneGap.exec(null, null, \"App\", \"clearCache\", []);\n};\n\n\x2F**\n * Load the url into the webview or into new browser instance.\n *\n * @param url           The URL to load\n * @param props         Properties that can be passed in to the activity:\n *      wait: int                           =\x3E wait msec before loading URL\n *      loadingDialog: \"Title,Message\"      =\x3E display a native loading dialog\n *      loadUrlTimeoutValue: int            =\x3E time in msec to wait before triggering a timeout error\n *      clearHistory: boolean              =\x3E clear webview history (default=false)\n *      openExternal: boolean              =\x3E open in a new browser (default=false)\n *\n * Example:\n *      navigator.app.loadUrl(\"http:\x2F\x2Fserver\x2Fmyapp\x2Findex.html\", {wait:2000, loadingDialog:\"Wait,Loading App\", loadUrlTimeoutValue: 60000});\n *\x2F\nApp.prototype.loadUrl = function(url, props) {\n    PhoneGap.exec(null, null, \"App\", \"loadUrl\", [url, props]);\n};\n\n\x2F**\n * Cancel loadUrl that is waiting to be loaded.\n *\x2F\nApp.prototype.cancelLoadUrl = function() {\n    PhoneGap.exec(null, null, \"App\", \"cancelLoadUrl\", []);\n};\n\n\x2F**\n * Clear web history in this web view.\n * Instead of BACK button loading the previous web page, it will exit the app.\n *\x2F\nApp.prototype.clearHistory = function() {\n    PhoneGap.exec(null, null, \"App\", \"clearHistory\", []);\n};\n\n\x2F**\n * Go to previous page displayed.\n * This is the same as pressing the backbutton on Android device.\n *\x2F\nApp.prototype.backHistory = function() {\n    PhoneGap.exec(null, null, \"App\", \"backHistory\", []);\n};\n\n\x2F**\n * Override the default behavior of the Android back button.\n * If overridden, when the back button is pressed, the \"backKeyDown\" JavaScript event will be fired.\n *\n * Note: The user should not have to call this method.  Instead, when the user\n *       registers for the \"backbutton\" event, this is automatically done.\n *\n * @param override\t\tT=override, F=cancel override\n *\x2F\nApp.prototype.overrideBackbutton = function(override) {\n    PhoneGap.exec(null, null, \"App\", \"overrideBackbutton\", [override]);\n};\n\n\x2F**\n * Exit and terminate the application.\n *\x2F\nApp.prototype.exitApp = function() {\n\treturn PhoneGap.exec(null, null, \"App\", \"exitApp\", []);\n};\n\n\x2F**\n * Add entry to approved list of URLs (whitelist) that will be loaded into PhoneGap container instead of default browser.\n * \n * @param origin\t\tURL regular expression to allow\n * @param subdomains\tT=include all subdomains under origin\n *\x2F\nApp.prototype.addWhiteListEntry = function(origin, subdomains) {\n\treturn PhoneGap.exec(null, null, \"App\", \"addWhiteListEntry\", [origin, subdomains]);\t\n};\n\nPhoneGap.addConstructor(function() {\n    navigator.app = new App();\n});\n}());\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"battery\")) {\nPhoneGap.addResource(\"battery\");\n\n\x2F**\n * This class contains information about the current battery status.\n * @constructor\n *\x2F\nvar Battery = function() {\n    this._level = null;\n    this._isPlugged = null;\n    this._batteryListener = [];\n    this._lowListener = [];\n    this._criticalListener = [];\n};\n\n\x2F**\n * Registers as an event producer for battery events.\n * \n * @param {Object} eventType\n * @param {Object} handler\n * @param {Object} add\n *\x2F\nBattery.prototype.eventHandler = function(eventType, handler, add) {\n    var me = navigator.battery;\n    if (add) {\n        \x2F\x2F If there are no current registered event listeners start the battery listener on native side.\n        if (me._batteryListener.length === 0 \&\& me._lowListener.length === 0 \&\& me._criticalListener.length === 0) {\n            PhoneGap.exec(me._status, me._error, \"Battery\", \"start\", []);\n        }\n        \n        \x2F\x2F Register the event listener in the proper array\n        if (eventType === \"batterystatus\") {\n            var pos = me._batteryListener.indexOf(handler);\n            if (pos === -1) {\n            \tme._batteryListener.push(handler);\n            }\n        } else if (eventType === \"batterylow\") {\n            var pos = me._lowListener.indexOf(handler);\n            if (pos === -1) {\n            \tme._lowListener.push(handler);\n            }\n        } else if (eventType === \"batterycritical\") {\n            var pos = me._criticalListener.indexOf(handler);\n            if (pos === -1) {\n            \tme._criticalListener.push(handler);\n            }\n        }\n    } else {\n        \x2F\x2F Remove the event listener from the proper array\n        if (eventType === \"batterystatus\") {\n            var pos = me._batteryListener.indexOf(handler);\n            if (pos \x3E -1) {\n                me._batteryListener.splice(pos, 1);        \n            }\n        } else if (eventType === \"batterylow\") {\n            var pos = me._lowListener.indexOf(handler);\n            if (pos \x3E -1) {\n                me._lowListener.splice(pos, 1);        \n            }\n        } else if (eventType === \"batterycritical\") {\n            var pos = me._criticalListener.indexOf(handler);\n            if (pos \x3E -1) {\n                me._criticalListener.splice(pos, 1);        \n            }\n        }\n        \n        \x2F\x2F If there are no more registered event listeners stop the battery listener on native side.\n        if (me._batteryListener.length === 0 \&\& me._lowListener.length === 0 \&\& me._criticalListener.length === 0) {\n            PhoneGap.exec(null, null, \"Battery\", \"stop\", []);\n        }\n    }\n};\n\n\x2F**\n * Callback for battery status\n * \n * @param {Object} info\t\t\tkeys: level, isPlugged\n *\x2F\nBattery.prototype._status = function(info) {\n\tif (info) {\n\t\tvar me = this;\n\t\tif (me._level != info.level || me._isPlugged != info.isPlugged) {\n\t\t\t\x2F\x2F Fire batterystatus event\n\t\t\tPhoneGap.fireWindowEvent(\"batterystatus\", info);\n\n\t\t\t\x2F\x2F Fire low battery event\n\t\t\tif (info.level == 20 || info.level == 5) {\n\t\t\t\tif (info.level == 20) {\n\t\t\t\t\tPhoneGap.fireWindowEvent(\"batterylow\", info);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tPhoneGap.fireWindowEvent(\"batterycritical\", info);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tme._level = info.level;\n\t\tme._isPlugged = info.isPlugged;\t\n\t}\n};\n\n\x2F**\n * Error callback for battery start\n *\x2F\nBattery.prototype._error = function(e) {\n    console.log(\"Error initializing Battery: \" + e);\n};\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.battery === \"undefined\") {\n        navigator.battery = new Battery();\n        PhoneGap.addWindowEventHandler(\"batterystatus\", navigator.battery.eventHandler);\n        PhoneGap.addWindowEventHandler(\"batterylow\", navigator.battery.eventHandler);\n        PhoneGap.addWindowEventHandler(\"batterycritical\", navigator.battery.eventHandler);\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"camera\")) {\nPhoneGap.addResource(\"camera\");\n\n\x2F**\n * This class provides access to the device camera.\n *\n * @constructor\n *\x2F\nvar Camera = function() {\n    this.successCallback = null;\n    this.errorCallback = null;\n    this.options = null;\n};\n\n\x2F**\n * Format of image that returned from getPicture.\n *\n * Example: navigator.camera.getPicture(success, fail,\n *              { quality: 80,\n *                destinationType: Camera.DestinationType.DATA_URL,\n *                sourceType: Camera.PictureSourceType.PHOTOLIBRARY})\n *\x2F\nCamera.DestinationType = {\n    DATA_URL: 0,                \x2F\x2F Return base64 encoded string\n    FILE_URI: 1                 \x2F\x2F Return file uri (content:\x2F\x2Fmedia\x2Fexternal\x2Fimages\x2Fmedia\x2F2 for Android)\n};\nCamera.prototype.DestinationType = Camera.DestinationType;\n\n\x2F**\n * Encoding of image returned from getPicture.\n *\n * Example: navigator.camera.getPicture(success, fail,\n *              { quality: 80,\n *                destinationType: Camera.DestinationType.DATA_URL,\n *                sourceType: Camera.PictureSourceType.CAMERA,\n *                encodingType: Camera.EncodingType.PNG})\n*\x2F\nCamera.EncodingType = {\n    JPEG: 0,                    \x2F\x2F Return JPEG encoded image\n    PNG: 1                      \x2F\x2F Return PNG encoded image\n};\nCamera.prototype.EncodingType = Camera.EncodingType;\n\n\x2F**\n * Type of pictures to select from.  Only applicable when\n *      PictureSourceType is PHOTOLIBRARY or SAVEDPHOTOALBUM\n *\n * Example: navigator.camera.getPicture(success, fail,\n *              { quality: 80,\n *                destinationType: Camera.DestinationType.DATA_URL,\n *                sourceType: Camera.PictureSourceType.PHOTOLIBRARY,\n *                mediaType: Camera.MediaType.PICTURE})\n *\x2F\nCamera.MediaType = {\n       PICTURE: 0,      \x2F\x2F allow selection of still pictures only. DEFAULT. Will return format specified via DestinationType\n       VIDEO: 1,        \x2F\x2F allow selection of video only, ONLY RETURNS URL\n       ALLMEDIA : 2     \x2F\x2F allow selection from all media types\n};\nCamera.prototype.MediaType = Camera.MediaType;\n\n\n\x2F**\n * Source to getPicture from.\n *\n * Example: navigator.camera.getPicture(success, fail,\n *              { quality: 80,\n *                destinationType: Camera.DestinationType.DATA_URL,\n *                sourceType: Camera.PictureSourceType.PHOTOLIBRARY})\n *\x2F\nCamera.PictureSourceType = {\n    PHOTOLIBRARY : 0,           \x2F\x2F Choose image from picture library (same as SAVEDPHOTOALBUM for Android)\n    CAMERA : 1,                 \x2F\x2F Take picture from camera\n    SAVEDPHOTOALBUM : 2         \x2F\x2F Choose image from picture library (same as PHOTOLIBRARY for Android)\n};\nCamera.prototype.PictureSourceType = Camera.PictureSourceType;\n\n\x2F**\n * Gets a picture from source defined by \"options.sourceType\", and returns the\n * image as defined by the \"options.destinationType\" option.\n\n * The defaults are sourceType=CAMERA and destinationType=DATA_URL.\n *\n * @param {Function} successCallback\n * @param {Function} errorCallback\n * @param {Object} options\n *\x2F\nCamera.prototype.getPicture = function(successCallback, errorCallback, options) {\n\n    \x2F\x2F successCallback required\n    if (typeof successCallback !== \"function\") {\n        console.log(\"Camera Error: successCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F errorCallback optional\n    if (errorCallback \&\& (typeof errorCallback !== \"function\")) {\n        console.log(\"Camera Error: errorCallback is not a function\");\n        return;\n    }\n    \n    if (options === null || typeof options === \"undefined\") {\n        options = {};\n    }\n    if (options.quality === null || typeof options.quality === \"undefined\") {\n        options.quality = 80;\n    }\n    if (options.maxResolution === null || typeof options.maxResolution === \"undefined\") {\n    \toptions.maxResolution = 0;\n    }\n    if (options.destinationType === null || typeof options.destinationType === \"undefined\") {\n        options.destinationType = Camera.DestinationType.DATA_URL;\n    }\n    if (options.sourceType === null || typeof options.sourceType === \"undefined\") {\n        options.sourceType = Camera.PictureSourceType.CAMERA;\n    }\n    if (options.encodingType === null || typeof options.encodingType === \"undefined\") {\n        options.encodingType = Camera.EncodingType.JPEG;\n    }\n    if (options.mediaType === null || typeof options.mediaType === \"undefined\") {\n        options.mediaType = Camera.MediaType.PICTURE;\n    }\n    if (options.targetWidth === null || typeof options.targetWidth === \"undefined\") {\n        options.targetWidth = -1;\n    } \n    else if (typeof options.targetWidth == \"string\") {\n        var width = new Number(options.targetWidth);\n        if (isNaN(width) === false) {\n            options.targetWidth = width.valueOf();\n        }\n    }\n    if (options.targetHeight === null || typeof options.targetHeight === \"undefined\") {\n        options.targetHeight = -1;\n    } \n    else if (typeof options.targetHeight == \"string\") {\n        var height = new Number(options.targetHeight);\n        if (isNaN(height) === false) {\n            options.targetHeight = height.valueOf();\n        }\n    }\n    \n    PhoneGap.exec(successCallback, errorCallback, \"Camera\", \"takePicture\", [options]);\n};\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.camera === \"undefined\") {\n        navigator.camera = new Camera();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"capture\")) {\nPhoneGap.addResource(\"capture\");\n\t\n\x2F**\n * Represents a single file.\n *\n * name {DOMString} name of the file, without path information\n * fullPath {DOMString} the full path of the file, including the name\n * type {DOMString} mime type\n * lastModifiedDate {Date} last modified date\n * size {Number} size of the file in bytes\n *\x2F\nvar MediaFile = function(name, fullPath, type, lastModifiedDate, size){\n\tthis.name = name || null;\n\tthis.fullPath = fullPath || null;\n\tthis.type = type || null;\n\tthis.lastModifiedDate = lastModifiedDate || null;\n\tthis.size = size || 0;\n};\n\n\x2F**\n * Launch device camera application for recording video(s).\n *\n * @param {Function} successCB\n * @param {Function} errorCB\n *\x2F\nMediaFile.prototype.getFormatData = function(successCallback, errorCallback){\n\tPhoneGap.exec(successCallback, errorCallback, \"Capture\", \"getFormatData\", [this.fullPath, this.type]);\n};\n\n\x2F**\n * MediaFileData encapsulates format information of a media file.\n *\n * @param {DOMString} codecs\n * @param {long} bitrate\n * @param {long} height\n * @param {long} width\n * @param {float} duration\n *\x2F\nvar MediaFileData = function(codecs, bitrate, height, width, duration){\n\tthis.codecs = codecs || null;\n\tthis.bitrate = bitrate || 0;\n\tthis.height = height || 0;\n\tthis.width = width || 0;\n\tthis.duration = duration || 0;\n};\n\n\x2F**\n * The CaptureError interface encapsulates all errors in the Capture API.\n *\x2F\nvar CaptureError = function(){\n\tthis.code = null;\n};\n\n\x2F\x2F Capture error codes\nCaptureError.CAPTURE_INTERNAL_ERR = 0;\nCaptureError.CAPTURE_APPLICATION_BUSY = 1;\nCaptureError.CAPTURE_INVALID_ARGUMENT = 2;\nCaptureError.CAPTURE_NO_MEDIA_FILES = 3;\nCaptureError.CAPTURE_NOT_SUPPORTED = 20;\n\n\x2F**\n * The Capture interface exposes an interface to the camera and microphone of the hosting device.\n *\x2F\nvar Capture = function(){\n\tthis.supportedAudioModes = [];\n\tthis.supportedImageModes = [];\n\tthis.supportedVideoModes = [];\n};\n\n\x2F**\n * Launch audio recorder application for recording audio clip(s).\n *\n * @param {Function} successCB\n * @param {Function} errorCB\n * @param {CaptureAudioOptions} options\n *\x2F\nCapture.prototype.captureAudio = function(successCallback, errorCallback, options){\n\tPhoneGap.exec(successCallback, errorCallback, \"Capture\", \"captureAudio\", [options]);\n};\n\n\x2F**\n * Launch camera application for taking image(s).\n *\n * @param {Function} successCB\n * @param {Function} errorCB\n * @param {CaptureImageOptions} options\n *\x2F\nCapture.prototype.captureImage = function(successCallback, errorCallback, options){\n\tPhoneGap.exec(successCallback, errorCallback, \"Capture\", \"captureImage\", [options]);\n};\n\n\x2F**\n * Launch camera application for taking image(s).\n *\n * @param {Function} successCB\n * @param {Function} errorCB\n * @param {CaptureImageOptions} options\n *\x2F\nCapture.prototype._castMediaFile = function(pluginResult){\n\tvar mediaFiles = [];\n\tvar i;\n\tfor (i = 0; i \x3C pluginResult.message.length; i++) {\n\t\tvar mediaFile = new MediaFile();\n\t\tmediaFile.name = pluginResult.message[i].name;\n\t\tmediaFile.fullPath = pluginResult.message[i].fullPath;\n\t\tmediaFile.type = pluginResult.message[i].type;\n\t\tmediaFile.lastModifiedDate = pluginResult.message[i].lastModifiedDate;\n\t\tmediaFile.size = pluginResult.message[i].size;\n\t\tmediaFiles.push(mediaFile);\n\t}\n\tpluginResult.message = mediaFiles;\n\treturn pluginResult;\n};\n\n\x2F**\n * Launch device camera application for recording video(s).\n *\n * @param {Function} successCB\n * @param {Function} errorCB\n * @param {CaptureVideoOptions} options\n *\x2F\nCapture.prototype.captureVideo = function(successCallback, errorCallback, options){\n\tPhoneGap.exec(successCallback, errorCallback, \"Capture\", \"captureVideo\", [options]);\n};\n\n\x2F**\n * Encapsulates a set of parameters that the capture device supports.\n *\x2F\nvar ConfigurationData = function(){\n\t\x2F\x2F The ASCII-encoded string in lower case representing the media type. \n\tthis.type = null;\n\t\x2F\x2F The height attribute represents height of the image or video in pixels. \n\t\x2F\x2F In the case of a sound clip this attribute has value 0. \n\tthis.height = 0;\n\t\x2F\x2F The width attribute represents width of the image or video in pixels. \n\t\x2F\x2F In the case of a sound clip this attribute has value 0\n\tthis.width = 0;\n};\n\n\x2F**\n * Encapsulates all image capture operation configuration options.\n *\x2F\nvar CaptureImageOptions = function(){\n\t\x2F\x2F Upper limit of images user can take. Value must be equal or greater than 1.\n\tthis.limit = 1;\n\t\x2F\x2F The selected image mode. Must match with one of the elements in supportedImageModes array.\n\tthis.mode = null;\n};\n\n\x2F**\n * Encapsulates all video capture operation configuration options.\n *\x2F\nvar CaptureVideoOptions = function(){\n\t\x2F\x2F Upper limit of videos user can record. Value must be equal or greater than 1.\n\tthis.limit = 1;\n\t\x2F\x2F Maximum duration of a single video clip in seconds.\n\tthis.duration = 0;\n\t\x2F\x2F The selected video mode. Must match with one of the elements in supportedVideoModes array.\n\tthis.mode = null;\n};\n\n\x2F**\n * Encapsulates all audio capture operation configuration options.\n *\x2F\nvar CaptureAudioOptions = function(){\n\t\x2F\x2F Upper limit of sound clips user can record. Value must be equal or greater than 1.\n\tthis.limit = 1;\n\t\x2F\x2F Maximum duration of a single sound clip in seconds.\n\tthis.duration = 0;\n\t\x2F\x2F The selected audio mode. Must match with one of the elements in supportedAudioModes array.\n\tthis.mode = null;\n};\n\nPhoneGap.addConstructor(function(){\n\tif (typeof navigator.device === \"undefined\") {\n\t\tnavigator.device = window.device = new Device();\n\t}\n\tif (typeof navigator.device.capture === \"undefined\") {\n\t\tnavigator.device.capture = window.device.capture = new Capture();\n\t}\n});\n}\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"compass\")) {\nPhoneGap.addResource(\"compass\");\n\nCompassError = function(){\n    this.code = null;\n};\n\n\x2F\x2F Capture error codes\nCompassError.COMPASS_INTERNAL_ERR = 0;\nCompassError.COMPASS_NOT_SUPPORTED = 20;\n\nCompassHeading = function() {\n    this.magneticHeading = null;\n    this.trueHeading = null;\n    this.headingAccuracy = null;\n    this.timestamp = null;\n};\n\n\x2F**\n * This class provides access to device Compass data.\n * @constructor\n *\x2F\nvar Compass = function() {\n    \x2F**\n     * The last known Compass position.\n     *\x2F\n    this.lastHeading = null;\n\n    \x2F**\n     * List of compass watch timers\n     *\x2F\n    this.timers = {};\n};\n\nCompass.ERROR_MSG = [\"Not running\", \"Starting\", \"\", \"Failed to start\"];\n\n\x2F**\n * Asynchronously aquires the current heading.\n *\n * @param {Function} successCallback The function to call when the heading data is available\n * @param {Function} errorCallback The function to call when there is an error getting the heading data. (OPTIONAL)\n * @param {PositionOptions} options The options for getting the heading data such as timeout. (OPTIONAL)\n *\x2F\nCompass.prototype.getCurrentHeading = function(successCallback, errorCallback, options) {\n\n    \x2F\x2F successCallback required\n    if (typeof successCallback !== \"function\") {\n        console.log(\"Compass Error: successCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F errorCallback optional\n    if (errorCallback \&\& (typeof errorCallback !== \"function\")) {\n        console.log(\"Compass Error: errorCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F Get heading\n    PhoneGap.exec(successCallback, errorCallback, \"Compass\", \"getHeading\", []);\n};\n\n\x2F**\n * Asynchronously aquires the heading repeatedly at a given interval.\n *\n * @param {Function} successCallback    The function to call each time the heading data is available\n * @param {Function} errorCallback      The function to call when there is an error getting the heading data. (OPTIONAL)\n * @param {HeadingOptions} options      The options for getting the heading data such as timeout and the frequency of the watch. (OPTIONAL)\n * @return String                       The watch id that must be passed to #clearWatch to stop watching.\n *\x2F\nCompass.prototype.watchHeading= function(successCallback, errorCallback, options) {\n\n    \x2F\x2F Default interval (100 msec)\n    var frequency = (options !== undefined) ? options.frequency : 100;\n\n    \x2F\x2F successCallback required\n    if (typeof successCallback !== \"function\") {\n        console.log(\"Compass Error: successCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F errorCallback optional\n    if (errorCallback \&\& (typeof errorCallback !== \"function\")) {\n        console.log(\"Compass Error: errorCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F Make sure compass timeout \x3E frequency + 10 sec\n    PhoneGap.exec(\n        function(timeout) {\n            if (timeout \x3C (frequency + 10000)) {\n                PhoneGap.exec(null, null, \"Compass\", \"setTimeout\", [frequency + 10000]);\n            }\n        },\n        function(e) { }, \"Compass\", \"getTimeout\", []);\n\n    \x2F\x2F Start watch timer to get headings\n    var id = PhoneGap.createUUID();\n    navigator.compass.timers[id] = setInterval(\n        function() {\n            PhoneGap.exec(successCallback, errorCallback, \"Compass\", \"getHeading\", []);\n        }, (frequency ? frequency : 1));\n\n    return id;\n};\n\n\n\x2F**\n * Clears the specified heading watch.\n *\n * @param {String} id       The ID of the watch returned from #watchHeading.\n *\x2F\nCompass.prototype.clearWatch = function(id) {\n\n    \x2F\x2F Stop javascript timer \& remove from timer list\n    if (id \&\& navigator.compass.timers[id]) {\n        clearInterval(navigator.compass.timers[id]);\n        delete navigator.compass.timers[id];\n    }\n};\n\nCompass.prototype._castDate = function(pluginResult) {\n    if (pluginResult.message.timestamp) {\n        var timestamp = new Date(pluginResult.message.timestamp);\n        pluginResult.message.timestamp = timestamp;\n    }\n    return pluginResult;\n};\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.compass === \"undefined\") {\n        navigator.compass = new Compass();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"contact\")) {\nPhoneGap.addResource(\"contact\");\n\n\x2F**\n* Contains information about a single contact.\n* @constructor\n* @param {DOMString} id unique identifier\n* @param {DOMString} displayName\n* @param {ContactName} name\n* @param {DOMString} nickname\n* @param {Array.\x3CContactField\x3E} phoneNumbers array of phone numbers\n* @param {Array.\x3CContactField\x3E} emails array of email addresses\n* @param {Array.\x3CContactAddress\x3E} addresses array of addresses\n* @param {Array.\x3CContactField\x3E} ims instant messaging user ids\n* @param {Array.\x3CContactOrganization\x3E} organizations\n* @param {DOMString} birthday contact\'s birthday\n* @param {DOMString} note user notes about contact\n* @param {Array.\x3CContactField\x3E} photos\n* @param {Array.\x3CContactField\x3E} categories\n* @param {Array.\x3CContactField\x3E} urls contact\'s web sites\n*\x2F\nvar Contact = function (id, displayName, name, nickname, phoneNumbers, emails, addresses,\n    ims, organizations, birthday, note, photos, categories, urls) {\n    this.id = id || null;\n    this.rawId = null;\n    this.displayName = displayName || null;\n    this.name = name || null; \x2F\x2F ContactName\n    this.nickname = nickname || null;\n    this.phoneNumbers = phoneNumbers || null; \x2F\x2F ContactField[]\n    this.emails = emails || null; \x2F\x2F ContactField[]\n    this.addresses = addresses || null; \x2F\x2F ContactAddress[]\n    this.ims = ims || null; \x2F\x2F ContactField[]\n    this.organizations = organizations || null; \x2F\x2F ContactOrganization[]\n    this.birthday = birthday || null;\n    this.note = note || null;\n    this.photos = photos || null; \x2F\x2F ContactField[]\n    this.categories = categories || null; \x2F\x2F ContactField[]\n    this.urls = urls || null; \x2F\x2F ContactField[]\n};\n\n\x2F**\n *  ContactError.\n *  An error code assigned by an implementation when an error has occurreds\n * @constructor\n *\x2F\nvar ContactError = function() {\n    this.code=null;\n};\n\n\x2F**\n * Error codes\n *\x2F\nContactError.UNKNOWN_ERROR = 0;\nContactError.INVALID_ARGUMENT_ERROR = 1;\nContactError.TIMEOUT_ERROR = 2;\nContactError.PENDING_OPERATION_ERROR = 3;\nContactError.IO_ERROR = 4;\nContactError.NOT_SUPPORTED_ERROR = 5;\nContactError.PERMISSION_DENIED_ERROR = 20;\n\n\x2F**\n* Removes contact from device storage.\n* @param successCB success callback\n* @param errorCB error callback\n*\x2F\nContact.prototype.remove = function(successCB, errorCB) {\n    if (this.id === null) {\n        var errorObj = new ContactError();\n        errorObj.code = ContactError.UNKNOWN_ERROR;\n        errorCB(errorObj);\n    }\n    else {\n        PhoneGap.exec(successCB, errorCB, \"Contacts\", \"remove\", [this.id]);\n    }\n};\n\n\x2F**\n* Creates a deep copy of this Contact.\n* With the contact ID set to null.\n* @return copy of this Contact\n*\x2F\nContact.prototype.clone = function() {\n    var clonedContact = PhoneGap.clone(this);\n    var i;\n    clonedContact.id = null;\n    clonedContact.rawId = null;\n    \x2F\x2F Loop through and clear out any id\'s in phones, emails, etc.\n    if (clonedContact.phoneNumbers) {\n        for (i = 0; i \x3C clonedContact.phoneNumbers.length; i++) {\n            clonedContact.phoneNumbers[i].id = null;\n        }\n    }\n    if (clonedContact.emails) {\n        for (i = 0; i \x3C clonedContact.emails.length; i++) {\n            clonedContact.emails[i].id = null;\n        }\n    }\n    if (clonedContact.addresses) {\n        for (i = 0; i \x3C clonedContact.addresses.length; i++) {\n            clonedContact.addresses[i].id = null;\n        }\n    }\n    if (clonedContact.ims) {\n        for (i = 0; i \x3C clonedContact.ims.length; i++) {\n            clonedContact.ims[i].id = null;\n        }\n    }\n    if (clonedContact.organizations) {\n        for (i = 0; i \x3C clonedContact.organizations.length; i++) {\n            clonedContact.organizations[i].id = null;\n        }\n    }\n    if (clonedContact.tags) {\n        for (i = 0; i \x3C clonedContact.tags.length; i++) {\n            clonedContact.tags[i].id = null;\n        }\n    }\n    if (clonedContact.photos) {\n        for (i = 0; i \x3C clonedContact.photos.length; i++) {\n            clonedContact.photos[i].id = null;\n        }\n    }\n    if (clonedContact.urls) {\n        for (i = 0; i \x3C clonedContact.urls.length; i++) {\n            clonedContact.urls[i].id = null;\n        }\n    }\n    return clonedContact;\n};\n\n\x2F**\n* Persists contact to device storage.\n* @param successCB success callback\n* @param errorCB error callback\n*\x2F\nContact.prototype.save = function(successCB, errorCB) {\n    PhoneGap.exec(successCB, errorCB, \"Contacts\", \"save\", [this]);\n};\n\n\x2F**\n* Contact name.\n* @constructor\n* @param formatted\n* @param familyName\n* @param givenName\n* @param middle\n* @param prefix\n* @param suffix\n*\x2F\nvar ContactName = function(formatted, familyName, givenName, middle, prefix, suffix) {\n    this.formatted = formatted || null;\n    this.familyName = familyName || null;\n    this.givenName = givenName || null;\n    this.middleName = middle || null;\n    this.honorificPrefix = prefix || null;\n    this.honorificSuffix = suffix || null;\n};\n\n\x2F**\n* Generic contact field.\n* @constructor\n* @param {DOMString} id unique identifier, should only be set by native code\n* @param type\n* @param value\n* @param pref\n*\x2F\nvar ContactField = function(type, value, pref) {\n\tthis.id = null;\n    this.type = type || null;\n    this.value = value || null;\n    this.pref = pref || null;\n};\n\n\x2F**\n* Contact address.\n* @constructor\n* @param {DOMString} id unique identifier, should only be set by native code\n* @param formatted\n* @param streetAddress\n* @param locality\n* @param region\n* @param postalCode\n* @param country\n*\x2F\nvar ContactAddress = function(pref, type, formatted, streetAddress, locality, region, postalCode, country) {\n\tthis.id = null;\n    this.pref = pref || null;\n    this.type = type || null;\n    this.formatted = formatted || null;\n    this.streetAddress = streetAddress || null;\n    this.locality = locality || null;\n    this.region = region || null;\n    this.postalCode = postalCode || null;\n    this.country = country || null;\n};\n\n\x2F**\n* Contact organization.\n* @constructor\n* @param {DOMString} id unique identifier, should only be set by native code\n* @param name\n* @param dept\n* @param title\n* @param startDate\n* @param endDate\n* @param location\n* @param desc\n*\x2F\nvar ContactOrganization = function(pref, type, name, dept, title) {\n\tthis.id = null;\n    this.pref = pref || null;\n    this.type = type || null;\n    this.name = name || null;\n    this.department = dept || null;\n    this.title = title || null;\n};\n\n\x2F**\n* Represents a group of Contacts.\n* @constructor\n*\x2F\nvar Contacts = function() {\n    this.inProgress = false;\n    this.records = [];\n};\n\x2F**\n* Returns an array of Contacts matching the search criteria.\n* @param fields that should be searched\n* @param successCB success callback\n* @param errorCB error callback\n* @param {ContactFindOptions} options that can be applied to contact searching\n* @return array of Contacts matching search criteria\n*\x2F\nContacts.prototype.find = function(fields, successCB, errorCB, options) {\n    if (successCB === null) {\n        throw new TypeError(\"You must specify a success callback for the find command.\");\n    }\n    if (fields === null || fields === \"undefined\" || fields.length === \"undefined\" || fields.length \x3C= 0) {\n        if (typeof errorCB === \"function\") {\n            errorCB({\"code\": ContactError.INVALID_ARGUMENT_ERROR});\n        }\n    } else {\n        PhoneGap.exec(successCB, errorCB, \"Contacts\", \"search\", [fields, options]);        \n    }\n};\n\nContacts.prototype.insert = function(successCB, errorCB){\n\tPhoneGap.exec(successCB, errorCB, \"Contacts\", \"insert\", [[], {}]);\n}\n\nContacts.prototype.choose = function(successCB, errorCB){\n\tPhoneGap.exec(successCB, errorCB, \"Contacts\", \"choose\", [[], {}]);\n}\n\n\x2F**\n* This function creates a new contact, but it does not persist the contact\n* to device storage. To persist the contact to device storage, invoke\n* contact.save().\n* @param properties an object who\'s properties will be examined to create a new Contact\n* @returns new Contact object\n*\x2F\nContacts.prototype.create = function(properties) {\n    var i;\n\tvar contact = new Contact();\n    for (i in properties) {\n        if (contact[i] !== \'undefined\') {\n            contact[i] = properties[i];\n        }\n    }\n    return contact;\n};\n\n\x2F**\n* This function returns and array of contacts.  It is required as we need to convert raw\n* JSON objects into concrete Contact objects.  Currently this method is called after\n* navigator.contacts.find but before the find methods success call back.\n*\n* @param jsonArray an array of JSON Objects that need to be converted to Contact objects.\n* @returns an array of Contact objects\n*\x2F\nContacts.prototype.cast = function(pluginResult) {\n\tvar contacts = [];\n\tvar i;\n\tfor (i=0; i\x3CpluginResult.message.length; i++) {\n\t\tcontacts.push(navigator.contacts.create(pluginResult.message[i]));\n\t}\n\tpluginResult.message = contacts;\n\treturn pluginResult;\n};\n\n\x2F**\n * ContactFindOptions.\n * @constructor\n * @param filter used to match contacts against\n * @param multiple boolean used to determine if more than one contact should be returned\n *\x2F\nvar ContactFindOptions = function(filter, multiple) {\n    this.filter = filter || \'\';\n    this.multiple = multiple || false;\n};\n\n\n\n\x2F**\n * Add the contact interface into the browser.\n *\x2F\nPhoneGap.addConstructor(function() {\n    if(typeof navigator.contacts === \"undefined\") {\n        navigator.contacts = new Contacts();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\n\x2F\x2F TODO: Needs to be commented\n\nif (!PhoneGap.hasResource(\"crypto\")) {\nPhoneGap.addResource(\"crypto\");\n\n\x2F**\n* @constructor\n*\x2F\nvar Crypto = function() {\n};\n\nCrypto.prototype.encrypt = function(seed, string, callback) {\n    this.encryptWin = callback;\n    PhoneGap.exec(null, null, \"Crypto\", \"encrypt\", [seed, string]);\n};\n\nCrypto.prototype.decrypt = function(seed, string, callback) {\n    this.decryptWin = callback;\n    PhoneGap.exec(null, null, \"Crypto\", \"decrypt\", [seed, string]);\n};\n\nCrypto.prototype.gotCryptedString = function(string) {\n    this.encryptWin(string);\n};\n\nCrypto.prototype.getPlainString = function(string) {\n    this.decryptWin(string);\n};\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.Crypto === \"undefined\") {\n        navigator.Crypto = new Crypto();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"device\")) {\nPhoneGap.addResource(\"device\");\n\n\x2F**\n * This represents the mobile device, and provides properties for inspecting the model, version, UUID of the\n * phone, etc.\n * @constructor\n *\x2F\nvar Device = function() {\n    this.available = PhoneGap.available;\n    this.platform = null;\n    this.version = null;\n    this.name = null;\n    this.uuid = null;\n    this.phonegap = null;\n\n    var me = this;\n    this.getInfo(\n        function(info) {\n            me.available = true;\n            me.platform = info.platform;\n            me.version = info.version;\n            me.name = info.name;\n            me.uuid = info.uuid;\n            me.phonegap = info.phonegap;\n            PhoneGap.onPhoneGapInfoReady.fire();\n        },\n        function(e) {\n            me.available = false;\n            console.log(\"Error initializing PhoneGap: \" + e);\n            alert(\"Error initializing PhoneGap: \"+e);\n        });\n};\n\n\x2F**\n * Get device info\n *\n * @param {Function} successCallback The function to call when the heading data is available\n * @param {Function} errorCallback The function to call when there is an error getting the heading data. (OPTIONAL)\n *\x2F\nDevice.prototype.getInfo = function(successCallback, errorCallback) {\n\n    \x2F\x2F successCallback required\n    if (typeof successCallback !== \"function\") {\n        console.log(\"Device Error: successCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F errorCallback optional\n    if (errorCallback \&\& (typeof errorCallback !== \"function\")) {\n        console.log(\"Device Error: errorCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F Get info\n    PhoneGap.exec(successCallback, errorCallback, \"Device\", \"getDeviceInfo\", []);\n};\n\n\x2F*\n * DEPRECATED\n * This is only for Android.\n *\n * You must explicitly override the back button.\n *\x2F\nDevice.prototype.overrideBackButton = function() {\n\tconsole.log(\"Device.overrideBackButton() is deprecated.  Use App.overrideBackbutton(true).\");\n\tnavigator.app.overrideBackbutton(true);\n};\n\n\x2F*\n * DEPRECATED\n * This is only for Android.\n *\n * This resets the back button to the default behaviour\n *\x2F\nDevice.prototype.resetBackButton = function() {\n\tconsole.log(\"Device.resetBackButton() is deprecated.  Use App.overrideBackbutton(false).\");\n\tnavigator.app.overrideBackbutton(false);\n};\n\n\x2F*\n * DEPRECATED\n * This is only for Android.\n *\n * This terminates the activity!\n *\x2F\nDevice.prototype.exitApp = function() {\n\tconsole.log(\"Device.exitApp() is deprecated.  Use App.exitApp().\");\n\tnavigator.app.exitApp();\n};\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.device === \"undefined\") {\n        navigator.device = window.device = new Device();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"file\")) {\nPhoneGap.addResource(\"file\");\n\n\x2F**\n * This class provides some useful information about a file.\n * @constructor\n *\x2F\nvar FileProperties = function(filePath) {\n    this.filePath = filePath;\n    this.size = 0;\n    this.lastModifiedDate = null;\n};\n\n\x2F**\n * Represents a single file.\n *\n * @constructor\n * @param name {DOMString} name of the file, without path information\n * @param fullPath {DOMString} the full path of the file, including the name\n * @param type {DOMString} mime type\n * @param lastModifiedDate {Date} last modified date\n * @param size {Number} size of the file in bytes\n *\x2F\nvar File = function(name, fullPath, type, lastModifiedDate, size) {\n    this.name = name || null;\n    this.fullPath = fullPath || null;\n    this.type = type || null;\n    this.lastModifiedDate = lastModifiedDate || null;\n    this.size = size || 0;\n};\n\n\x2F** @constructor *\x2F\nvar FileError = function() {\n   this.code = null;\n};\n\n\x2F\x2F File error codes\n\x2F\x2F Found in DOMException\nFileError.NOT_FOUND_ERR = 1;\nFileError.SECURITY_ERR = 2;\nFileError.ABORT_ERR = 3;\n\n\x2F\x2F Added by this specification\nFileError.NOT_READABLE_ERR = 4;\nFileError.ENCODING_ERR = 5;\nFileError.NO_MODIFICATION_ALLOWED_ERR = 6;\nFileError.INVALID_STATE_ERR = 7;\nFileError.SYNTAX_ERR = 8;\nFileError.INVALID_MODIFICATION_ERR = 9;\nFileError.QUOTA_EXCEEDED_ERR = 10;\nFileError.TYPE_MISMATCH_ERR = 11;\nFileError.PATH_EXISTS_ERR = 12;\n\n\x2F\x2F-----------------------------------------------------------------------------\n\x2F\x2F File Reader\n\x2F\x2F-----------------------------------------------------------------------------\n\n\x2F**\n * This class reads the mobile device file system.\n *\n * For Android:\n *      The root directory is the root of the file system.\n *      To read from the SD card, the file name is \"sdcard\x2Fmy_file.txt\"\n * @constructor\n *\x2F\nvar FileReader = function() {\n    this.fileName = \"\";\n\n    this.readyState = 0;\n\n    \x2F\x2F File data\n    this.result = null;\n\n    \x2F\x2F Error\n    this.error = null;\n\n    \x2F\x2F Event handlers\n    this.onloadstart = null;    \x2F\x2F When the read starts.\n    this.onprogress = null;     \x2F\x2F While reading (and decoding) file or fileBlob data, and reporting partial file data (progess.loaded\x2Fprogress.total)\n    this.onload = null;         \x2F\x2F When the read has successfully completed.\n    this.onerror = null;        \x2F\x2F When the read has failed (see errors).\n    this.onloadend = null;      \x2F\x2F When the request has completed (either in success or failure).\n    this.onabort = null;        \x2F\x2F When the read has been aborted. For instance, by invoking the abort() method.\n};\n\n\x2F\x2F States\nFileReader.EMPTY = 0;\nFileReader.LOADING = 1;\nFileReader.DONE = 2;\n\n\x2F**\n * Abort reading file.\n *\x2F\nFileReader.prototype.abort = function() {\n    var evt;\n    this.readyState = FileReader.DONE;\n    this.result = null;\n\n    \x2F\x2F set error\n    var error = new FileError();\n    error.code = error.ABORT_ERR;\n    this.error = error;\n\n    \x2F\x2F If error callback\n    if (typeof this.onerror === \"function\") {\n        this.onerror({\"type\":\"error\", \"target\":this});\n    }\n    \x2F\x2F If abort callback\n    if (typeof this.onabort === \"function\") {\n        this.onabort({\"type\":\"abort\", \"target\":this});\n    }\n    \x2F\x2F If load end callback\n    if (typeof this.onloadend === \"function\") {\n        this.onloadend({\"type\":\"loadend\", \"target\":this});\n    }\n};\n\n\x2F**\n * Read text file.\n *\n * @param file          {File} File object containing file properties\n * @param encoding      [Optional] (see http:\x2F\x2Fwww.iana.org\x2Fassignments\x2Fcharacter-sets)\n *\x2F\nFileReader.prototype.readAsText = function(file, encoding) {\n    this.fileName = \"\";\n    if (typeof file.fullPath === \"undefined\") {\n        this.fileName = file;\n    } else {\n        this.fileName = file.fullPath;\n    }\n\n    \x2F\x2F LOADING state\n    this.readyState = FileReader.LOADING;\n\n    \x2F\x2F If loadstart callback\n    if (typeof this.onloadstart === \"function\") {\n        this.onloadstart({\"type\":\"loadstart\", \"target\":this});\n    }\n\n    \x2F\x2F Default encoding is UTF-8\n    var enc = encoding ? encoding : \"UTF-8\";\n\n    var me = this;\n\n    \x2F\x2F Read file\n    PhoneGap.exec(\n        \x2F\x2F Success callback\n        function(r) {\n            var evt;\n\n            \x2F\x2F If DONE (cancelled), then don\'t do anything\n            if (me.readyState === FileReader.DONE) {\n                return;\n            }\n\n            \x2F\x2F Save result\n            me.result = r;\n\n            \x2F\x2F If onload callback\n            if (typeof me.onload === \"function\") {\n                me.onload({\"type\":\"load\", \"target\":me});\n            }\n\n            \x2F\x2F DONE state\n            me.readyState = FileReader.DONE;\n\n            \x2F\x2F If onloadend callback\n            if (typeof me.onloadend === \"function\") {\n                me.onloadend({\"type\":\"loadend\", \"target\":me});\n            }\n        },\n        \x2F\x2F Error callback\n        function(e) {\n            var evt;\n            \x2F\x2F If DONE (cancelled), then don\'t do anything\n            if (me.readyState === FileReader.DONE) {\n                return;\n            }\n\n            \x2F\x2F Save error\n            me.error = e;\n\n            \x2F\x2F If onerror callback\n            if (typeof me.onerror === \"function\") {\n                me.onerror({\"type\":\"error\", \"target\":me});\n            }\n\n            \x2F\x2F DONE state\n            me.readyState = FileReader.DONE;\n\n            \x2F\x2F If onloadend callback\n            if (typeof me.onloadend === \"function\") {\n                me.onloadend({\"type\":\"loadend\", \"target\":me});\n            }\n        }, \"File\", \"readAsText\", [this.fileName, enc]);\n};\n\n\n\x2F**\n * Read file and return data as a base64 encoded data url.\n * A data url is of the form:\n *      data:[\x3Cmediatype\x3E][;base64],\x3Cdata\x3E\n *\n * @param file          {File} File object containing file properties\n *\x2F\nFileReader.prototype.readAsDataURL = function(file) {\n    this.fileName = \"\";\n    if (typeof file.fullPath === \"undefined\") {\n        this.fileName = file;\n    } else {\n        this.fileName = file.fullPath;\n    }\n\n    \x2F\x2F LOADING state\n    this.readyState = FileReader.LOADING;\n\n    \x2F\x2F If loadstart callback\n    if (typeof this.onloadstart === \"function\") {\n        this.onloadstart({\"type\":\"loadstart\", \"target\":this});\n    }\n\n    var me = this;\n\n    \x2F\x2F Read file\n    PhoneGap.exec(\n        \x2F\x2F Success callback\n        function(r) {\n            var evt;\n\n            \x2F\x2F If DONE (cancelled), then don\'t do anything\n            if (me.readyState === FileReader.DONE) {\n                return;\n            }\n\n            \x2F\x2F Save result\n            me.result = r;\n\n            \x2F\x2F If onload callback\n            if (typeof me.onload === \"function\") {\n                me.onload({\"type\":\"load\", \"target\":me});\n            }\n\n            \x2F\x2F DONE state\n            me.readyState = FileReader.DONE;\n\n            \x2F\x2F If onloadend callback\n            if (typeof me.onloadend === \"function\") {\n                me.onloadend({\"type\":\"loadend\", \"target\":me});\n            }\n        },\n        \x2F\x2F Error callback\n        function(e) {\n            var evt;\n            \x2F\x2F If DONE (cancelled), then don\'t do anything\n            if (me.readyState === FileReader.DONE) {\n                return;\n            }\n\n            \x2F\x2F Save error\n            me.error = e;\n\n            \x2F\x2F If onerror callback\n            if (typeof me.onerror === \"function\") {\n                me.onerror({\"type\":\"error\", \"target\":me});\n            }\n\n            \x2F\x2F DONE state\n            me.readyState = FileReader.DONE;\n\n            \x2F\x2F If onloadend callback\n            if (typeof me.onloadend === \"function\") {\n                me.onloadend({\"type\":\"loadend\", \"target\":me});\n            }\n        }, \"File\", \"readAsDataURL\", [this.fileName]);\n};\n\n\x2F**\n * Read file and return data as a binary data.\n *\n * @param file          {File} File object containing file properties\n *\x2F\nFileReader.prototype.readAsBinaryString = function(file) {\n    \x2F\x2F TODO - Can\'t return binary data to browser.\n    this.fileName = file;\n};\n\n\x2F**\n * Read file and return data as a binary data.\n *\n * @param file          {File} File object containing file properties\n *\x2F\nFileReader.prototype.readAsArrayBuffer = function(file) {\n    \x2F\x2F TODO - Can\'t return binary data to browser.\n    this.fileName = file;\n};\n\n\x2F\x2F-----------------------------------------------------------------------------\n\x2F\x2F File Writer\n\x2F\x2F-----------------------------------------------------------------------------\n\n\x2F**\n * This class writes to the mobile device file system.\n *\n * For Android:\n *      The root directory is the root of the file system.\n *      To write to the SD card, the file name is \"sdcard\x2Fmy_file.txt\"\n *\n * @constructor\n * @param file {File} File object containing file properties\n * @param append if true write to the end of the file, otherwise overwrite the file\n *\x2F\nvar FileWriter = function(file) {\n    this.fileName = \"\";\n    this.length = 0;\n    if (file) {\n        this.fileName = file.fullPath || file;\n        this.length = file.size || 0;\n    }\n    \x2F\x2F default is to write at the beginning of the file\n    this.position = 0;\n\n    this.readyState = 0; \x2F\x2F EMPTY\n\n    this.result = null;\n\n    \x2F\x2F Error\n    this.error = null;\n\n    \x2F\x2F Event handlers\n    this.onwritestart = null;   \x2F\x2F When writing starts\n    this.onprogress = null;     \x2F\x2F While writing the file, and reporting partial file data\n    this.onwrite = null;        \x2F\x2F When the write has successfully completed.\n    this.onwriteend = null;     \x2F\x2F When the request has completed (either in success or failure).\n    this.onabort = null;        \x2F\x2F When the write has been aborted. For instance, by invoking the abort() method.\n    this.onerror = null;        \x2F\x2F When the write has failed (see errors).\n};\n\n\x2F\x2F States\nFileWriter.INIT = 0;\nFileWriter.WRITING = 1;\nFileWriter.DONE = 2;\n\n\x2F**\n * Abort writing file.\n *\x2F\nFileWriter.prototype.abort = function() {\n    \x2F\x2F check for invalid state\n    if (this.readyState === FileWriter.DONE || this.readyState === FileWriter.INIT) {\n        throw FileError.INVALID_STATE_ERR;\n    }\n\n    \x2F\x2F set error\n    var error = new FileError(), evt;\n    error.code = error.ABORT_ERR;\n    this.error = error;\n\n    \x2F\x2F If error callback\n    if (typeof this.onerror === \"function\") {\n        this.onerror({\"type\":\"error\", \"target\":this});\n    }\n    \x2F\x2F If abort callback\n    if (typeof this.onabort === \"function\") {\n        this.onabort({\"type\":\"abort\", \"target\":this});\n    }\n\n    this.readyState = FileWriter.DONE;\n\n    \x2F\x2F If write end callback\n    if (typeof this.onwriteend == \"function\") {\n        this.onwriteend({\"type\":\"writeend\", \"target\":this});\n    }\n};\n\n\x2F**\n * Writes data to the file\n *\n * @param text to be written\n *\x2F\nFileWriter.prototype.write = function(text) {\n    \x2F\x2F Throw an exception if we are already writing a file\n    if (this.readyState === FileWriter.WRITING) {\n        throw FileError.INVALID_STATE_ERR;\n    }\n\n    \x2F\x2F WRITING state\n    this.readyState = FileWriter.WRITING;\n\n    var me = this;\n\n    \x2F\x2F If onwritestart callback\n    if (typeof me.onwritestart === \"function\") {\n        me.onwritestart({\"type\":\"writestart\", \"target\":me});\n    }\n\n    \x2F\x2F Write file\n    PhoneGap.exec(\n        \x2F\x2F Success callback\n        function(r) {\n            var evt;\n            \x2F\x2F If DONE (cancelled), then don\'t do anything\n            if (me.readyState === FileWriter.DONE) {\n                return;\n            }\n\n            \x2F\x2F position always increases by bytes written because file would be extended\n            me.position += r;\n            \x2F\x2F The length of the file is now where we are done writing.\n            me.length = me.position;\n\n            \x2F\x2F If onwrite callback\n            if (typeof me.onwrite === \"function\") {\n                me.onwrite({\"type\":\"write\", \"target\":me});\n            }\n\n            \x2F\x2F DONE state\n            me.readyState = FileWriter.DONE;\n\n            \x2F\x2F If onwriteend callback\n            if (typeof me.onwriteend === \"function\") {\n                me.onwriteend({\"type\":\"writeend\", \"target\":me});\n            }\n        },\n        \x2F\x2F Error callback\n        function(e) {\n            var evt;\n\n            \x2F\x2F If DONE (cancelled), then don\'t do anything\n            if (me.readyState === FileWriter.DONE) {\n                return;\n            }\n\n            \x2F\x2F Save error\n            me.error = e;\n\n            \x2F\x2F If onerror callback\n            if (typeof me.onerror === \"function\") {\n                me.onerror({\"type\":\"error\", \"target\":me});\n            }\n\n            \x2F\x2F DONE state\n            me.readyState = FileWriter.DONE;\n\n            \x2F\x2F If onwriteend callback\n            if (typeof me.onwriteend === \"function\") {\n                me.onwriteend({\"type\":\"writeend\", \"target\":me});\n            }\n        }, \"File\", \"write\", [this.fileName, text, this.position]);\n};\n\n\x2F**\n * Moves the file pointer to the location specified.\n *\n * If the offset is a negative number the position of the file\n * pointer is rewound.  If the offset is greater than the file\n * size the position is set to the end of the file.\n *\n * @param offset is the location to move the file pointer to.\n *\x2F\nFileWriter.prototype.seek = function(offset) {\n    \x2F\x2F Throw an exception if we are already writing a file\n    if (this.readyState === FileWriter.WRITING) {\n        throw FileError.INVALID_STATE_ERR;\n    }\n\n    if (!offset) {\n        return;\n    }\n\n    \x2F\x2F See back from end of file.\n    if (offset \x3C 0) {\n        this.position = Math.max(offset + this.length, 0);\n    }\n    \x2F\x2F Offset is bigger then file size so set position\n    \x2F\x2F to the end of the file.\n    else if (offset \x3E this.length) {\n        this.position = this.length;\n    }\n    \x2F\x2F Offset is between 0 and file size so set the position\n    \x2F\x2F to start writing.\n    else {\n        this.position = offset;\n    }\n};\n\n\x2F**\n * Truncates the file to the size specified.\n *\n * @param size to chop the file at.\n *\x2F\nFileWriter.prototype.truncate = function(size) {\n    \x2F\x2F Throw an exception if we are already writing a file\n    if (this.readyState === FileWriter.WRITING) {\n        throw FileError.INVALID_STATE_ERR;\n    }\n\n    \x2F\x2F WRITING state\n    this.readyState = FileWriter.WRITING;\n\n    var me = this;\n\n    \x2F\x2F If onwritestart callback\n    if (typeof me.onwritestart === \"function\") {\n        me.onwritestart({\"type\":\"writestart\", \"target\":this});\n    }\n\n    \x2F\x2F Write file\n    PhoneGap.exec(\n        \x2F\x2F Success callback\n        function(r) {\n            var evt;\n            \x2F\x2F If DONE (cancelled), then don\'t do anything\n            if (me.readyState === FileWriter.DONE) {\n                return;\n            }\n\n            \x2F\x2F Update the length of the file\n            me.length = r;\n            me.position = Math.min(me.position, r);\n\n            \x2F\x2F If onwrite callback\n            if (typeof me.onwrite === \"function\") {\n                me.onwrite({\"type\":\"write\", \"target\":me});\n            }\n\n            \x2F\x2F DONE state\n            me.readyState = FileWriter.DONE;\n\n            \x2F\x2F If onwriteend callback\n            if (typeof me.onwriteend === \"function\") {\n                me.onwriteend({\"type\":\"writeend\", \"target\":me});\n            }\n        },\n        \x2F\x2F Error callback\n        function(e) {\n            var evt;\n            \x2F\x2F If DONE (cancelled), then don\'t do anything\n            if (me.readyState === FileWriter.DONE) {\n                return;\n            }\n\n            \x2F\x2F Save error\n            me.error = e;\n\n            \x2F\x2F If onerror callback\n            if (typeof me.onerror === \"function\") {\n                me.onerror({\"type\":\"error\", \"target\":me});\n            }\n\n            \x2F\x2F DONE state\n            me.readyState = FileWriter.DONE;\n\n            \x2F\x2F If onwriteend callback\n            if (typeof me.onwriteend === \"function\") {\n                me.onwriteend({\"type\":\"writeend\", \"target\":me});\n            }\n        }, \"File\", \"truncate\", [this.fileName, size]);\n};\n\n\x2F**\n * Information about the state of the file or directory\n *\n * @constructor\n * {Date} modificationTime (readonly)\n *\x2F\nvar Metadata = function() {\n    this.modificationTime=null;\n};\n\n\x2F**\n * Supplies arguments to methods that lookup or create files and directories\n *\n * @constructor\n * @param {boolean} create file or directory if it doesn\'t exist\n * @param {boolean} exclusive if true the command will fail if the file or directory exists\n *\x2F\nvar Flags = function(create, exclusive) {\n    this.create = create || false;\n    this.exclusive = exclusive || false;\n};\n\n\x2F**\n * An interface representing a file system\n *\n * @constructor\n * {DOMString} name the unique name of the file system (readonly)\n * {DirectoryEntry} root directory of the file system (readonly)\n *\x2F\nvar FileSystem = function() {\n    this.name = null;\n    this.root = null;\n};\n\n\x2F**\n * An interface that lists the files and directories in a directory.\n * @constructor\n *\x2F\nvar DirectoryReader = function(fullPath){\n    this.fullPath = fullPath || null;\n};\n\n\x2F**\n * Returns a list of entries from a directory.\n *\n * @param {Function} successCallback is called with a list of entries\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryReader.prototype.readEntries = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"readEntries\", [this.fullPath]);\n};\n\n\x2F**\n * An interface representing a directory on the file system.\n *\n * @constructor\n * {boolean} isFile always false (readonly)\n * {boolean} isDirectory always true (readonly)\n * {DOMString} name of the directory, excluding the path leading to it (readonly)\n * {DOMString} fullPath the absolute full path to the directory (readonly)\n * {FileSystem} filesystem on which the directory resides (readonly)\n *\x2F\nvar DirectoryEntry = function() {\n    this.isFile = false;\n    this.isDirectory = true;\n    this.name = null;\n    this.fullPath = null;\n    this.filesystem = null;\n};\n\n\x2F**\n * Copies a directory to a new location\n *\n * @param {DirectoryEntry} parent the directory to which to copy the entry\n * @param {DOMString} newName the new name of the entry, defaults to the current name\n * @param {Function} successCallback is called with the new entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryEntry.prototype.copyTo = function(parent, newName, successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"copyTo\", [this.fullPath, parent, newName]);\n};\n\n\x2F**\n * Looks up the metadata of the entry\n *\n * @param {Function} successCallback is called with a Metadata object\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryEntry.prototype.getMetadata = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"getMetadata\", [this.fullPath]);\n};\n\n\x2F**\n * Gets the parent of the entry\n *\n * @param {Function} successCallback is called with a parent entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryEntry.prototype.getParent = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"getParent\", [this.fullPath]);\n};\n\n\x2F**\n * Moves a directory to a new location\n *\n * @param {DirectoryEntry} parent the directory to which to move the entry\n * @param {DOMString} newName the new name of the entry, defaults to the current name\n * @param {Function} successCallback is called with the new entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryEntry.prototype.moveTo = function(parent, newName, successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"moveTo\", [this.fullPath, parent, newName]);\n};\n\n\x2F**\n * Removes the entry\n *\n * @param {Function} successCallback is called with no parameters\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryEntry.prototype.remove = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"remove\", [this.fullPath]);\n};\n\n\x2F**\n * Returns a URI that can be used to identify this entry.\n *\n * @param {DOMString} mimeType for a FileEntry, the mime type to be used to interpret the file, when loaded through this URI.\n * @return uri\n *\x2F\nDirectoryEntry.prototype.toURI = function(mimeType) {\n    return \"file:\x2F\x2F\" + this.fullPath;\n};\n\n\x2F**\n * Creates a new DirectoryReader to read entries from this directory\n *\x2F\nDirectoryEntry.prototype.createReader = function(successCallback, errorCallback) {\n    return new DirectoryReader(this.fullPath);\n};\n\n\x2F**\n * Creates or looks up a directory\n *\n * @param {DOMString} path either a relative or absolute path from this directory in which to look up or create a directory\n * @param {Flags} options to create or excluively create the directory\n * @param {Function} successCallback is called with the new entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryEntry.prototype.getDirectory = function(path, options, successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"getDirectory\", [this.fullPath, path, options]);\n};\n\n\x2F**\n * Creates or looks up a file\n *\n * @param {DOMString} path either a relative or absolute path from this directory in which to look up or create a file\n * @param {Flags} options to create or excluively create the file\n * @param {Function} successCallback is called with the new entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryEntry.prototype.getFile = function(path, options, successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"getFile\", [this.fullPath, path, options]);\n};\n\n\x2F**\n * Deletes a directory and all of it\'s contents\n *\n * @param {Function} successCallback is called with no parameters\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nDirectoryEntry.prototype.removeRecursively = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"removeRecursively\", [this.fullPath]);\n};\n\n\x2F**\n * An interface representing a directory on the file system.\n *\n * @constructor\n * {boolean} isFile always true (readonly)\n * {boolean} isDirectory always false (readonly)\n * {DOMString} name of the file, excluding the path leading to it (readonly)\n * {DOMString} fullPath the absolute full path to the file (readonly)\n * {FileSystem} filesystem on which the directory resides (readonly)\n *\x2F\nvar FileEntry = function() {\n    this.isFile = true;\n    this.isDirectory = false;\n    this.name = null;\n    this.fullPath = null;\n    this.filesystem = null;\n};\n\n\x2F**\n * Copies a file to a new location\n *\n * @param {DirectoryEntry} parent the directory to which to copy the entry\n * @param {DOMString} newName the new name of the entry, defaults to the current name\n * @param {Function} successCallback is called with the new entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nFileEntry.prototype.copyTo = function(parent, newName, successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"copyTo\", [this.fullPath, parent, newName]);\n};\n\n\x2F**\n * Looks up the metadata of the entry\n *\n * @param {Function} successCallback is called with a Metadata object\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nFileEntry.prototype.getMetadata = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"getMetadata\", [this.fullPath]);\n};\n\n\x2F**\n * Gets the parent of the entry\n *\n * @param {Function} successCallback is called with a parent entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nFileEntry.prototype.getParent = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"getParent\", [this.fullPath]);\n};\n\n\x2F**\n * Moves a directory to a new location\n *\n * @param {DirectoryEntry} parent the directory to which to move the entry\n * @param {DOMString} newName the new name of the entry, defaults to the current name\n * @param {Function} successCallback is called with the new entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nFileEntry.prototype.moveTo = function(parent, newName, successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"moveTo\", [this.fullPath, parent, newName]);\n};\n\n\x2F**\n * Removes the entry\n *\n * @param {Function} successCallback is called with no parameters\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nFileEntry.prototype.remove = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"remove\", [this.fullPath]);\n};\n\n\x2F**\n * Returns a URI that can be used to identify this entry.\n *\n * @param {DOMString} mimeType for a FileEntry, the mime type to be used to interpret the file, when loaded through this URI.\n * @return uri\n *\x2F\nFileEntry.prototype.toURI = function(mimeType) {\n    return \"file:\x2F\x2F\" + this.fullPath;\n};\n\n\x2F**\n * Creates a new FileWriter associated with the file that this FileEntry represents.\n *\n * @param {Function} successCallback is called with the new FileWriter\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nFileEntry.prototype.createWriter = function(successCallback, errorCallback) {\n    this.file(function(filePointer) {\n        var writer = new FileWriter(filePointer);\n    \n        if (writer.fileName === null || writer.fileName === \"\") {\n            if (typeof errorCallback == \"function\") {\n                errorCallback({\n                    \"code\": FileError.INVALID_STATE_ERR\n                });\n            }\n        }\n    \n        if (typeof successCallback == \"function\") {\n            successCallback(writer);\n        }       \n    }, errorCallback);\n};\n\n\x2F**\n * Returns a File that represents the current state of the file that this FileEntry represents.\n *\n * @param {Function} successCallback is called with the new File object\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nFileEntry.prototype.file = function(successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"getFileMetadata\", [this.fullPath]);\n};\n\n\x2F** @constructor *\x2F\nvar LocalFileSystem = function() {\n};\n\n\x2F\x2F File error codes\nLocalFileSystem.TEMPORARY = 0;\nLocalFileSystem.PERSISTENT = 1;\nLocalFileSystem.RESOURCE = 2;\nLocalFileSystem.APPLICATION = 3;\n\n\x2F**\n * Requests a filesystem in which to store application data.\n *\n * @param {int} type of file system being requested\n * @param {Function} successCallback is called with the new FileSystem\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nLocalFileSystem.prototype.requestFileSystem = function(type, size, successCallback, errorCallback) {\n    if (type \x3C 0 || type \x3E 3) {\n        if (typeof errorCallback == \"function\") {\n            errorCallback({\n                \"code\": FileError.SYNTAX_ERR\n            });\n        }\n    }\n    else {\n        PhoneGap.exec(successCallback, errorCallback, \"File\", \"requestFileSystem\", [type, size]);\n    }\n};\n\n\x2F**\n *\n * @param {DOMString} uri referring to a local file in a filesystem\n * @param {Function} successCallback is called with the new entry\n * @param {Function} errorCallback is called with a FileError\n *\x2F\nLocalFileSystem.prototype.resolveLocalFileSystemURI = function(uri, successCallback, errorCallback) {\n    PhoneGap.exec(successCallback, errorCallback, \"File\", \"resolveLocalFileSystemURI\", [uri]);\n};\n\n\x2F**\n* This function returns and array of contacts.  It is required as we need to convert raw\n* JSON objects into concrete Contact objects.  Currently this method is called after\n* navigator.service.contacts.find but before the find methods success call back.\n*\n* @param a JSON Objects that need to be converted to DirectoryEntry or FileEntry objects.\n* @returns an entry\n*\x2F\nLocalFileSystem.prototype._castFS = function(pluginResult) {\n    var entry = null;\n    entry = new DirectoryEntry();\n    entry.isDirectory = pluginResult.message.root.isDirectory;\n    entry.isFile = pluginResult.message.root.isFile;\n    entry.name = pluginResult.message.root.name;\n    entry.fullPath = pluginResult.message.root.fullPath;\n    pluginResult.message.root = entry;\n    return pluginResult;\n};\n\nLocalFileSystem.prototype._castEntry = function(pluginResult) {\n    var entry = null;\n    if (pluginResult.message.isDirectory) {\n        console.log(\"This is a dir\");\n        entry = new DirectoryEntry();\n    }\n    else if (pluginResult.message.isFile) {\n        console.log(\"This is a file\");\n        entry = new FileEntry();\n    }\n    entry.isDirectory = pluginResult.message.isDirectory;\n    entry.isFile = pluginResult.message.isFile;\n    entry.name = pluginResult.message.name;\n    entry.fullPath = pluginResult.message.fullPath;\n    pluginResult.message = entry;\n    return pluginResult;\n};\n\nLocalFileSystem.prototype._castEntries = function(pluginResult) {\n    var entries = pluginResult.message;\n    var retVal = [];\n    for (var i=0; i\x3Centries.length; i++) {\n        retVal.push(window.localFileSystem._createEntry(entries[i]));\n    }\n    pluginResult.message = retVal;\n    return pluginResult;\n};\n\nLocalFileSystem.prototype._createEntry = function(castMe) {\n    var entry = null;\n    if (castMe.isDirectory) {\n        console.log(\"This is a dir\");\n        entry = new DirectoryEntry();\n    }\n    else if (castMe.isFile) {\n        console.log(\"This is a file\");\n        entry = new FileEntry();\n    }\n    entry.isDirectory = castMe.isDirectory;\n    entry.isFile = castMe.isFile;\n    entry.name = castMe.name;\n    entry.fullPath = castMe.fullPath;\n    return entry;\n};\n\nLocalFileSystem.prototype._castDate = function(pluginResult) {\n    if (pluginResult.message.modificationTime) {\n        var modTime = new Date(pluginResult.message.modificationTime);\n        pluginResult.message.modificationTime = modTime;\n    }\n    else if (pluginResult.message.lastModifiedDate) {\n        var file = new File();\n        file.size = pluginResult.message.size;\n        file.type = pluginResult.message.type;\n        file.name = pluginResult.message.name;\n        file.fullPath = pluginResult.message.fullPath;\n        file.lastModifiedDate = new Date(pluginResult.message.lastModifiedDate);\n        pluginResult.message = file;\n    }\n    return pluginResult;\n};\n\n\x2F**\n * Add the FileSystem interface into the browser.\n *\x2F\nPhoneGap.addConstructor(function() {\n    var pgLocalFileSystem = new LocalFileSystem();\n    \x2F\x2F Needed for cast methods\n    if(typeof window.localFileSystem == \"undefined\") window.localFileSystem  = pgLocalFileSystem;\n    if(typeof window.requestFileSystem == \"undefined\") window.requestFileSystem  = pgLocalFileSystem.requestFileSystem;\n    if(typeof window.resolveLocalFileSystemURI == \"undefined\") window.resolveLocalFileSystemURI = pgLocalFileSystem.resolveLocalFileSystemURI;\n});\n}\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"filetransfer\")) {\nPhoneGap.addResource(\"filetransfer\");\n\n\x2F**\n * FileTransfer uploads a file to a remote server.\n * @constructor\n *\x2F\nvar FileTransfer = function() {};\n\n\x2F**\n * FileUploadResult\n * @constructor\n *\x2F\nvar FileUploadResult = function() {\n    this.bytesSent = 0;\n    this.responseCode = null;\n    this.response = null;\n};\n\n\x2F**\n * FileTransferError\n * @constructor\n *\x2F\nvar FileTransferError = function() {\n    this.code = null;\n};\n\nFileTransferError.FILE_NOT_FOUND_ERR = 1;\nFileTransferError.INVALID_URL_ERR = 2;\nFileTransferError.CONNECTION_ERR = 3;\n\n\x2F**\n* Given an absolute file path, uploads a file on the device to a remote server\n* using a multipart HTTP request.\n* @param filePath {String}           Full path of the file on the device\n* @param server {String}             URL of the server to receive the file\n* @param successCallback (Function}  Callback to be invoked when upload has completed\n* @param errorCallback {Function}    Callback to be invoked upon error\n* @param options {FileUploadOptions} Optional parameters such as file name and mimetype\n*\x2F\nFileTransfer.prototype.upload = function(filePath, server, successCallback, errorCallback, options, debug) {\n\n    \x2F\x2F check for options\n    var fileKey = null;\n    var fileName = null;\n    var mimeType = null;\n    var params = null;\n    var chunkedMode = true;\n    if (options) {\n        fileKey = options.fileKey;\n        fileName = options.fileName;\n        mimeType = options.mimeType;\n        if (options.chunkedMode != null || typeof options.chunkedMode != \"undefined\") {\n            chunkedMode = options.chunkedMode;\n        }\n        if (options.params) {\n            params = options.params;\n        }\n        else {\n            params = {};\n        }\n    }\n\n    PhoneGap.exec(successCallback, errorCallback, \'FileTransfer\', \'upload\', [filePath, server, fileKey, fileName, mimeType, params, debug, chunkedMode]);\n};\n\n\x2F**\n * Options to customize the HTTP request used to upload files.\n * @constructor\n * @param fileKey {String}   Name of file request parameter.\n * @param fileName {String}  Filename to be used by the server. Defaults to image.jpg.\n * @param mimeType {String}  Mimetype of the uploaded file. Defaults to image\x2Fjpeg.\n * @param params {Object}    Object with key: value params to send to the server.\n *\x2F\nvar FileUploadOptions = function(fileKey, fileName, mimeType, params) {\n    this.fileKey = fileKey || null;\n    this.fileName = fileName || null;\n    this.mimeType = mimeType || null;\n    this.params = params || null;\n};\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.fileTransfer === \"undefined\") {\n        navigator.fileTransfer = new FileTransfer();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"geolocation\")) {\nPhoneGap.addResource(\"geolocation\");\n\n\x2F**\n * This class provides access to device GPS data.\n * @constructor\n *\x2F\nvar Geolocation = function() {\n\n    \x2F\x2F The last known GPS position.\n    this.lastPosition = null;\n\n    \x2F\x2F Geolocation listeners\n    this.listeners = {};\n};\n\n\x2F**\n * Position error object\n *\n * @constructor\n * @param code\n * @param message\n *\x2F\nvar PositionError = function(code, message) {\n    this.code = code;\n    this.message = message;\n};\n\nPositionError.PERMISSION_DENIED = 1;\nPositionError.POSITION_UNAVAILABLE = 2;\nPositionError.TIMEOUT = 3;\n\n\x2F**\n * Asynchronously aquires the current position.\n *\n * @param {Function} successCallback    The function to call when the position data is available\n * @param {Function} errorCallback      The function to call when there is an error getting the heading position. (OPTIONAL)\n * @param {PositionOptions} options     The options for getting the position data. (OPTIONAL)\n *\x2F\nGeolocation.prototype.getCurrentPosition = function(successCallback, errorCallback, options) {\n    if (navigator._geo.listeners.global) {\n        console.log(\"Geolocation Error: Still waiting for previous getCurrentPosition() request.\");\n        try {\n            errorCallback(new PositionError(PositionError.TIMEOUT, \"Geolocation Error: Still waiting for previous getCurrentPosition() request.\"));\n        } catch (e) {\n        }\n        return;\n    }\n    var maximumAge = 10000;\n    var enableHighAccuracy = false;\n    var timeout = 10000;\n    if (typeof options !== \"undefined\") {\n        if (typeof options.maximumAge !== \"undefined\") {\n            maximumAge = options.maximumAge;\n        }\n        if (typeof options.enableHighAccuracy !== \"undefined\") {\n            enableHighAccuracy = options.enableHighAccuracy;\n        }\n        if (typeof options.timeout !== \"undefined\") {\n            timeout = options.timeout;\n        }\n    }\n    navigator._geo.listeners.global = {\"success\" : successCallback, \"fail\" : errorCallback };\n    PhoneGap.exec(null, null, \"Geolocation\", \"getCurrentLocation\", [enableHighAccuracy, timeout, maximumAge]);\n};\n\n\x2F**\n * Asynchronously watches the geolocation for changes to geolocation.  When a change occurs,\n * the successCallback is called with the new location.\n *\n * @param {Function} successCallback    The function to call each time the location data is available\n * @param {Function} errorCallback      The function to call when there is an error getting the location data. (OPTIONAL)\n * @param {PositionOptions} options     The options for getting the location data such as frequency. (OPTIONAL)\n * @return String                       The watch id that must be passed to #clearWatch to stop watching.\n *\x2F\nGeolocation.prototype.watchPosition = function(successCallback, errorCallback, options) {\n    var maximumAge = 10000;\n    var enableHighAccuracy = false;\n    var timeout = 10000;\n    if (typeof options !== \"undefined\") {\n        if (typeof options.frequency  !== \"undefined\") {\n            maximumAge = options.frequency;\n        }\n        if (typeof options.maximumAge !== \"undefined\") {\n            maximumAge = options.maximumAge;\n        }\n        if (typeof options.enableHighAccuracy !== \"undefined\") {\n            enableHighAccuracy = options.enableHighAccuracy;\n        }\n        if (typeof options.timeout !== \"undefined\") {\n            timeout = options.timeout;\n        }\n    }\n    var id = PhoneGap.createUUID();\n    navigator._geo.listeners[id] = {\"success\" : successCallback, \"fail\" : errorCallback };\n    PhoneGap.exec(null, null, \"Geolocation\", \"start\", [id, enableHighAccuracy, timeout, maximumAge]);\n    return id;\n};\n\n\x2F*\n * Native callback when watch position has a new position.\n * PRIVATE METHOD\n *\n * @param {String} id\n * @param {Number} lat\n * @param {Number} lng\n * @param {Number} alt\n * @param {Number} altacc\n * @param {Number} head\n * @param {Number} vel\n * @param {Number} stamp\n *\x2F\nGeolocation.prototype.success = function(id, lat, lng, alt, altacc, head, vel, stamp) {\n    var coords = new Coordinates(lat, lng, alt, altacc, head, vel);\n    var loc = new Position(coords, stamp);\n    try {\n        if (lat === \"undefined\" || lng === \"undefined\") {\n            navigator._geo.listeners[id].fail(new PositionError(PositionError.POSITION_UNAVAILABLE, \"Lat\x2FLng are undefined.\"));\n        }\n        else {\n            navigator._geo.lastPosition = loc;\n            navigator._geo.listeners[id].success(loc);\n        }\n    }\n    catch (e) {\n        console.log(\"Geolocation Error: Error calling success callback function.\");\n    }\n\n    if (id === \"global\") {\n        delete navigator._geo.listeners.global;\n    }\n};\n\n\x2F**\n * Native callback when watch position has an error.\n * PRIVATE METHOD\n *\n * @param {String} id       The ID of the watch\n * @param {Number} code     The error code\n * @param {String} msg      The error message\n *\x2F\nGeolocation.prototype.fail = function(id, code, msg) {\n    try {\n        navigator._geo.listeners[id].fail(new PositionError(code, msg));\n    }\n    catch (e) {\n        console.log(\"Geolocation Error: Error calling error callback function.\");\n    }\n};\n\n\x2F**\n * Clears the specified heading watch.\n *\n * @param {String} id       The ID of the watch returned from #watchPosition\n *\x2F\nGeolocation.prototype.clearWatch = function(id) {\n    PhoneGap.exec(null, null, \"Geolocation\", \"stop\", [id]);\n    delete navigator._geo.listeners[id];\n};\n\n\x2F**\n * Force the PhoneGap geolocation to be used instead of built-in.\n *\x2F\nGeolocation.usingPhoneGap = false;\nGeolocation.usePhoneGap = function() {\n    if (Geolocation.usingPhoneGap) {\n        return;\n    }\n    Geolocation.usingPhoneGap = true;\n\n    \x2F\x2F Set built-in geolocation methods to our own implementations\n    \x2F\x2F (Cannot replace entire geolocation, but can replace individual methods)\n    navigator.geolocation.setLocation = navigator._geo.setLocation;\n    navigator.geolocation.getCurrentPosition = navigator._geo.getCurrentPosition;\n    navigator.geolocation.watchPosition = navigator._geo.watchPosition;\n    navigator.geolocation.clearWatch = navigator._geo.clearWatch;\n    navigator.geolocation.start = navigator._geo.start;\n    navigator.geolocation.stop = navigator._geo.stop;\n};\n\nPhoneGap.addConstructor(function() {\n    navigator._geo = new Geolocation();\n\n    \x2F\x2F No native geolocation object for Android 1.x, so use PhoneGap geolocation\n    if (typeof navigator.geolocation === \'undefined\') {\n        navigator.geolocation = navigator._geo;\n        Geolocation.usingPhoneGap = true;\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"media\")) {\nPhoneGap.addResource(\"media\");\n\n\x2F**\n * This class provides access to the device media, interfaces to both sound and video\n *\n * @constructor\n * @param src                   The file name or url to play\n * @param successCallback       The callback to be called when the file is done playing or recording.\n *                                  successCallback() - OPTIONAL\n * @param errorCallback         The callback to be called if there is an error.\n *                                  errorCallback(int errorCode) - OPTIONAL\n * @param statusCallback        The callback to be called when media status has changed.\n *                                  statusCallback(int statusCode) - OPTIONAL\n * @param positionCallback      The callback to be called when media position has changed.\n *                                  positionCallback(long position) - OPTIONAL\n *\x2F\nvar Media = function(src, successCallback, errorCallback, statusCallback, positionCallback) {\n\n    \x2F\x2F successCallback optional\n    if (successCallback \&\& (typeof successCallback !== \"function\")) {\n        console.log(\"Media Error: successCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F errorCallback optional\n    if (errorCallback \&\& (typeof errorCallback !== \"function\")) {\n        console.log(\"Media Error: errorCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F statusCallback optional\n    if (statusCallback \&\& (typeof statusCallback !== \"function\")) {\n        console.log(\"Media Error: statusCallback is not a function\");\n        return;\n    }\n\n    \x2F\x2F statusCallback optional\n    if (positionCallback \&\& (typeof positionCallback !== \"function\")) {\n        console.log(\"Media Error: positionCallback is not a function\");\n        return;\n    }\n\n    this.id = PhoneGap.createUUID();\n    PhoneGap.mediaObjects[this.id] = this;\n    this.src = src;\n    this.successCallback = successCallback;\n    this.errorCallback = errorCallback;\n    this.statusCallback = statusCallback;\n    this.positionCallback = positionCallback;\n    this._duration = -1;\n    this._position = -1;\n};\n\n\x2F\x2F Media messages\nMedia.MEDIA_STATE = 1;\nMedia.MEDIA_DURATION = 2;\nMedia.MEDIA_POSITION = 3;\nMedia.MEDIA_ERROR = 9;\n\n\x2F\x2F Media states\nMedia.MEDIA_NONE = 0;\nMedia.MEDIA_STARTING = 1;\nMedia.MEDIA_RUNNING = 2;\nMedia.MEDIA_PAUSED = 3;\nMedia.MEDIA_STOPPED = 4;\nMedia.MEDIA_MSG = [\"None\", \"Starting\", \"Running\", \"Paused\", \"Stopped\"];\n\n\x2F\x2F TODO: Will MediaError be used?\n\x2F**\n * This class contains information about any Media errors.\n * @constructor\n *\x2F\nvar MediaError = function() {\n    this.code = null;\n    this.message = \"\";\n};\n\nMediaError.MEDIA_ERR_NONE_ACTIVE    = 0;\nMediaError.MEDIA_ERR_ABORTED        = 1;\nMediaError.MEDIA_ERR_NETWORK        = 2;\nMediaError.MEDIA_ERR_DECODE         = 3;\nMediaError.MEDIA_ERR_NONE_SUPPORTED = 4;\n\n\x2F**\n * Start or resume playing audio file.\n *\x2F\nMedia.prototype.play = function() {\n    PhoneGap.exec(null, null, \"Media\", \"startPlayingAudio\", [this.id, this.src]);\n};\n\n\x2F**\n * Stop playing audio file.\n *\x2F\nMedia.prototype.stop = function() {\n    return PhoneGap.exec(null, null, \"Media\", \"stopPlayingAudio\", [this.id]);\n};\n\n\x2F**\n * Seek or jump to a new time in the track..\n *\x2F\nMedia.prototype.seekTo = function(milliseconds) {\n    PhoneGap.exec(null, null, \"Media\", \"seekToAudio\", [this.id, milliseconds]);\n};\n\n\x2F**\n * Pause playing audio file.\n *\x2F\nMedia.prototype.pause = function() {\n    PhoneGap.exec(null, null, \"Media\", \"pausePlayingAudio\", [this.id]);\n};\n\n\x2F**\n * Get duration of an audio file.\n * The duration is only set for audio that is playing, paused or stopped.\n *\n * @return      duration or -1 if not known.\n *\x2F\nMedia.prototype.getDuration = function() {\n    return this._duration;\n};\n\n\x2F**\n * Get position of audio.\n *\x2F\nMedia.prototype.getCurrentPosition = function(success, fail) {\n    PhoneGap.exec(success, fail, \"Media\", \"getCurrentPositionAudio\", [this.id]);\n};\n\n\x2F**\n * Start recording audio file.\n *\x2F\nMedia.prototype.startRecord = function() {\n    PhoneGap.exec(null, null, \"Media\", \"startRecordingAudio\", [this.id, this.src]);\n};\n\n\x2F**\n * Stop recording audio file.\n *\x2F\nMedia.prototype.stopRecord = function() {\n    PhoneGap.exec(null, null, \"Media\", \"stopRecordingAudio\", [this.id]);\n};\n\n\x2F**\n * Release the resources.\n *\x2F\nMedia.prototype.release = function() {\n    PhoneGap.exec(null, null, \"Media\", \"release\", [this.id]);\n};\n\n\x2F**\n * Adjust the volume.\n *\x2F\nMedia.prototype.setVolume = function(volume) {\n    PhoneGap.exec(null, null, \"Media\", \"setVolume\", [this.id, volume]);\n};\n\n\x2F**\n * List of media objects.\n * PRIVATE\n *\x2F\nPhoneGap.mediaObjects = {};\n\n\x2F**\n * Object that receives native callbacks.\n * PRIVATE\n * @constructor\n *\x2F\nPhoneGap.Media = function() {};\n\n\x2F**\n * Get the media object.\n * PRIVATE\n *\n * @param id            The media object id (string)\n *\x2F\nPhoneGap.Media.getMediaObject = function(id) {\n    return PhoneGap.mediaObjects[id];\n};\n\n\x2F**\n * Audio has status update.\n * PRIVATE\n *\n * @param id            The media object id (string)\n * @param status        The status code (int)\n * @param msg           The status message (string)\n *\x2F\nPhoneGap.Media.onStatus = function(id, msg, value) {\n    var media = PhoneGap.mediaObjects[id];\n    \x2F\x2F If state update\n    if (msg === Media.MEDIA_STATE) {\n        if (value === Media.MEDIA_STOPPED) {\n            if (media.successCallback) {\n                media.successCallback();\n            }\n        }\n        if (media.statusCallback) {\n            media.statusCallback(value);\n        }\n    }\n    else if (msg === Media.MEDIA_DURATION) {\n        media._duration = value;\n    }\n    else if (msg === Media.MEDIA_ERROR) {\n        if (media.errorCallback) {\n            media.errorCallback({\"code\":value});\n        }\n    }\n    else if (msg == Media.MEDIA_POSITION) {\n        media._position = value;\n    }\n};\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"network\")) {\nPhoneGap.addResource(\"network\");\n\n\x2F**\n * This class contains information about the current network Connection.\n * @constructor\n *\x2F\nvar Connection = function() {\n    this.type = null;\n    this._firstRun = true;\n    this._timer = null;\n    this.timeout = 500;\n\n    var me = this;\n    this.getInfo(\n        function(type) {\n            \x2F\x2F Need to send events if we are on or offline\n            if (type == \"none\") {\n                \x2F\x2F set a timer if still offline at the end of timer send the offline event\n                me._timer = setTimeout(function(){\n                    me.type = type;\n                    PhoneGap.fireDocumentEvent(\'offline\');\n                    me._timer = null;\n                    }, me.timeout);\n            } else {\n                \x2F\x2F If there is a current offline event pending clear it\n                if (me._timer != null) {\n                    clearTimeout(me._timer);\n                    me._timer = null;\n                }\n                me.type = type;\n                PhoneGap.fireDocumentEvent(\'online\');\n            }\n            \n            \x2F\x2F should only fire this once\n            if (me._firstRun) {\n                me._firstRun = false;\n                PhoneGap.onPhoneGapConnectionReady.fire();\n            }            \n        },\n        function(e) {\n            \x2F\x2F If we can\'t get the network info we should still tell PhoneGap\n            \x2F\x2F to fire the deviceready event.\n            if (me._firstRun) {\n                me._firstRun = false;\n                PhoneGap.onPhoneGapConnectionReady.fire();\n            }            \n            console.log(\"Error initializing Network Connection: \" + e);\n        });\n};\n\nConnection.UNKNOWN = \"unknown\";\nConnection.ETHERNET = \"ethernet\";\nConnection.WIFI = \"wifi\";\nConnection.CELL_2G = \"2g\";\nConnection.CELL_3G = \"3g\";\nConnection.CELL_4G = \"4g\";\nConnection.NONE = \"none\";\n\n\x2F**\n * Get connection info\n *\n * @param {Function} successCallback The function to call when the Connection data is available\n * @param {Function} errorCallback The function to call when there is an error getting the Connection data. (OPTIONAL)\n *\x2F\nConnection.prototype.getInfo = function(successCallback, errorCallback) {\n    \x2F\x2F Get info\n    PhoneGap.exec(successCallback, errorCallback, \"Network Status\", \"getConnectionInfo\", []);\n};\n\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.network === \"undefined\") {\n        navigator.network = new Object();\n    }\n    if (typeof navigator.network.connection === \"undefined\") {\n        navigator.network.connection = new Connection();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"notification\")) {\nPhoneGap.addResource(\"notification\");\n\n\x2F**\n * This class provides access to notifications on the device.\n * @constructor\n *\x2F\nvar Notification = function() {\n};\n\n\x2F**\n * Open a native alert dialog, with a customizable title and button text.\n *\n * @param {String} message              Message to print in the body of the alert\n * @param {Function} completeCallback   The callback that is called when user clicks on a button.\n * @param {String} title                Title of the alert dialog (default: Alert)\n * @param {String} buttonLabel          Label of the close button (default: OK)\n *\x2F\nNotification.prototype.alert = function(message, completeCallback, title, buttonLabel) {\n    var _title = (title || \"Alert\");\n    var _buttonLabel = (buttonLabel || \"OK\");\n    PhoneGap.exec(completeCallback, null, \"Notification\", \"alert\", [message,_title,_buttonLabel]);\n};\n\n\x2F**\n * Open a native confirm dialog, with a customizable title and button text.\n * The result that the user selects is returned to the result callback.\n *\n * @param {String} message              Message to print in the body of the alert\n * @param {Function} resultCallback     The callback that is called when user clicks on a button.\n * @param {String} title                Title of the alert dialog (default: Confirm)\n * @param {String} buttonLabels         Comma separated list of the labels of the buttons (default: \'OK,Cancel\')\n *\x2F\nNotification.prototype.confirm = function(message, resultCallback, title, buttonLabels) {\n    var _title = (title || \"Confirm\");\n    var _buttonLabels = (buttonLabels || \"OK,Cancel\");\n    PhoneGap.exec(resultCallback, null, \"Notification\", \"confirm\", [message,_title,_buttonLabels]);\n};\n\n\x2F**\n * Start spinning the activity indicator on the statusbar\n *\x2F\nNotification.prototype.activityStart = function() {\n    PhoneGap.exec(null, null, \"Notification\", \"activityStart\", [\"Busy\",\"Please wait...\"]);\n};\n\n\x2F**\n * Stop spinning the activity indicator on the statusbar, if it\'s currently spinning\n *\x2F\nNotification.prototype.activityStop = function() {\n    PhoneGap.exec(null, null, \"Notification\", \"activityStop\", []);\n};\n\n\x2F**\n * Display a progress dialog with progress bar that goes from 0 to 100.\n *\n * @param {String} title        Title of the progress dialog.\n * @param {String} message      Message to display in the dialog.\n *\x2F\nNotification.prototype.progressStart = function(title, message) {\n    PhoneGap.exec(null, null, \"Notification\", \"progressStart\", [title, message]);\n};\n\n\x2F**\n * Set the progress dialog value.\n *\n * @param {Number} value         0-100\n *\x2F\nNotification.prototype.progressValue = function(value) {\n    PhoneGap.exec(null, null, \"Notification\", \"progressValue\", [value]);\n};\n\n\x2F**\n * Close the progress dialog.\n *\x2F\nNotification.prototype.progressStop = function() {\n    PhoneGap.exec(null, null, \"Notification\", \"progressStop\", []);\n};\n\n\x2F**\n * Causes the device to blink a status LED.\n *\n * @param {Integer} count       The number of blinks.\n * @param {String} colour       The colour of the light.\n *\x2F\nNotification.prototype.blink = function(count, colour) {\n    \x2F\x2F NOT IMPLEMENTED\n};\n\n\x2F**\n * Causes the device to vibrate.\n *\n * @param {Integer} mills       The number of milliseconds to vibrate for.\n *\x2F\nNotification.prototype.vibrate = function(mills) {\n    PhoneGap.exec(null, null, \"Notification\", \"vibrate\", [mills]);\n};\n\n\x2F**\n * Causes the device to beep.\n * On Android, the default notification ringtone is played \"count\" times.\n *\n * @param {Integer} count       The number of beeps.\n *\x2F\nNotification.prototype.beep = function(count) {\n    PhoneGap.exec(null, null, \"Notification\", \"beep\", [count]);\n};\n\nPhoneGap.addConstructor(function() {\n    if (typeof navigator.notification === \"undefined\") {\n        navigator.notification = new Notification();\n    }\n});\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\nif (!PhoneGap.hasResource(\"position\")) {\nPhoneGap.addResource(\"position\");\n\n\x2F**\n * This class contains position information.\n * @param {Object} lat\n * @param {Object} lng\n * @param {Object} acc\n * @param {Object} alt\n * @param {Object} altacc\n * @param {Object} head\n * @param {Object} vel\n * @constructor\n *\x2F\nvar Position = function(coords, timestamp) {\n\tthis.coords = coords;\n\tthis.timestamp = (timestamp !== \'undefined\') ? timestamp : new Date().getTime();\n};\n\n\x2F** @constructor *\x2F\nvar Coordinates = function(lat, lng, alt, acc, head, vel, altacc) {\n\t\x2F**\n\t * The latitude of the position.\n\t *\x2F\n\tthis.latitude = lat;\n\t\x2F**\n\t * The longitude of the position,\n\t *\x2F\n\tthis.longitude = lng;\n\t\x2F**\n\t * The accuracy of the position.\n\t *\x2F\n\tthis.accuracy = acc;\n\t\x2F**\n\t * The altitude of the position.\n\t *\x2F\n\tthis.altitude = alt;\n\t\x2F**\n\t * The direction the device is moving at the position.\n\t *\x2F\n\tthis.heading = head;\n\t\x2F**\n\t * The velocity with which the device is moving at the position.\n\t *\x2F\n\tthis.speed = vel;\n\t\x2F**\n\t * The altitude accuracy of the position.\n\t *\x2F\n\tthis.altitudeAccuracy = (altacc !== \'undefined\') ? altacc : null;\n};\n\n\x2F**\n * This class specifies the options for requesting position data.\n * @constructor\n *\x2F\nvar PositionOptions = function() {\n\t\x2F**\n\t * Specifies the desired position accuracy.\n\t *\x2F\n\tthis.enableHighAccuracy = true;\n\t\x2F**\n\t * The timeout after which if position data cannot be obtained the errorCallback\n\t * is called.\n\t *\x2F\n\tthis.timeout = 10000;\n};\n\n\x2F**\n * This class contains information about any GSP errors.\n * @constructor\n *\x2F\nvar PositionError = function() {\n\tthis.code = null;\n\tthis.message = \"\";\n};\n\nPositionError.UNKNOWN_ERROR = 0;\nPositionError.PERMISSION_DENIED = 1;\nPositionError.POSITION_UNAVAILABLE = 2;\nPositionError.TIMEOUT = 3;\n}\n\x2F*\n * PhoneGap is available under *either* the terms of the modified BSD license *or* the\n * MIT License (2008). See http:\x2F\x2Fopensource.org\x2Flicenses\x2Falphabetical for full text.\n *\n * Copyright (c) 2005-2010, Nitobi Software Inc.\n * Copyright (c) 2010-2011, IBM Corporation\n *\x2F\n\n\x2F*\n * This is purely for the Android 1.5\x2F1.6 HTML 5 Storage\n * I was hoping that Android 2.0 would deprecate this, but given the fact that\n * most manufacturers ship with Android 1.5 and do not do OTA Updates, this is required\n *\x2F\n\nif (!PhoneGap.hasResource(\"storage\")) {\nPhoneGap.addResource(\"storage\");\n\n\x2F**\n * SQL result set object\n * PRIVATE METHOD\n * @constructor\n *\x2F\nvar DroidDB_Rows = function() {\n    this.resultSet = [];    \x2F\x2F results array\n    this.length = 0;        \x2F\x2F number of rows\n};\n\n\x2F**\n * Get item from SQL result set\n *\n * @param row           The row number to return\n * @return              The row object\n *\x2F\nDroidDB_Rows.prototype.item = function(row) {\n    return this.resultSet[row];\n};\n\n\x2F**\n * SQL result set that is returned to user.\n * PRIVATE METHOD\n * @constructor\n *\x2F\nvar DroidDB_Result = function() {\n    this.rows = new DroidDB_Rows();\n};\n\n\x2F**\n * Storage object that is called by native code when performing queries.\n * PRIVATE METHOD\n * @constructor\n *\x2F\nvar DroidDB = function() {\n    this.queryQueue = {};\n};\n\n\x2F**\n * Callback from native code when query is complete.\n * PRIVATE METHOD\n *\n * @param id                Query id\n *\x2F\nDroidDB.prototype.completeQuery = function(id, data) {\n    var query = this.queryQueue[id];\n    if (query) {\n        try {\n            delete this.queryQueue[id];\n\n            \x2F\x2F Get transaction\n            var tx = query.tx;\n\n            \x2F\x2F If transaction hasn\'t failed\n            \x2F\x2F Note: We ignore all query results if previous query\n            \x2F\x2F       in the same transaction failed.\n            if (tx \&\& tx.queryList[id]) {\n\n                \x2F\x2F Save query results\n                var r = new DroidDB_Result();\n                r.rows.resultSet = data;\n                r.rows.length = data.length;\n                try {\n                    if (typeof query.successCallback === \'function\') {\n                        query.successCallback(query.tx, r);\n                    }\n                } catch (ex) {\n                    console.log(\"executeSql error calling user success callback: \"+ex);\n                }\n\n                tx.queryComplete(id);\n            }\n        } catch (e) {\n            console.log(\"executeSql error: \"+e);\n        }\n    }\n};\n\n\x2F**\n * Callback from native code when query fails\n * PRIVATE METHOD\n *\n * @param reason            Error message\n * @param id                Query id\n *\x2F\nDroidDB.prototype.fail = function(reason, id) {\n    var query = this.queryQueue[id];\n    if (query) {\n        try {\n            delete this.queryQueue[id];\n\n            \x2F\x2F Get transaction\n            var tx = query.tx;\n\n            \x2F\x2F If transaction hasn\'t failed\n            \x2F\x2F Note: We ignore all query results if previous query\n            \x2F\x2F       in the same transaction failed.\n            if (tx \&\& tx.queryList[id]) {\n                tx.queryList = {};\n\n                try {\n                    if (typeof query.errorCallback === \'function\') {\n                        query.errorCallback(query.tx, reason);\n                    }\n                } catch (ex) {\n                    console.log(\"executeSql error calling user error callback: \"+ex);\n                }\n\n                tx.queryFailed(id, reason);\n            }\n\n        } catch (e) {\n            console.log(\"executeSql error: \"+e);\n        }\n    }\n};\n\n\x2F**\n * SQL query object\n * PRIVATE METHOD\n *\n * @constructor\n * @param tx                The transaction object that this query belongs to\n *\x2F\nvar DroidDB_Query = function(tx) {\n\n    \x2F\x2F Set the id of the query\n    this.id = PhoneGap.createUUID();\n\n    \x2F\x2F Add this query to the queue\n    droiddb.queryQueue[this.id] = this;\n\n    \x2F\x2F Init result\n    this.resultSet = [];\n\n    \x2F\x2F Set transaction that this query belongs to\n    this.tx = tx;\n\n    \x2F\x2F Add this query to transaction list\n    this.tx.queryList[this.id] = this;\n\n    \x2F\x2F Callbacks\n    this.successCallback = null;\n    this.errorCallback = null;\n\n};\n\n\x2F**\n * Transaction object\n * PRIVATE METHOD\n * @constructor\n *\x2F\nvar DroidDB_Tx = function() {\n\n    \x2F\x2F Set the id of the transaction\n    this.id = PhoneGap.createUUID();\n\n    \x2F\x2F Callbacks\n    this.successCallback = null;\n    this.errorCallback = null;\n\n    \x2F\x2F Query list\n    this.queryList = {};\n};\n\n\x2F**\n * Mark query in transaction as complete.\n * If all queries are complete, call the user\'s transaction success callback.\n *\n * @param id                Query id\n *\x2F\nDroidDB_Tx.prototype.queryComplete = function(id) {\n    delete this.queryList[id];\n\n    \x2F\x2F If no more outstanding queries, then fire transaction success\n    if (this.successCallback) {\n        var count = 0;\n        var i;\n        for (i in this.queryList) {\n            if (this.queryList.hasOwnProperty(i)) {\n                count++;\n            }\n        }\n        if (count === 0) {\n            try {\n                this.successCallback();\n            } catch(e) {\n                console.log(\"Transaction error calling user success callback: \" + e);\n            }\n        }\n    }\n};\n\n\x2F**\n * Mark query in transaction as failed.\n *\n * @param id                Query id\n * @param reason            Error message\n *\x2F\nDroidDB_Tx.prototype.queryFailed = function(id, reason) {\n\n    \x2F\x2F The sql queries in this transaction have already been run, since\n    \x2F\x2F we really don\'t have a real transaction implemented in native code.\n    \x2F\x2F However, the user callbacks for the remaining sql queries in transaction\n    \x2F\x2F will not be called.\n    this.queryList = {};\n\n    if (this.errorCallback) {\n        try {\n            this.errorCallback(reason);\n        } catch(e) {\n            console.log(\"Transaction error calling user error callback: \" + e);\n        }\n    }\n};\n\n\x2F**\n * Execute SQL statement\n *\n * @param sql                   SQL statement to execute\n * @param params                Statement parameters\n * @param successCallback       Success callback\n * @param errorCallback         Error callback\n *\x2F\nDroidDB_Tx.prototype.executeSql = function(sql, params, successCallback, errorCallback) {\n\n    \x2F\x2F Init params array\n    if (typeof params === \'undefined\') {\n        params = [];\n    }\n\n    \x2F\x2F Create query and add to queue\n    var query = new DroidDB_Query(this);\n    droiddb.queryQueue[query.id] = query;\n\n    \x2F\x2F Save callbacks\n    query.successCallback = successCallback;\n    query.errorCallback = errorCallback;\n\n    \x2F\x2F Call native code\n    PhoneGap.exec(null, null, \"Storage\", \"executeSql\", [sql, params, query.id]);\n};\n\nvar DatabaseShell = function() {\n};\n\n\x2F**\n * Start a transaction.\n * Does not support rollback in event of failure.\n *\n * @param process {Function}            The transaction function\n * @param successCallback {Function}\n * @param errorCallback {Function}\n *\x2F\nDatabaseShell.prototype.transaction = function(process, errorCallback, successCallback) {\n    var tx = new DroidDB_Tx();\n    tx.successCallback = successCallback;\n    tx.errorCallback = errorCallback;\n    try {\n        process(tx);\n    } catch (e) {\n        console.log(\"Transaction error: \"+e);\n        if (tx.errorCallback) {\n            try {\n                tx.errorCallback(e);\n            } catch (ex) {\n                console.log(\"Transaction error calling user error callback: \"+e);\n            }\n        }\n    }\n};\n\n\x2F**\n * Open database\n *\n * @param name              Database name\n * @param version           Database version\n * @param display_name      Database display name\n * @param size              Database size in bytes\n * @return                  Database object\n *\x2F\nvar DroidDB_openDatabase = function(name, version, display_name, size) {\n    PhoneGap.exec(null, null, \"Storage\", \"openDatabase\", [name, version, display_name, size]);\n    var db = new DatabaseShell();\n    return db;\n};\n\n\x2F**\n * For browsers with no localStorage we emulate it with SQLite. Follows the w3c api.\n * TODO: Do similar for sessionStorage.\n *\x2F\n\n\x2F**\n * @constructor\n *\x2F\nvar CupcakeLocalStorage = function() {\n\t\ttry {\n\n\t\t\tthis.db = openDatabase(\'localStorage\', \'1.0\', \'localStorage\', 2621440);\n\t\t\tvar storage = {};\n\t\t\tthis.length = 0;\n\t\t\tfunction setLength (length) {\n\t\t\t\tthis.length = length;\n\t\t\t\tlocalStorage.length = length;\n\t\t\t}\n\t\t\tthis.db.transaction(\n\t\t\t\tfunction (transaction) {\n\t\t\t\t    var i;\n\t\t\t\t\ttransaction.executeSql(\'CREATE TABLE IF NOT EXISTS storage (id NVARCHAR(40) PRIMARY KEY, body NVARCHAR(255))\');\n\t\t\t\t\ttransaction.executeSql(\'SELECT * FROM storage\', [], function(tx, result) {\n\t\t\t\t\t\tfor(var i = 0; i \x3C result.rows.length; i++) {\n\t\t\t\t\t\t\tstorage[result.rows.item(i)[\'id\']] =  result.rows.item(i)[\'body\'];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsetLength(result.rows.length);\n\t\t\t\t\t\tPhoneGap.initializationComplete(\"cupcakeStorage\");\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tfunction (err) {\n\t\t\t\t\talert(err.message);\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.setItem = function(key, val) {\n\t\t\t\tif (typeof(storage[key])==\'undefined\') {\n\t\t\t\t\tthis.length++;\n\t\t\t\t}\n\t\t\t\tstorage[key] = val;\n\t\t\t\tthis.db.transaction(\n\t\t\t\t\tfunction (transaction) {\n\t\t\t\t\t\ttransaction.executeSql(\'CREATE TABLE IF NOT EXISTS storage (id NVARCHAR(40) PRIMARY KEY, body NVARCHAR(255))\');\n\t\t\t\t\t\ttransaction.executeSql(\'REPLACE INTO storage (id, body) values(?,?)\', [key,val]);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.getItem = function(key) {\n\t\t\t\treturn storage[key];\n\t\t\t};\n\t\t\tthis.removeItem = function(key) {\n\t\t\t\tdelete storage[key];\n\t\t\t\tthis.length--;\n\t\t\t\tthis.db.transaction(\n\t\t\t\t\tfunction (transaction) {\n\t\t\t\t\t\ttransaction.executeSql(\'CREATE TABLE IF NOT EXISTS storage (id NVARCHAR(40) PRIMARY KEY, body NVARCHAR(255))\');\n\t\t\t\t\t\ttransaction.executeSql(\'DELETE FROM storage where id=?\', [key]);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.clear = function() {\n\t\t\t\tstorage = {};\n\t\t\t\tthis.length = 0;\n\t\t\t\tthis.db.transaction(\n\t\t\t\t\tfunction (transaction) {\n\t\t\t\t\t\ttransaction.executeSql(\'CREATE TABLE IF NOT EXISTS storage (id NVARCHAR(40) PRIMARY KEY, body NVARCHAR(255))\');\n\t\t\t\t\t\ttransaction.executeSql(\'DELETE FROM storage\', []);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t};\n\t\t\tthis.key = function(index) {\n\t\t\t\tvar i = 0;\n\t\t\t\tfor (var j in storage) {\n\t\t\t\t\tif (i==index) {\n\t\t\t\t\t\treturn j;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t};\n\n\t\t} catch(e) {\n\t\t\talert(\"Database error \"+e+\".\");\n\t\t    return;\n\t\t}\n};\n\nPhoneGap.addConstructor(function() {\n    var setupDroidDB = function() {\n        navigator.openDatabase = window.openDatabase = DroidDB_openDatabase;\n        window.droiddb = new DroidDB();\n    }\n    if (typeof window.openDatabase === \"undefined\") {\n        setupDroidDB();\n    } else {\n        window.openDatabase_orig = window.openDatabase;\n        window.openDatabase = function(name, version, desc, size){\n            \x2F\x2F Some versions of Android will throw a SECURITY_ERR so we need \n            \x2F\x2F to catch the exception and seutp our own DB handling.\n            var db = null;\n            try {\n                db = window.openDatabase_orig(name, version, desc, size);\n            } \n            catch (ex) {\n                db = null;\n            }\n\n            if (db == null) {\n                setupDroidDB();\n                return DroidDB_openDatabase(name, version, desc, size);\n            }\n            else {\n                return db;\n            }\n        }\n    }\n    \n    if (typeof window.localStorage === \"undefined\") {\n        navigator.localStorage = window.localStorage = new CupcakeLocalStorage();\n        PhoneGap.waitForInitialization(\"cupcakeStorage\");\n    }\n});\n}\nif (!PhoneGap.hasResource(\"deviceorientation\")) {\n\tPhoneGap.addResource(\"deviceorientation\");\n\tfunction DeviceOrientation() {\n\t\tthis.successCallback = function() {\n\t\t};\n\t\tthis.failCallback = function() {\n\t\t};\n\t}\n\n\tDeviceOrientation.prototype.setOrientation = function(newOrientation,\n\t\t\tsuccess, fail) {\n\t\tthis.successCallback = success;\n\t\tthis.failCallback = fail;\n\t\tif (typeof PhoneGap != \"undefined\") {\n\t\t\tPhoneGap.exec(success, fail, \"DeviceOrientation\", \"setOrientation\",\n\t\t\t\t\t[ newOrientation ]);\n\t\t}\n\t}\n\n\tDeviceOrientation.prototype.success = function(ori) {\n\t\tif (typeof this.successCallback == \"function\") {\n\t\t\tthis.successCallback({\n\t\t\t\torientation : ori\n\t\t\t});\n\t\t}\n\t}\n\n\tDeviceOrientation.prototype.fail = function(err) {\n\t\tif (typeof this.failCallback == \"function\") {\n\t\t\tthis.failCallback(err);\n\t\t}\n\t}\n\n\tPhoneGap.addConstructor(function() {\n\t\tif (typeof navigator.deviceOrientation == \"undefined\") {\n\t\t\tnavigator.deviceOrientation = new DeviceOrientation();\n\t\t}\n\t});\n};\nif(!PhoneGap.hasResource(\"flurry\")){\n\tPhoneGap.addResource(\"flurry\");\n\tfunction Flurry(){\n\n\t}\n\n\tFlurry.prototype.logEvent = function(event_name, params){\n\t    var p = JSON.stringify(params);\n\t    PhoneGap.exec(null, null, \"Analytics\", \"logEvent\", [event_name, p]);\n\t}\n\n\tPhoneGap.addConstructor(function(){\n\t  if(typeof window.flurry === \"undefined\"){\n\t    window.flurry = new Flurry();\n\t  }\n\t});\n};\nif(!PhoneGap.hasResource(\"pushnotification\")){\n\tPhoneGap.addResource(\"pushnotification\");\n\tfunction PushNotification() {\n\t    this.registerCallback = null;\n\t}\n\n\tPushNotification.prototype.register = function(successCallback, failureCallback){\n\t    this.registerCallback = successCallback;\n\t    PhoneGap.exec(\n\t            successCallback,           \x2F\x2F called when signature capture is successful\n\t            failureCallback,           \x2F\x2F called when signature capture encounters an error\n\t            \'PushNotificationPlugin\',  \x2F\x2F Tell PhoneGap that we want to run \"PushNotificationPlugin\"\n\t            \'registerCallback\',        \x2F\x2F Tell the plugin the action we want to perform\n\t            []);          \n\t}\n\n\tPushNotification.prototype.registerSuccess = function(apid){\n\t    if(typeof this.registerCallback == \"function\"){\n\t        this.registerCallback(apid);\n\t    }\n\t}\n\n\tPushNotification.prototype.init = function(successCallback, failureCallback) {\n\t     return PhoneGap.exec(\n\t            successCallback,           \x2F\x2F called when signature capture is successful\n\t            failureCallback,           \x2F\x2F called when signature capture encounters an error\n\t            \'PushNotificationPlugin\',  \x2F\x2F Tell PhoneGap that we want to run \"PushNotificationPlugin\"\n\t            \'init\',        \x2F\x2F Tell the plugin the action we want to perform\n\t            []);                       \x2F\x2F List of arguments to the plugin\n\t};\n\n\tPushNotification.prototype.notificationCallback = function (json) {\n\t    var data = window.JSON.parse(json);\n\t    if(typeof $fh.receive_push === \"function\"){\n\t        $fh.receive_push(data);\n\t    }\n\t};\n\n\tPhoneGap.addConstructor(function() {\n\t    if (typeof navigator.pushNotification == \"undefined\")\n\t        navigator.pushNotification = new PushNotification();\n\t});\n};\n\nif(!PhoneGap.hasResource(\"sms\")){\n\tPhoneGap.addResource(\"sms\");\n\tfunction Sms(){\n\n\t}\n\n\tSms.prototype.send = function(success, fail, number, text){\n\t    PhoneGap.exec(success, fail, \"Sms\", \"send\", [number, text]);\n\t}\n\n\tPhoneGap.addConstructor(function(){\n\t  if(typeof navigator.sms === \"undefined\"){\n\t\t  navigator.sms = new Sms();\n\t  }\n\t});\n};var dummysuccess=function(res){}\nvar dummyerror=function(res){}\n\nif(!PhoneGap.hasResource(\"stream\")){\n\tPhoneGap.addResource(\"stream\");\n\tfunction Audio() {\n\t\t  this.successCallback={};\n\t\t  this.errorCallback={};\n\t\t}\n\t\tAudio.prototype.action = function (params, successCallback, errorCallback) {\n\t\t  this.params = params;\n\t\t    \n\t\t  switch (params.act) {\n\t\t  case \'play\':\n\t\t    this.successCallback.play = successCallback;\n\t\t    this.errorCallback.play= errorCallback;\n\t\t      PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"play\", [params.path]);\n\t\t    break;\n\t\t  case \'pause\':\n\t\t    this.successCallback.pause = successCallback;\n\t\t    this.errorCallback.pause= errorCallback;\n\t\t       PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"pause\", []);\n\t\t    break;\n\t\t  case \'stop\':\n\t\t    this.successCallback.stop = successCallback;\n\t\t    this.errorCallback.stop= errorCallback;\n\t\t     PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"stop\", []);\n\t\t    break;\n\t\t  case \'getvolume\':\n\t\t    this.successCallback.getvolume = successCallback;\n\t\t    this.errorCallback.getvolume= errorCallback;\n\t\t    PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"getvolume\", []);\n\t\t    break;\n\t\t  case \'setvolume\':   \n\t\t    this.successCallback.setvolume = successCallback;\n\t\t    this.errorCallback.setvolume= errorCallback;\n\t\t      PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"setvolume\", [params.level]);\n\t\t    break;\n\t\t    case \'getbufferprogress\':\n\t\t        this.successCallback.getbufferprogress = successCallback;\n\t\t        this.errorCallback.getbufferprogress = errorCallback;\n\t\t        PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"getbufferprogress\", []);\n\t\t        break;\n\t\t    case \'seek\':\n\t\t        this.successCallback.seek = successCallback;\n\t\t        this.errorCallback.seek = errorCallback;\n\t\t        PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"seek\", [params.seekPosition]);\n\t\t        break;\n\t\t    case \'getcurrentposition\':\n\t\t        this.successCallback.getcurrentposition = successCallback;\n\t\t        this.errorCallback.getcurrentposition = errorCallback;\n\t\t        PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"getcurrentposition\", []);\n\t\t        break;\n\t\t    case \'resume\':\n\t\t        this.successCallback.resume = successCallback;\n\t\t        this.errorCallback.resume = errorCallback;\n\t\t        PhoneGap.exec(dummysuccess, dummyerror, \"Stream\", \"resume\", []);\n\t\t        break;\n\t\t  default:\n\t\t    errorCallback(\"Data_Act: No Action defined\");\n\t\t    break;\n\t\t  }\n\t\t    \n\n\t\t}\n\n\t\tAudio.prototype.success = function(act, result) {\n\t\t  \n\t\t  if(this.successCallback[act])\n\t\t  {\n\t\t    this.successCallback[act](result);\n\t\t  }\n\t\t}\n\n\t\tAudio.prototype.failure = function(act, result) {\n\t\t  if(this.errorCallback[act])\n\t\t  {\n\t\t    this.errorCallback[act](result);\n\t\t  }\n\t\t}\n\n\t\tvar audio_init_counter = 0;\n\n\t\tPhoneGap.addConstructor(function () {\n\t\t  console.log(\"Navigator audio inited ::\" + audio_init_counter++);\n\t\t    if (typeof navigator.audio == \"undefined\") navigator.audio = new Audio();\n\t\t});\n}\n\n\nif(!PhoneGap.hasResource(\"webview\")){\n\tPhoneGap.addResource(\"webview\");\n\tfunction WebView()\n\t{\n\t  this.opened = false;\n\t}\n\n\tWebView.prototype.action=function(params, successCallback, errorCallback) {\n\t  var operation= function (params) {\n\t    \x2F\x2F params[\'title\'] ? ViewCtrl.display(params.url, params.title) : viewCtrl.display(params.url, undefined);\n\t    params[\'title\']? PhoneGap.exec(dummysuccess, dummyerror, \"ViewCtrl\", \"display\", [params.url,params.title]): PhoneGap.exec(dummysuccess, dummyerror, \"ViewCtrl\", \"display\", [params.url,\"undefined\"]) ;\n\t  }\n\t  \n\t  if( !(\'act\' in params) || params.act === \'open\') {\n\t    this.successCallback = successCallback;\n\t    this.errorCallback = errorCallback; \n\t    params[\'url\']? operation(params): errorCallback(\"Data_Act: No Action defined\") ;\n\t  } else {\n\t  \tif(params.act === \'close\' \&\& this.opened){\n\t  \t  this.opened = false;\n\t      PhoneGap.exec(dummysuccess, dummyerror, \"ViewCtrl\", \"close\", [])\n\t    }\n\t  }\n\t}\n\n\tWebView.prototype.success = function(result) {\n\t  if(result === \'closed\'){\n\t    this.opened = false;\n\t  } else {\n\t  \tthis.opened = true;\n\t  }\n\t  this.successCallback(result);\n\t}\n\n\tWebView.prototype.failure = function(result) {\n\t  this.errorCallback(result);\n\t}\n\n\tPhoneGap.addConstructor(function() {\n\t    if (typeof navigator.webview  == \"undefined\") navigator.webview = new WebView();\n\t});\n}\x2F* Add the specific \'ready\' implementation outside of on-device function definitions\n   as it doesn\'t depend on phonegap. Also, it must be defined before the app javscript \n   is loaded so that the device specific implementation of \'ready; will override the \n   generic implementation. \n *\x2F\n$fh._readyCallbacks = [];\n$fh._readyState = false;\n$fh.__dest__.ready = function (p, s, f) {\n  if ($fh._readyState) {\n    s();\n  } else {\n    $fh._readyCallbacks.push(s);\n  }\n};\n$fh.__dest__.setUUID = function (p, s, f) {\n  \x2F\x2Fdo nothing for devices  \n};\ndocument.addEventListener(\'deviceready\', function () {\n  $fh._readyState = true;\n  document.removeEventListener(\'deviceready\', arguments.callee, false);\n  while ($fh._readyCallbacks.length \x3E 0) {\n    var f = $fh._readyCallbacks.shift();\n    f();\n  }\n});\n$fh.__dest__.env = function (p, s, f) {\n  s({\n    uuid: function () {\n      return navigator.device ? navigator.device.uuid : \"\"\n    }() + \"\",\n    \x2F\x2Fconvert it to string\n    density: function () {\n      return navigator.device ? navigator.device.density : 1.0\n    }()\n  })\n};\n$fh.__dest__.handlers = function (p, s, f) {\n  if (!p.type) {\n    f(\'hanlders_no_type\');\n    return;\n  }\n  var types = {\n    \'back\': function () {\n      navigator.device.overrideBackButton();\n      var handler = function () {\n          var exit = s();\n          if (exit) {\n            navigator.device.exitApp();\n          }\n        }\n      document.addEventListener(\'backbutton\', handler, false);\n    },\n    \'menu\': function () {\n      var handler = function () {\n          s();\n        }\n      document.addEventListener(\'menubutton\', handler, false);\n    }\n  }\n  types[p.type] ? types[p.type]() : f(\'hanlders_invalid_type\');\n};\n$fh.__dest__.log = function (p, s, f) {\n  console.log(p.message);\n};\n$fh.__dest__._geoWatcher = undefined;\n$fh.__dest__.geo = function (p, s, f) {\n  if (!p.act || p.act == \"register\") {\n    if ($fh.__dest__._geoWatcher) {\n      f(\'geo_inuse\', {}, p);\n      return;\n    }\n    if (p.interval == 0) {\n      var timer = navigator._geo.watchPosition(function (\n      position) {\n        var coords = position.coords;\n        var resdata = {\n          lon: coords.longitude,\n          lat: coords.latitude,\n          alt: coords.altitude,\n          acc: coords.accuracy,\n          head: coords.heading,\n          speed: coords.speed,\n          when: position.timestamp\n        };\n        navigator._geo.clearWatch(timer);\n        s(resdata);\n      }, function () {\n        f(\'error_geo\');\n      }, {\n        frequency: 1000\n      });\n    };\n    if (p.interval \x3E 0) {\n      $fh.__dest__._geoWatcher = navigator._geo.watchPosition(\n\n      function (position) {\n        var coords = position.coords;\n        var resdata = {\n          lon: coords.longitude,\n          lat: coords.latitude,\n          alt: coords.altitude,\n          acc: coords.accuracy,\n          head: coords.heading,\n          speed: coords.speed,\n          when: position.timestamp\n        };\n        s(resdata);\n      }, function () {\n        f(\'error_geo\');\n      }, {\n        frequency: p.interval\n      });\n    };\n  } else if (p.act == \"unregister\") {\n    if ($fh.__dest__._geoWatcher) {\n      navigator._geo.clearWatch($fh.__dest__._geoWatcher);\n      $fh.__dest__._geoWatcher = undefined;\n    };\n    s();\n  } else {\n    f(\'geo_badact\', {}, p);\n  }\n};\n$fh.__dest__.contacts = function (p, s, f) {\n  var defaultFields = [\"name\", \"nickname\", \"phoneNumbers\", \"emails\", \"addresses\"];\n  var acts = {\n    list: function () {\n      navigator.contacts.find([\"*\"], function (cl) {\n    \t  console.log(JSON.stringify(cl));\n        var cs = processResults(cl);\n        s({\n          list: cs\n        });\n      }, function () {\n        f(\'contacts_list_error\', {}, p);\n      }, {\"filter\":\"\", \"multiple\": true})\n    },\n    find: function () {\n      if (!p.by) {\n        f(\'contacts_findbynull\', {}, p);\n        return;\n      }\n      var fields = [\"*\"];\n      if(p.by \&\& typeof p.by == \"string\"){\n    \t  fields = defaultFields;\n    \t  fields.push(p.by);\n      }\n      navigator.contacts.find(fields, function (cl) {\n        var cs = processResults(cl);\n        s({\n          list: cs\n        });\n      }, function () {\n        f(\'contacts_error\', {}, p);\n      }, {\"filter\": p.val, \"multiple\":true})\n    },\n    add: function () {\n      var params = {};\n      if (p.gui) {\n        navigator.contacts.insert(function(c){\n          var contact = convertToFhFormat(c);\n          s(contact);\n        }, function(err){\n          f(err, {}, p);\n        });\n      } else {\n        var contactParam = p.contact;\n        if (p.contact) {\n          var phones = [];\n          if (typeof p.contact.phone === \'object\') {\n            for (var key in p.contact.phone) {\n              phones.push({type: key, value: p.contact.phone[key]});\n            }\n          } else if(typeof p.contact.phone === \"string\"){\n            phones.push({type:\'mobile\', value: p.contact.phone});\n          }\n          if(phones.length \x3E 0){\n            contactParam[\"phoneNumbers\"] = phones;\n          }\n          if(p.contact.first || p.contact.last){\n            contactParam[\"name\"] = {\"givenName\" : p.contact.first, \"familyName\": p.contact.last};\n          }\n        }\n        var contactObj = navigator.contacts.create(contactParam);\n        contactObj.save(\n          function (c) {\n            var contact = convertToFhFormat(c);\n            s(contact);\n          },function(err){\n            f(err, {}, p);\n        }); \n      }\n    },\n    remove: function () {\n      if (!p.contact) {\n        return function () {\n          f(\'no_contact\', {}, p);\n        }\n      }\n      if (!p.contact.id) {\n        return function () {\n          f(\'no_contactId\', {}, p);\n        }\n      }\n      var contactObj = navigator.contacts.create({\"id\": p.contact.id});\n      contactObj.remove(function(){\n        s();\n      }, function(err){\n        f(err);\n      });\n    },\n    choose: function () {\n      navigator.contacts.choose(function (data) {\n        var cs = processResults([data]);\n        s({\n          list: cs\n        });\n      }, function () {\n        f(\'contacts_choose_error\', {}, p);\n      });\n    }\n  };\n  \x2F\x2FTODO: follow the W3C Contact API once it\'s approved\n  var convertToFhFormat = function(w3cFormatContact){\n    return {\n      first: w3cFormatContact.name.givenName,\n      last: w3cFormatContact.name.familyName,\n      name: null == w3cFormatContact.nickname? w3cFormatContact.name.formatted : w3cFormatContact.nickname,\n      addr: convertRecords(w3cFormatContact.addresses),\n      phone: convertRecords(w3cFormatContact.phoneNumbers),\n      email: convertRecords(w3cFormatContact.emails),\n      id: w3cFormatContact.id\n    }\n  }\n\n  var processResults = function (cl) {\n      var cs = [];\n      for (var i = 0, cll = cl.length; i \x3C cll; i++) {\n        var c = cl[i];\n        cs.push(convertToFhFormat(c));\n      }\n      return cs;\n    };\n  var convertRecords = function (records) {\n      var retJson = {};\n      if(null != records){\n        for (var i = 0; i \x3C records.length; i++) {\n          var obj = records[i];\n          retJson[obj.type] = obj.value;\n        }\n      }\n      return retJson;\n    };\n  var actfunc = acts[p.act];\n  if (actfunc) {\n    actfunc();\n  } else {\n    f(\'contacts_badact\', {}, p);\n  }\n};\n\x2F** **************************************************\n *  ACCELEROMETER\n *  **************************************************\n *\x2F\n$fh.__dest__._accWatcher = undefined;\n$fh.__dest__.acc = function (p, s, f) {\n  if (!p.act || p.act == \"register\") {\n    if ($fh.__dest__._accWatcher) {\n      f(\'acc_inuse\', {}, p);\n      return;\n    }\n    if (p.interval == 0) {\n      var timer = navigator.accelerometer.watchAcceleration(function (\n      accel) {\n        var result = {\n          x: accel.x,\n          y: accel.y,\n          z: accel.z,\n          when: accel.timestamp\n        };\n        s(result);\n        navigator.accelerometer.clearWatch(timer);\n      }, function () {\n        f(\'error_acc\', {}, p);\n      }, {\n        frequency: 1000\n      })\n    }\n    if (p.interval \x3E 0) {\n      $fh.__dest__._accWatcher = navigator.accelerometer.watchAcceleration(function (accel) {\n        var result = {\n          x: accel.x,\n          y: accel.y,\n          z: accel.z,\n          when: accel.timestamp\n        };\n        s(result);\n      }, function () {\n        f(\'error_acc\', {}, p);\n      }, {\n        frequency: p.interval\n      })\n    }\n  } else if (p.act == \"unregister\") {\n    if ($fh.__dest__._accWatcher) {\n      navigator.accelerometer.clearWatch($fh.__dest__._accWatcher);\n      $fh.__dest__._accWatcher = undefined;\n    }\n    s();\n  } else {\n    f(\'acc_badact\', {}, p);\n  }\n};\n$fh.__dest__.notify = function (p, s, f) {\n  var acts = {\n    vibrate: function () {\n      navigator.notification.vibrate(1000);\n    },\n    beep: function () {\n      navigator.notification.beep(2);\n    }\n  }\n  var actfunc = acts[p.type];\n  if (actfunc) {\n    actfunc();\n  } else {\n    f(\'notify_badact\', {}, p);\n  }\n};\n$fh.__dest__.cam = function (p, s, f) {\n  if (p.act \&\& p.act != \"picture\") {\n    f(\'cam_nosupport\', {}, p);\n    return;\n  }\n  var source = 1; \x2F\x2F camera type\n  if (p.source \&\& p.source == \'photo\') {\n    source = 0;\n  }\n  var destType = 0;\n  if (p.uri) {\n    destType = 1;\n  }\n  var options = {\n    \'sourceType\': source,\n    \'destinationType\': destType\n  };\n  navigator.camera.getPicture(function (pic) {\n    if (p.uri) {\n      s({\n        uri: pic\n      });\n    } else {\n      var picdata = {\n        format: \'jpg\',\n        b64: pic\n      };\n      s(picdata);\n    }\n  }, function () {\n    f(\'cam_error\', {}, p);\n  }, options);\n};\n$fh.__dest__.send = function (p, s, f) {\n  if (p.type == \"email\") {\n    var url = \"mailto:\" + p.to + \"?cc=\" + (p.cc ? p.cc : \" \") + \"\&bcc=\" + (p.bcc ? p.bcc : \" \") + \"\&subject=\" + (p.subject ? p.subject : \"\") + \"\&body=\" + (p.body ? encodeURI(p.body) : \"\");\n    document.location = url;\n  } else if (p.type == \"sms\") {\n\tif(typeof p.background != \"undefined\" \&\& p.background){\n\t\tif(typeof navigator.sms != \"undefined\"){\n\t\t\tnavigator.sms.send(function(){\n\t\t\t\ts();\n\t\t\t}, function(err){\n\t\t\t\tf(err, {}, p);\n\t\t\t}, p.to, p.body)\n\t\t} else {\n\t\t\tf(\'send_sms_nobackground\', {}, p);\n\t\t}\n\t} else {\n\t\tvar url = \"sms:\" + p.to;\n\t    document.location = url;\n\t}\n  } else {\n    f(\'send_nosupport\', {}, p);\n    return;\n  }\n};\n$fh.__dest__.audio = function (p, s, f) {\n  navigator.audio.action(p, s, f);\n};\n$fh.__dest__.webview = function (p, s, f) {\n  navigator.webview.action(p, s, f);\n};\n\x2F\x2F\n$fh.__dest__.ori = function (p, s, f) {\n  if (typeof p.act == \"undefined\" || p.act == \"listen\") {\n    window.addEventListener(\'orientationchange\', function (e) {\n      s(window.orientation);\n    }, false);\n  } else if (p.act == \"set\") {\n    if (!p.value) {\n      f(\'ori_no_value\');\n      return;\n    }\n    navigator.deviceOrientation.setOrientation(p.value, function (ori) {\n      s(ori);\n    }, function (err) {\n      f(err);\n    })\n  } else {\n    f(\'ori_badact\');\n  }\n};\n$fh.__dest__.file = function (p, s, f) {\n  var errors = [\'file_notfound\', \'file_invalid_url\', \'file_connection_err\', \'file_server_err\'];\n  var acts = {\n    \'upload\': function () {\n      if (!p.filepath) {\n        f(\'file_nofilepath\');\n        return;\n      }\n      if (!p.server) {\n        f(\'file_noserver\');\n        return;\n      }\n      var options = {};\n      if (p.filekey) {\n        options.fileKey = p.filekey;\n      }\n      if (p.filename) {\n        options.fileName = p.filename;\n      }\n      if (p.mime) {\n        options.mimeType = p.mime;\n      }\n      if (p.params) {\n    \toptions.params = p.params;\n      }\n      var debug = false;\n      if (p.debug) {\n    \t  debug = true;\n      }\n      navigator.fileTransfer.upload(p.filepath, p.local, function (message) {\n        s({\n          status: message.responseCode,\n          res: message.response,\n          size: message.bytesSent\n        });\n      }, function (error) {\n        var err = \'file_unknown\';\n        if (1 \x3C= error.code \x3C= 4) {\n          err = errors[error.code - 1];\n        }\n        f(err);\n      }, options, debug);\n    }\n  }\n  var actfunc = acts[p.act];\n  if (actfunc) {\n    actfunc();\n  } else {\n    f(\'file_badact\');\n  }\n};\n$fh.__dest__.push = function (p, s, f) {\n  var acts = {\n    \'register\': function () {\n      navigator.pushNotification.register(function (apid) {\n        s({\n          apid: apid\n        });\n      }, function () {});\n    },\n    \'receive\': function () {\n      navigator.pushNotification.init(function () {}, function () {});\n      $fh.receive_push = function (notification) {\n        var data = {\n          message: notification.msg,\n          extras: notification.payload\n        };\n        s(data);\n      }\n    }\n  };\n  acts[p.act] ? acts[p.act]() : f(\'push_badact\');\n};\n\x2F\x2Fneeds to add the listener again here because the document.addEventListener has been overwritten by phonegap 2.2\n\x2F\x2Fand it was included after the first addEventListner called which means the first one is lost at this point...\ndocument.addEventListener(\'deviceready\', function () {\n  $fh._readyState = true;\n  document.removeEventListener(\'deviceready\', arguments.callee, false);\n  while ($fh._readyCallbacks.length \x3E 0) {\n    var f = $fh._readyCallbacks.shift();\n    f();\n  }\n});</script>'
	};


http.ServerResponse.prototype.writeError = function(code, desc) {
	this.writeHead(code, {
		"Content-Type": mimeTypes.txt
	});
	this.end(desc + "\n");
}


function fileExists(uri, cb) {
	var lookupIndex = 0;

	(function checkPath(filename) {
		filename = path.join(process.cwd(), filename);

		path.exists(filename, function(exists) {
			if(!exists) {
				if(lookupIndex >= lookupDirs.length) {
					cb && cb(false);
				}
				else {
					checkPath(uri.replace("client/default", lookupDirs[lookupIndex++]));
				}
			}
			else {
				cb && cb(true, filename);
			}
		});	
	})(uri);
}


function validateArgs(args) {
	for(var i in defaultArgs) {
		var defaultArg = defaultArgs[i];
		if(args[i] === undefined) {

			if(defaultArg.required) {
				if(!defaultArg.val) {
					throw new Error("Missing '" + i + "' parameter")
				}
				else if(defaultArg.val) {
					args[i] = defaultArg.val;
				}
			}
		}
	}
}

function local(args, cb) {
	try {
		var argObj = common.parseArgs(args);
		validateArgs(argObj);
	} catch (x) {
		return cb("Error processing args: " + x + "\nUsage: " + local.usage);
	}


	if(argObj.package) {
		lookupDirs.push("client/" + argObj.package);
	}

	var domain = argObj.domain + argObj.baseDomain,
		browserScript = '<script src="https://' + domain + '/static/pec/script/studio/155-scripts.js"></script>',
		initialiseScript = 
		'<script>' +
		'$fhclient = $fh.init({' +
			'appMode:"debug",' +
			'checkDeliveryScheme:true,' +
			'debugCloudType:"fh",' +
			'debugCloudUrl: "https://' + domain + '",' +
			'deliveryScheme:"https://",' +
			'destination: {' +
				'inline:false,' +
				'name:"studio"' +
			'},' +
			'domain: "' + argObj.domain + '",' +
			'host: "' + domain + '",' +
			'nameserver:"https://ainm.feedhenry.com",' +
			'releaseCloudType:"fh",' +
			'releaseCloudUrl:"https://' + domain + '",' +
			'swagger_view:"Sju8tJFwM7kox_S1rr1wZ2PS",' +
			'urltag:"",' +
			'useSecureConnection:true,' +
			'user:{' +
				'id:"YqxcBngHv4nt3j1VstTjQj0X",' +
				'role:"sub"' +
			'},' +
			'widget:{' +
				'guid:"' + argObj.app + '",' +
				'inline:false,' +
				'instance: "' + argObj.app +'",' +
				'version:328' +
			'}' +
		'});' +
		'</script>';

	http.createServer(function handleRequest(request, response) {

		var requestParams = url.parse(request.url, true),
			uri = requestParams.pathname,
			host = request.headers.host.split(":")[0] || "localhost";

		if(request.method === "POST") {
			var proxyReq = https.request({
				path: uri,
				method: request.method,
				host: domain,
				headers: request.headers
			}, function(proxyRes) {
				response.writeHead(proxyRes.statusCode, proxyRes.headers);

				proxyRes.on("data", function(chunk) {
					response.write(chunk);
				});
				proxyRes.on("end", function() {
					response.end();
				});
			});

			request.on("data", function(chunk) {
				proxyReq.write(chunk);
			});

			request.on("end", function() {
				proxyReq.end();
			});
		}
		else {
			fileExists(uri, function(exists, filename) {
				if(!exists) {
					return response.writeError(404, "Not Found");
				}

				if (fs.statSync(filename).isDirectory()) 
					filename += '/index.html';

				fs.readFile(filename, "binary", function(err, file) {
					if(err) {
						return response.writeError(500, err);
					}

					response.writeHead(200,{
						"content-type": mimeTypes[filename.split(".").pop()] || mimeTypes.txt
					});
					if(filename.indexOf("index.html") > 0) {
						response.write(injection.viewport);
						if(requestParams.query.device !== undefined) {
							response.write(injection.device);
							if(argObj.weinre) {
								response.write("<script src='http://" + host + ":" + argObj.weinre + "/target/target-script-min.js#anonymous'></script>");
							}
						}
						else {
							response.write(browserScript);
						}
						response.write(initialiseScript);
						
					}
					
					response.end(file, "binary");
				});
			});
		}

	}).listen(parseInt(argObj.port, 10));

	

	console.log("listening on port:", argObj.port);
}